{"version":3,"names":["cache","fontRegex","RegExp","join","mapping","unitMatch","numeric","val","parent","dpi","matches","match","parseFloat","units","toLowerCase","trim","v","Math","round","op","size","lineHeight","generics","serif","cursive","fantasy","monospace","parse","module","exports","str","existing","cacheKey","exec","shift","collected","i","length","key","existingVal","Object","keys","out","style","push","variant","weight","family","split","map","a","defineProperty","value","Array","isArray","indexOf","replace"],"sources":["index.js"],"sourcesContent":["// Inspriation from node-canvas (https://github.com/LearnBoost/node-canvas/)\n\nvar cache = {};\n\n// regex hoisted from http://stackoverflow.com/questions/10135697/regex-to-parse-any-css-font\nvar fontRegex = new RegExp([\n  '^\\\\s*(?=(?:(?:[-a-z]+\\\\s*){0,2}(italic|oblique))?)',\n  '(?=(?:(?:[-a-z]+\\\\s*){0,2}(small-caps))?)',\n  '(?=(?:(?:[-a-z]+\\\\s*){0,2}(bold(?:er)?|lighter|[1-9]00 ))?)',\n  '(?:(?:normal|\\\\1|\\\\2|\\\\3)\\\\s*){0,3}((?:xx?-)?',\n  '(?:small|large)|medium|smaller|larger|[\\\\.\\\\d]+(?:\\\\%|in|[cem]m|ex|p[ctx]))',\n  '(?:\\\\s*\\\\/\\\\s*(normal|[\\\\.\\\\d]+(?:\\\\%|in|[cem]m|ex|p[ctx])?))',\n  '?\\\\s*([-,\\\\\"\\\\\\'\\\\sa-z]+?)\\\\s*$'\n].join(''), 'i');\n\n\nvar mapping = [\n  'style',\n  'variant',\n  'weight',\n  'size',\n  'lineHeight',\n  'family'\n];\n\nvar unitMatch = /([\\.0-9]+)(.*)/;\n\nvar numeric = function(val, parent, dpi) {\n\n  var matches = val.match(unitMatch);\n\n  if (!matches) {\n    return;\n  }\n\n  val = parseFloat(matches[1]);\n  var units = matches[2].toLowerCase().trim();\n\n  var v = Math.round(val);\n  if (v === val) {\n    val = v;\n  }\n\n  switch (units) {\n    case 'em':\n      if (parent === null) {\n        return;\n      }\n\n      return val * parent;\n    break;\n\n    case 'px':\n      return val;\n    break;\n\n    case 'pt':\n      return val / (72/dpi);\n    break;\n\n    case 'pc':\n      return val / (6/dpi);\n    break;\n\n    case 'mm':\n      return val * (dpi/25.4)\n    break;\n\n    case 'cm':\n      return val * (dpi/2.54)\n    break;\n\n    case 'in':\n      return val * dpi;\n    break;\n\n    case '%':\n      if (parent === null) {\n        return;\n      }\n      return parent * (val/100);\n    break;\n\n  }\n};\n\nvar op = {\n  size: numeric,\n  lineHeight: numeric\n};\n\nvar generics = {\n  serif : 1,\n  'sans-serif': 1,\n  cursive: 1,\n  fantasy: 1,\n  monospace: 1\n};\n\nvar parse = module.exports = function(str, existing, dpi) {\n  var cacheKey = str + '-' + (existing || 'null') +'@' + dpi;\n\n  dpi = dpi || 96.0;\n\n  if (typeof cache[cacheKey] !== 'undefined') {\n    return cache[cacheKey];\n  }\n\n  if (existing) {\n    existing = parse(existing, null, dpi);\n  }\n\n  if (str === 'inherit') {\n    return existing;\n  }\n\n  var matches = fontRegex.exec(str);\n\n  if (!matches) {\n    cache[cacheKey] = null;\n    return;\n  }\n\n  matches.shift();\n\n  var collected = {};\n  for (var i=0; i<matches.length; i++) {\n    var key = mapping[i];\n    var val = matches[i];\n\n    if (op[key] && val) {\n      var existingVal = (existing) ? existing[key] || null : null;\n      var v = op[key](val, existingVal, dpi);\n      if (typeof v === 'undefined' && key === 'lineHeight' && val) {\n        val = collected.size * parseFloat(val);\n      } else {\n        val = v;\n      }\n    }\n\n\n    if (!val || val === 'normal') {\n      continue;\n    } else if (val === 'inherit') {\n\n      if (!existing) {\n        return;\n      }\n\n      val = existing[key];\n    }\n\n    if (val.trim) {\n      val = val.trim();\n    }\n\n    collected[key] = val;\n  }\n\n  if (!Object.keys(collected).length) {\n    collected = null;\n  }\n\n  cache[cacheKey] = collected;\n\n  var out = [];\n  if (collected.style) {\n    out.push(collected.style);\n  }\n\n  if (collected.variant) {\n    out.push(collected.variant);\n  }\n\n  if (collected.weight &&\n      collected.weight !== '400' &&\n      collected.weight !== 'normal')\n  {\n    out.push(collected.weight);\n  }\n\n  out.push(collected.size + 'px');\n\n  if (collected.lineHeight) {\n    out[out.length-1] += '/' + collected.lineHeight + 'px';\n  }\n\n  var family = collected.family.split(',');\n  collected.family = family.map(function(a) {\n    a = a.trim();\n\n    if (generics[a.toLowerCase()]) {\n      a = a.toLowerCase();\n    }\n\n    return a;\n  });\n\n  out.push(collected.family);\n\n\n  Object.defineProperty(collected, 'toString', {\n    value: function() {\n      return out.map(function(val) {\n        if (Array.isArray(val)) {\n          return val.map(function(a) {\n            if (a.indexOf(' ') > -1) {\n              return '\"' + a.replace(/[\"']/g, '') + '\"';\n            } else {\n              return a;\n            }\n          }).join(', ');\n        } else {\n          return val;\n        }\n      }).join(' ');\n    }\n  });\n\n  return collected;\n};\n\nmodule.exports.generics = generics;\n"],"mappings":"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"}