316b46aba992610b9c3f7f4728140ae4
"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.getNextKeyDef = getNextKeyDef;
var bracketDict;
(function (bracketDict) {
  bracketDict["{"] = "}";
  bracketDict["["] = "]";
})(bracketDict || (bracketDict = {}));
var legacyModifiers;
(function (legacyModifiers) {
  legacyModifiers["alt"] = "alt";
  legacyModifiers["ctrl"] = "ctrl";
  legacyModifiers["meta"] = "meta";
  legacyModifiers["shift"] = "shift";
})(legacyModifiers || (legacyModifiers = {}));
var legacyKeyMap;
/**
 * Get the next key from keyMap
 *
 * Keys can be referenced by `{key}` or `{special}` as well as physical locations per `[code]`.
 * Everything else will be interpreted as a typed character - e.g. `a`.
 * Brackets `{` and `[` can be escaped by doubling - e.g. `foo[[bar` translates to `foo[bar`.
 * Keeping the key pressed can be written as `{key>}`.
 * When keeping the key pressed you can choose how long (how many keydown and keypress) the key is pressed `{key>3}`.
 * You can then release the key per `{key>3/}` or keep it pressed and continue with the next key.
 * Modifiers like `{shift}` imply being kept pressed. This can be turned of per `{shift/}`.
 */

(function (legacyKeyMap) {
  legacyKeyMap["ctrl"] = "Control";
  legacyKeyMap["del"] = "Delete";
  legacyKeyMap["esc"] = "Escape";
  legacyKeyMap["space"] = " ";
})(legacyKeyMap || (legacyKeyMap = {}));
function getNextKeyDef(text, options) {
  var _options$keyboardMap$;
  const {
    type,
    descriptor,
    consumedLength,
    releasePrevious,
    releaseSelf,
    repeat
  } = readNextDescriptor(text);
  const keyDef = (_options$keyboardMap$ = options.keyboardMap.find(def => {
    if (type === '[') {
      var _def$code;
      return ((_def$code = def.code) == null ? void 0 : _def$code.toLowerCase()) === descriptor.toLowerCase();
    } else if (type === '{') {
      var _def$key;
      const key = mapLegacyKey(descriptor);
      return ((_def$key = def.key) == null ? void 0 : _def$key.toLowerCase()) === key.toLowerCase();
    }
    return def.key === descriptor;
  })) != null ? _options$keyboardMap$ : {
    key: 'Unknown',
    code: 'Unknown',
    [type === '[' ? 'code' : 'key']: descriptor
  };
  return {
    keyDef,
    consumedLength,
    releasePrevious,
    releaseSelf,
    repeat
  };
}
function readNextDescriptor(text) {
  let pos = 0;
  const startBracket = text[pos] in bracketDict ? text[pos] : '';
  pos += startBracket.length; // `foo{{bar` is an escaped char at position 3,
  // but `foo{{{>5}bar` should be treated as `{` pressed down for 5 keydowns.

  const startBracketRepeated = startBracket ? text.match(new RegExp(`^\\${startBracket}+`))[0].length : 0;
  const isEscapedChar = startBracketRepeated === 2 || startBracket === '{' && startBracketRepeated > 3;
  const type = isEscapedChar ? '' : startBracket;
  return {
    type,
    ...(type === '' ? readPrintableChar(text, pos) : readTag(text, pos, type))
  };
}
function readPrintableChar(text, pos) {
  const descriptor = text[pos];
  assertDescriptor(descriptor, text, pos);
  pos += descriptor.length;
  return {
    consumedLength: pos,
    descriptor,
    releasePrevious: false,
    releaseSelf: true,
    repeat: 1
  };
}
function readTag(text, pos, startBracket) {
  var _text$slice$match, _text$slice$match$, _text$slice$match2;
  const releasePreviousModifier = text[pos] === '/' ? '/' : '';
  pos += releasePreviousModifier.length;
  const descriptor = (_text$slice$match = text.slice(pos).match(/^\w+/)) == null ? void 0 : _text$slice$match[0];
  assertDescriptor(descriptor, text, pos);
  pos += descriptor.length;
  const repeatModifier = (_text$slice$match$ = (_text$slice$match2 = text.slice(pos).match(/^>\d+/)) == null ? void 0 : _text$slice$match2[0]) != null ? _text$slice$match$ : '';
  pos += repeatModifier.length;
  const releaseSelfModifier = text[pos] === '/' || !repeatModifier && text[pos] === '>' ? text[pos] : '';
  pos += releaseSelfModifier.length;
  const expectedEndBracket = bracketDict[startBracket];
  const endBracket = text[pos] === expectedEndBracket ? expectedEndBracket : '';
  if (!endBracket) {
    throw new Error(getErrorMessage([!repeatModifier && 'repeat modifier', !releaseSelfModifier && 'release modifier', `"${expectedEndBracket}"`].filter(Boolean).join(' or '), text[pos], text));
  }
  pos += endBracket.length;
  return {
    consumedLength: pos,
    descriptor,
    releasePrevious: !!releasePreviousModifier,
    repeat: repeatModifier ? Math.max(Number(repeatModifier.substr(1)), 1) : 1,
    releaseSelf: hasReleaseSelf(startBracket, descriptor, releaseSelfModifier, repeatModifier)
  };
}
function assertDescriptor(descriptor, text, pos) {
  if (!descriptor) {
    throw new Error(getErrorMessage('key descriptor', text[pos], text));
  }
}
function getEnumValue(f, key) {
  return f[key];
}
function hasReleaseSelf(startBracket, descriptor, releaseSelfModifier, repeatModifier) {
  if (releaseSelfModifier) {
    return releaseSelfModifier === '/';
  }
  if (repeatModifier) {
    return false;
  }
  if (startBracket === '{' && getEnumValue(legacyModifiers, descriptor.toLowerCase())) {
    return false;
  }
  return true;
}
function mapLegacyKey(descriptor) {
  var _getEnumValue;
  return (_getEnumValue = getEnumValue(legacyKeyMap, descriptor)) != null ? _getEnumValue : descriptor;
}
function getErrorMessage(expected, found, text) {
  return `Expected ${expected} but found "${found != null ? found : ''}" in "${text}"
    See https://github.com/testing-library/user-event/blob/main/README.md#keyboardtext-options
    for more information about how userEvent parses your input.`;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJPYmplY3QiLCJkZWZpbmVQcm9wZXJ0eSIsImV4cG9ydHMiLCJ2YWx1ZSIsImdldE5leHRLZXlEZWYiLCJicmFja2V0RGljdCIsImxlZ2FjeU1vZGlmaWVycyIsImxlZ2FjeUtleU1hcCIsInRleHQiLCJvcHRpb25zIiwiX29wdGlvbnMka2V5Ym9hcmRNYXAkIiwidHlwZSIsImRlc2NyaXB0b3IiLCJjb25zdW1lZExlbmd0aCIsInJlbGVhc2VQcmV2aW91cyIsInJlbGVhc2VTZWxmIiwicmVwZWF0IiwicmVhZE5leHREZXNjcmlwdG9yIiwia2V5RGVmIiwia2V5Ym9hcmRNYXAiLCJmaW5kIiwiZGVmIiwiX2RlZiRjb2RlIiwiY29kZSIsInRvTG93ZXJDYXNlIiwiX2RlZiRrZXkiLCJrZXkiLCJtYXBMZWdhY3lLZXkiLCJwb3MiLCJzdGFydEJyYWNrZXQiLCJsZW5ndGgiLCJzdGFydEJyYWNrZXRSZXBlYXRlZCIsIm1hdGNoIiwiUmVnRXhwIiwiaXNFc2NhcGVkQ2hhciIsInJlYWRQcmludGFibGVDaGFyIiwicmVhZFRhZyIsImFzc2VydERlc2NyaXB0b3IiLCJfdGV4dCRzbGljZSRtYXRjaCIsIl90ZXh0JHNsaWNlJG1hdGNoJCIsIl90ZXh0JHNsaWNlJG1hdGNoMiIsInJlbGVhc2VQcmV2aW91c01vZGlmaWVyIiwic2xpY2UiLCJyZXBlYXRNb2RpZmllciIsInJlbGVhc2VTZWxmTW9kaWZpZXIiLCJleHBlY3RlZEVuZEJyYWNrZXQiLCJlbmRCcmFja2V0IiwiRXJyb3IiLCJnZXRFcnJvck1lc3NhZ2UiLCJmaWx0ZXIiLCJCb29sZWFuIiwiam9pbiIsIk1hdGgiLCJtYXgiLCJOdW1iZXIiLCJzdWJzdHIiLCJoYXNSZWxlYXNlU2VsZiIsImdldEVudW1WYWx1ZSIsImYiLCJfZ2V0RW51bVZhbHVlIiwiZXhwZWN0ZWQiLCJmb3VuZCJdLCJzb3VyY2VzIjpbImdldE5leHRLZXlEZWYuanMiXSwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG5cbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwge1xuICB2YWx1ZTogdHJ1ZVxufSk7XG5leHBvcnRzLmdldE5leHRLZXlEZWYgPSBnZXROZXh0S2V5RGVmO1xudmFyIGJyYWNrZXREaWN0O1xuXG4oZnVuY3Rpb24gKGJyYWNrZXREaWN0KSB7XG4gIGJyYWNrZXREaWN0W1wie1wiXSA9IFwifVwiO1xuICBicmFja2V0RGljdFtcIltcIl0gPSBcIl1cIjtcbn0pKGJyYWNrZXREaWN0IHx8IChicmFja2V0RGljdCA9IHt9KSk7XG5cbnZhciBsZWdhY3lNb2RpZmllcnM7XG5cbihmdW5jdGlvbiAobGVnYWN5TW9kaWZpZXJzKSB7XG4gIGxlZ2FjeU1vZGlmaWVyc1tcImFsdFwiXSA9IFwiYWx0XCI7XG4gIGxlZ2FjeU1vZGlmaWVyc1tcImN0cmxcIl0gPSBcImN0cmxcIjtcbiAgbGVnYWN5TW9kaWZpZXJzW1wibWV0YVwiXSA9IFwibWV0YVwiO1xuICBsZWdhY3lNb2RpZmllcnNbXCJzaGlmdFwiXSA9IFwic2hpZnRcIjtcbn0pKGxlZ2FjeU1vZGlmaWVycyB8fCAobGVnYWN5TW9kaWZpZXJzID0ge30pKTtcblxudmFyIGxlZ2FjeUtleU1hcDtcbi8qKlxuICogR2V0IHRoZSBuZXh0IGtleSBmcm9tIGtleU1hcFxuICpcbiAqIEtleXMgY2FuIGJlIHJlZmVyZW5jZWQgYnkgYHtrZXl9YCBvciBge3NwZWNpYWx9YCBhcyB3ZWxsIGFzIHBoeXNpY2FsIGxvY2F0aW9ucyBwZXIgYFtjb2RlXWAuXG4gKiBFdmVyeXRoaW5nIGVsc2Ugd2lsbCBiZSBpbnRlcnByZXRlZCBhcyBhIHR5cGVkIGNoYXJhY3RlciAtIGUuZy4gYGFgLlxuICogQnJhY2tldHMgYHtgIGFuZCBgW2AgY2FuIGJlIGVzY2FwZWQgYnkgZG91YmxpbmcgLSBlLmcuIGBmb29bW2JhcmAgdHJhbnNsYXRlcyB0byBgZm9vW2JhcmAuXG4gKiBLZWVwaW5nIHRoZSBrZXkgcHJlc3NlZCBjYW4gYmUgd3JpdHRlbiBhcyBge2tleT59YC5cbiAqIFdoZW4ga2VlcGluZyB0aGUga2V5IHByZXNzZWQgeW91IGNhbiBjaG9vc2UgaG93IGxvbmcgKGhvdyBtYW55IGtleWRvd24gYW5kIGtleXByZXNzKSB0aGUga2V5IGlzIHByZXNzZWQgYHtrZXk+M31gLlxuICogWW91IGNhbiB0aGVuIHJlbGVhc2UgdGhlIGtleSBwZXIgYHtrZXk+My99YCBvciBrZWVwIGl0IHByZXNzZWQgYW5kIGNvbnRpbnVlIHdpdGggdGhlIG5leHQga2V5LlxuICogTW9kaWZpZXJzIGxpa2UgYHtzaGlmdH1gIGltcGx5IGJlaW5nIGtlcHQgcHJlc3NlZC4gVGhpcyBjYW4gYmUgdHVybmVkIG9mIHBlciBge3NoaWZ0L31gLlxuICovXG5cbihmdW5jdGlvbiAobGVnYWN5S2V5TWFwKSB7XG4gIGxlZ2FjeUtleU1hcFtcImN0cmxcIl0gPSBcIkNvbnRyb2xcIjtcbiAgbGVnYWN5S2V5TWFwW1wiZGVsXCJdID0gXCJEZWxldGVcIjtcbiAgbGVnYWN5S2V5TWFwW1wiZXNjXCJdID0gXCJFc2NhcGVcIjtcbiAgbGVnYWN5S2V5TWFwW1wic3BhY2VcIl0gPSBcIiBcIjtcbn0pKGxlZ2FjeUtleU1hcCB8fCAobGVnYWN5S2V5TWFwID0ge30pKTtcblxuZnVuY3Rpb24gZ2V0TmV4dEtleURlZih0ZXh0LCBvcHRpb25zKSB7XG4gIHZhciBfb3B0aW9ucyRrZXlib2FyZE1hcCQ7XG5cbiAgY29uc3Qge1xuICAgIHR5cGUsXG4gICAgZGVzY3JpcHRvcixcbiAgICBjb25zdW1lZExlbmd0aCxcbiAgICByZWxlYXNlUHJldmlvdXMsXG4gICAgcmVsZWFzZVNlbGYsXG4gICAgcmVwZWF0XG4gIH0gPSByZWFkTmV4dERlc2NyaXB0b3IodGV4dCk7XG4gIGNvbnN0IGtleURlZiA9IChfb3B0aW9ucyRrZXlib2FyZE1hcCQgPSBvcHRpb25zLmtleWJvYXJkTWFwLmZpbmQoZGVmID0+IHtcbiAgICBpZiAodHlwZSA9PT0gJ1snKSB7XG4gICAgICB2YXIgX2RlZiRjb2RlO1xuXG4gICAgICByZXR1cm4gKChfZGVmJGNvZGUgPSBkZWYuY29kZSkgPT0gbnVsbCA/IHZvaWQgMCA6IF9kZWYkY29kZS50b0xvd2VyQ2FzZSgpKSA9PT0gZGVzY3JpcHRvci50b0xvd2VyQ2FzZSgpO1xuICAgIH0gZWxzZSBpZiAodHlwZSA9PT0gJ3snKSB7XG4gICAgICB2YXIgX2RlZiRrZXk7XG5cbiAgICAgIGNvbnN0IGtleSA9IG1hcExlZ2FjeUtleShkZXNjcmlwdG9yKTtcbiAgICAgIHJldHVybiAoKF9kZWYka2V5ID0gZGVmLmtleSkgPT0gbnVsbCA/IHZvaWQgMCA6IF9kZWYka2V5LnRvTG93ZXJDYXNlKCkpID09PSBrZXkudG9Mb3dlckNhc2UoKTtcbiAgICB9XG5cbiAgICByZXR1cm4gZGVmLmtleSA9PT0gZGVzY3JpcHRvcjtcbiAgfSkpICE9IG51bGwgPyBfb3B0aW9ucyRrZXlib2FyZE1hcCQgOiB7XG4gICAga2V5OiAnVW5rbm93bicsXG4gICAgY29kZTogJ1Vua25vd24nLFxuICAgIFt0eXBlID09PSAnWycgPyAnY29kZScgOiAna2V5J106IGRlc2NyaXB0b3JcbiAgfTtcbiAgcmV0dXJuIHtcbiAgICBrZXlEZWYsXG4gICAgY29uc3VtZWRMZW5ndGgsXG4gICAgcmVsZWFzZVByZXZpb3VzLFxuICAgIHJlbGVhc2VTZWxmLFxuICAgIHJlcGVhdFxuICB9O1xufVxuXG5mdW5jdGlvbiByZWFkTmV4dERlc2NyaXB0b3IodGV4dCkge1xuICBsZXQgcG9zID0gMDtcbiAgY29uc3Qgc3RhcnRCcmFja2V0ID0gdGV4dFtwb3NdIGluIGJyYWNrZXREaWN0ID8gdGV4dFtwb3NdIDogJyc7XG4gIHBvcyArPSBzdGFydEJyYWNrZXQubGVuZ3RoOyAvLyBgZm9ve3tiYXJgIGlzIGFuIGVzY2FwZWQgY2hhciBhdCBwb3NpdGlvbiAzLFxuICAvLyBidXQgYGZvb3t7ez41fWJhcmAgc2hvdWxkIGJlIHRyZWF0ZWQgYXMgYHtgIHByZXNzZWQgZG93biBmb3IgNSBrZXlkb3ducy5cblxuICBjb25zdCBzdGFydEJyYWNrZXRSZXBlYXRlZCA9IHN0YXJ0QnJhY2tldCA/IHRleHQubWF0Y2gobmV3IFJlZ0V4cChgXlxcXFwke3N0YXJ0QnJhY2tldH0rYCkpWzBdLmxlbmd0aCA6IDA7XG4gIGNvbnN0IGlzRXNjYXBlZENoYXIgPSBzdGFydEJyYWNrZXRSZXBlYXRlZCA9PT0gMiB8fCBzdGFydEJyYWNrZXQgPT09ICd7JyAmJiBzdGFydEJyYWNrZXRSZXBlYXRlZCA+IDM7XG4gIGNvbnN0IHR5cGUgPSBpc0VzY2FwZWRDaGFyID8gJycgOiBzdGFydEJyYWNrZXQ7XG4gIHJldHVybiB7XG4gICAgdHlwZSxcbiAgICAuLi4odHlwZSA9PT0gJycgPyByZWFkUHJpbnRhYmxlQ2hhcih0ZXh0LCBwb3MpIDogcmVhZFRhZyh0ZXh0LCBwb3MsIHR5cGUpKVxuICB9O1xufVxuXG5mdW5jdGlvbiByZWFkUHJpbnRhYmxlQ2hhcih0ZXh0LCBwb3MpIHtcbiAgY29uc3QgZGVzY3JpcHRvciA9IHRleHRbcG9zXTtcbiAgYXNzZXJ0RGVzY3JpcHRvcihkZXNjcmlwdG9yLCB0ZXh0LCBwb3MpO1xuICBwb3MgKz0gZGVzY3JpcHRvci5sZW5ndGg7XG4gIHJldHVybiB7XG4gICAgY29uc3VtZWRMZW5ndGg6IHBvcyxcbiAgICBkZXNjcmlwdG9yLFxuICAgIHJlbGVhc2VQcmV2aW91czogZmFsc2UsXG4gICAgcmVsZWFzZVNlbGY6IHRydWUsXG4gICAgcmVwZWF0OiAxXG4gIH07XG59XG5cbmZ1bmN0aW9uIHJlYWRUYWcodGV4dCwgcG9zLCBzdGFydEJyYWNrZXQpIHtcbiAgdmFyIF90ZXh0JHNsaWNlJG1hdGNoLCBfdGV4dCRzbGljZSRtYXRjaCQsIF90ZXh0JHNsaWNlJG1hdGNoMjtcblxuICBjb25zdCByZWxlYXNlUHJldmlvdXNNb2RpZmllciA9IHRleHRbcG9zXSA9PT0gJy8nID8gJy8nIDogJyc7XG4gIHBvcyArPSByZWxlYXNlUHJldmlvdXNNb2RpZmllci5sZW5ndGg7XG4gIGNvbnN0IGRlc2NyaXB0b3IgPSAoX3RleHQkc2xpY2UkbWF0Y2ggPSB0ZXh0LnNsaWNlKHBvcykubWF0Y2goL15cXHcrLykpID09IG51bGwgPyB2b2lkIDAgOiBfdGV4dCRzbGljZSRtYXRjaFswXTtcbiAgYXNzZXJ0RGVzY3JpcHRvcihkZXNjcmlwdG9yLCB0ZXh0LCBwb3MpO1xuICBwb3MgKz0gZGVzY3JpcHRvci5sZW5ndGg7XG4gIGNvbnN0IHJlcGVhdE1vZGlmaWVyID0gKF90ZXh0JHNsaWNlJG1hdGNoJCA9IChfdGV4dCRzbGljZSRtYXRjaDIgPSB0ZXh0LnNsaWNlKHBvcykubWF0Y2goL14+XFxkKy8pKSA9PSBudWxsID8gdm9pZCAwIDogX3RleHQkc2xpY2UkbWF0Y2gyWzBdKSAhPSBudWxsID8gX3RleHQkc2xpY2UkbWF0Y2gkIDogJyc7XG4gIHBvcyArPSByZXBlYXRNb2RpZmllci5sZW5ndGg7XG4gIGNvbnN0IHJlbGVhc2VTZWxmTW9kaWZpZXIgPSB0ZXh0W3Bvc10gPT09ICcvJyB8fCAhcmVwZWF0TW9kaWZpZXIgJiYgdGV4dFtwb3NdID09PSAnPicgPyB0ZXh0W3Bvc10gOiAnJztcbiAgcG9zICs9IHJlbGVhc2VTZWxmTW9kaWZpZXIubGVuZ3RoO1xuICBjb25zdCBleHBlY3RlZEVuZEJyYWNrZXQgPSBicmFja2V0RGljdFtzdGFydEJyYWNrZXRdO1xuICBjb25zdCBlbmRCcmFja2V0ID0gdGV4dFtwb3NdID09PSBleHBlY3RlZEVuZEJyYWNrZXQgPyBleHBlY3RlZEVuZEJyYWNrZXQgOiAnJztcblxuICBpZiAoIWVuZEJyYWNrZXQpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoZ2V0RXJyb3JNZXNzYWdlKFshcmVwZWF0TW9kaWZpZXIgJiYgJ3JlcGVhdCBtb2RpZmllcicsICFyZWxlYXNlU2VsZk1vZGlmaWVyICYmICdyZWxlYXNlIG1vZGlmaWVyJywgYFwiJHtleHBlY3RlZEVuZEJyYWNrZXR9XCJgXS5maWx0ZXIoQm9vbGVhbikuam9pbignIG9yICcpLCB0ZXh0W3Bvc10sIHRleHQpKTtcbiAgfVxuXG4gIHBvcyArPSBlbmRCcmFja2V0Lmxlbmd0aDtcbiAgcmV0dXJuIHtcbiAgICBjb25zdW1lZExlbmd0aDogcG9zLFxuICAgIGRlc2NyaXB0b3IsXG4gICAgcmVsZWFzZVByZXZpb3VzOiAhIXJlbGVhc2VQcmV2aW91c01vZGlmaWVyLFxuICAgIHJlcGVhdDogcmVwZWF0TW9kaWZpZXIgPyBNYXRoLm1heChOdW1iZXIocmVwZWF0TW9kaWZpZXIuc3Vic3RyKDEpKSwgMSkgOiAxLFxuICAgIHJlbGVhc2VTZWxmOiBoYXNSZWxlYXNlU2VsZihzdGFydEJyYWNrZXQsIGRlc2NyaXB0b3IsIHJlbGVhc2VTZWxmTW9kaWZpZXIsIHJlcGVhdE1vZGlmaWVyKVxuICB9O1xufVxuXG5mdW5jdGlvbiBhc3NlcnREZXNjcmlwdG9yKGRlc2NyaXB0b3IsIHRleHQsIHBvcykge1xuICBpZiAoIWRlc2NyaXB0b3IpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoZ2V0RXJyb3JNZXNzYWdlKCdrZXkgZGVzY3JpcHRvcicsIHRleHRbcG9zXSwgdGV4dCkpO1xuICB9XG59XG5cbmZ1bmN0aW9uIGdldEVudW1WYWx1ZShmLCBrZXkpIHtcbiAgcmV0dXJuIGZba2V5XTtcbn1cblxuZnVuY3Rpb24gaGFzUmVsZWFzZVNlbGYoc3RhcnRCcmFja2V0LCBkZXNjcmlwdG9yLCByZWxlYXNlU2VsZk1vZGlmaWVyLCByZXBlYXRNb2RpZmllcikge1xuICBpZiAocmVsZWFzZVNlbGZNb2RpZmllcikge1xuICAgIHJldHVybiByZWxlYXNlU2VsZk1vZGlmaWVyID09PSAnLyc7XG4gIH1cblxuICBpZiAocmVwZWF0TW9kaWZpZXIpIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cblxuICBpZiAoc3RhcnRCcmFja2V0ID09PSAneycgJiYgZ2V0RW51bVZhbHVlKGxlZ2FjeU1vZGlmaWVycywgZGVzY3JpcHRvci50b0xvd2VyQ2FzZSgpKSkge1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuXG4gIHJldHVybiB0cnVlO1xufVxuXG5mdW5jdGlvbiBtYXBMZWdhY3lLZXkoZGVzY3JpcHRvcikge1xuICB2YXIgX2dldEVudW1WYWx1ZTtcblxuICByZXR1cm4gKF9nZXRFbnVtVmFsdWUgPSBnZXRFbnVtVmFsdWUobGVnYWN5S2V5TWFwLCBkZXNjcmlwdG9yKSkgIT0gbnVsbCA/IF9nZXRFbnVtVmFsdWUgOiBkZXNjcmlwdG9yO1xufVxuXG5mdW5jdGlvbiBnZXRFcnJvck1lc3NhZ2UoZXhwZWN0ZWQsIGZvdW5kLCB0ZXh0KSB7XG4gIHJldHVybiBgRXhwZWN0ZWQgJHtleHBlY3RlZH0gYnV0IGZvdW5kIFwiJHtmb3VuZCAhPSBudWxsID8gZm91bmQgOiAnJ31cIiBpbiBcIiR7dGV4dH1cIlxuICAgIFNlZSBodHRwczovL2dpdGh1Yi5jb20vdGVzdGluZy1saWJyYXJ5L3VzZXItZXZlbnQvYmxvYi9tYWluL1JFQURNRS5tZCNrZXlib2FyZHRleHQtb3B0aW9uc1xuICAgIGZvciBtb3JlIGluZm9ybWF0aW9uIGFib3V0IGhvdyB1c2VyRXZlbnQgcGFyc2VzIHlvdXIgaW5wdXQuYDtcbn0iXSwibWFwcGluZ3MiOiJBQUFBLFlBQVk7O0FBRVpBLE1BQU0sQ0FBQ0MsY0FBYyxDQUFDQyxPQUFPLEVBQUUsWUFBWSxFQUFFO0VBQzNDQyxLQUFLLEVBQUU7QUFDVCxDQUFDLENBQUM7QUFDRkQsT0FBTyxDQUFDRSxhQUFhLEdBQUdBLGFBQWE7QUFDckMsSUFBSUMsV0FBVztBQUVmLENBQUMsVUFBVUEsV0FBVyxFQUFFO0VBQ3RCQSxXQUFXLENBQUMsR0FBRyxDQUFDLEdBQUcsR0FBRztFQUN0QkEsV0FBVyxDQUFDLEdBQUcsQ0FBQyxHQUFHLEdBQUc7QUFDeEIsQ0FBQyxFQUFFQSxXQUFXLEtBQUtBLFdBQVcsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDO0FBRXJDLElBQUlDLGVBQWU7QUFFbkIsQ0FBQyxVQUFVQSxlQUFlLEVBQUU7RUFDMUJBLGVBQWUsQ0FBQyxLQUFLLENBQUMsR0FBRyxLQUFLO0VBQzlCQSxlQUFlLENBQUMsTUFBTSxDQUFDLEdBQUcsTUFBTTtFQUNoQ0EsZUFBZSxDQUFDLE1BQU0sQ0FBQyxHQUFHLE1BQU07RUFDaENBLGVBQWUsQ0FBQyxPQUFPLENBQUMsR0FBRyxPQUFPO0FBQ3BDLENBQUMsRUFBRUEsZUFBZSxLQUFLQSxlQUFlLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQztBQUU3QyxJQUFJQyxZQUFZO0FBQ2hCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsQ0FBQyxVQUFVQSxZQUFZLEVBQUU7RUFDdkJBLFlBQVksQ0FBQyxNQUFNLENBQUMsR0FBRyxTQUFTO0VBQ2hDQSxZQUFZLENBQUMsS0FBSyxDQUFDLEdBQUcsUUFBUTtFQUM5QkEsWUFBWSxDQUFDLEtBQUssQ0FBQyxHQUFHLFFBQVE7RUFDOUJBLFlBQVksQ0FBQyxPQUFPLENBQUMsR0FBRyxHQUFHO0FBQzdCLENBQUMsRUFBRUEsWUFBWSxLQUFLQSxZQUFZLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQztBQUV2QyxTQUFTSCxhQUFhQSxDQUFDSSxJQUFJLEVBQUVDLE9BQU8sRUFBRTtFQUNwQyxJQUFJQyxxQkFBcUI7RUFFekIsTUFBTTtJQUNKQyxJQUFJO0lBQ0pDLFVBQVU7SUFDVkMsY0FBYztJQUNkQyxlQUFlO0lBQ2ZDLFdBQVc7SUFDWEM7RUFDRixDQUFDLEdBQUdDLGtCQUFrQixDQUFDVCxJQUFJLENBQUM7RUFDNUIsTUFBTVUsTUFBTSxHQUFHLENBQUNSLHFCQUFxQixHQUFHRCxPQUFPLENBQUNVLFdBQVcsQ0FBQ0MsSUFBSSxDQUFDQyxHQUFHLElBQUk7SUFDdEUsSUFBSVYsSUFBSSxLQUFLLEdBQUcsRUFBRTtNQUNoQixJQUFJVyxTQUFTO01BRWIsT0FBTyxDQUFDLENBQUNBLFNBQVMsR0FBR0QsR0FBRyxDQUFDRSxJQUFJLEtBQUssSUFBSSxHQUFHLEtBQUssQ0FBQyxHQUFHRCxTQUFTLENBQUNFLFdBQVcsRUFBRSxNQUFNWixVQUFVLENBQUNZLFdBQVcsRUFBRTtJQUN6RyxDQUFDLE1BQU0sSUFBSWIsSUFBSSxLQUFLLEdBQUcsRUFBRTtNQUN2QixJQUFJYyxRQUFRO01BRVosTUFBTUMsR0FBRyxHQUFHQyxZQUFZLENBQUNmLFVBQVUsQ0FBQztNQUNwQyxPQUFPLENBQUMsQ0FBQ2EsUUFBUSxHQUFHSixHQUFHLENBQUNLLEdBQUcsS0FBSyxJQUFJLEdBQUcsS0FBSyxDQUFDLEdBQUdELFFBQVEsQ0FBQ0QsV0FBVyxFQUFFLE1BQU1FLEdBQUcsQ0FBQ0YsV0FBVyxFQUFFO0lBQy9GO0lBRUEsT0FBT0gsR0FBRyxDQUFDSyxHQUFHLEtBQUtkLFVBQVU7RUFDL0IsQ0FBQyxDQUFDLEtBQUssSUFBSSxHQUFHRixxQkFBcUIsR0FBRztJQUNwQ2dCLEdBQUcsRUFBRSxTQUFTO0lBQ2RILElBQUksRUFBRSxTQUFTO0lBQ2YsQ0FBQ1osSUFBSSxLQUFLLEdBQUcsR0FBRyxNQUFNLEdBQUcsS0FBSyxHQUFHQztFQUNuQyxDQUFDO0VBQ0QsT0FBTztJQUNMTSxNQUFNO0lBQ05MLGNBQWM7SUFDZEMsZUFBZTtJQUNmQyxXQUFXO0lBQ1hDO0VBQ0YsQ0FBQztBQUNIO0FBRUEsU0FBU0Msa0JBQWtCQSxDQUFDVCxJQUFJLEVBQUU7RUFDaEMsSUFBSW9CLEdBQUcsR0FBRyxDQUFDO0VBQ1gsTUFBTUMsWUFBWSxHQUFHckIsSUFBSSxDQUFDb0IsR0FBRyxDQUFDLElBQUl2QixXQUFXLEdBQUdHLElBQUksQ0FBQ29CLEdBQUcsQ0FBQyxHQUFHLEVBQUU7RUFDOURBLEdBQUcsSUFBSUMsWUFBWSxDQUFDQyxNQUFNLENBQUMsQ0FBQztFQUM1Qjs7RUFFQSxNQUFNQyxvQkFBb0IsR0FBR0YsWUFBWSxHQUFHckIsSUFBSSxDQUFDd0IsS0FBSyxDQUFDLElBQUlDLE1BQU0sQ0FBRSxNQUFLSixZQUFhLEdBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUNDLE1BQU0sR0FBRyxDQUFDO0VBQ3ZHLE1BQU1JLGFBQWEsR0FBR0gsb0JBQW9CLEtBQUssQ0FBQyxJQUFJRixZQUFZLEtBQUssR0FBRyxJQUFJRSxvQkFBb0IsR0FBRyxDQUFDO0VBQ3BHLE1BQU1wQixJQUFJLEdBQUd1QixhQUFhLEdBQUcsRUFBRSxHQUFHTCxZQUFZO0VBQzlDLE9BQU87SUFDTGxCLElBQUk7SUFDSixJQUFJQSxJQUFJLEtBQUssRUFBRSxHQUFHd0IsaUJBQWlCLENBQUMzQixJQUFJLEVBQUVvQixHQUFHLENBQUMsR0FBR1EsT0FBTyxDQUFDNUIsSUFBSSxFQUFFb0IsR0FBRyxFQUFFakIsSUFBSSxDQUFDO0VBQzNFLENBQUM7QUFDSDtBQUVBLFNBQVN3QixpQkFBaUJBLENBQUMzQixJQUFJLEVBQUVvQixHQUFHLEVBQUU7RUFDcEMsTUFBTWhCLFVBQVUsR0FBR0osSUFBSSxDQUFDb0IsR0FBRyxDQUFDO0VBQzVCUyxnQkFBZ0IsQ0FBQ3pCLFVBQVUsRUFBRUosSUFBSSxFQUFFb0IsR0FBRyxDQUFDO0VBQ3ZDQSxHQUFHLElBQUloQixVQUFVLENBQUNrQixNQUFNO0VBQ3hCLE9BQU87SUFDTGpCLGNBQWMsRUFBRWUsR0FBRztJQUNuQmhCLFVBQVU7SUFDVkUsZUFBZSxFQUFFLEtBQUs7SUFDdEJDLFdBQVcsRUFBRSxJQUFJO0lBQ2pCQyxNQUFNLEVBQUU7RUFDVixDQUFDO0FBQ0g7QUFFQSxTQUFTb0IsT0FBT0EsQ0FBQzVCLElBQUksRUFBRW9CLEdBQUcsRUFBRUMsWUFBWSxFQUFFO0VBQ3hDLElBQUlTLGlCQUFpQixFQUFFQyxrQkFBa0IsRUFBRUMsa0JBQWtCO0VBRTdELE1BQU1DLHVCQUF1QixHQUFHakMsSUFBSSxDQUFDb0IsR0FBRyxDQUFDLEtBQUssR0FBRyxHQUFHLEdBQUcsR0FBRyxFQUFFO0VBQzVEQSxHQUFHLElBQUlhLHVCQUF1QixDQUFDWCxNQUFNO0VBQ3JDLE1BQU1sQixVQUFVLEdBQUcsQ0FBQzBCLGlCQUFpQixHQUFHOUIsSUFBSSxDQUFDa0MsS0FBSyxDQUFDZCxHQUFHLENBQUMsQ0FBQ0ksS0FBSyxDQUFDLE1BQU0sQ0FBQyxLQUFLLElBQUksR0FBRyxLQUFLLENBQUMsR0FBR00saUJBQWlCLENBQUMsQ0FBQyxDQUFDO0VBQzlHRCxnQkFBZ0IsQ0FBQ3pCLFVBQVUsRUFBRUosSUFBSSxFQUFFb0IsR0FBRyxDQUFDO0VBQ3ZDQSxHQUFHLElBQUloQixVQUFVLENBQUNrQixNQUFNO0VBQ3hCLE1BQU1hLGNBQWMsR0FBRyxDQUFDSixrQkFBa0IsR0FBRyxDQUFDQyxrQkFBa0IsR0FBR2hDLElBQUksQ0FBQ2tDLEtBQUssQ0FBQ2QsR0FBRyxDQUFDLENBQUNJLEtBQUssQ0FBQyxPQUFPLENBQUMsS0FBSyxJQUFJLEdBQUcsS0FBSyxDQUFDLEdBQUdRLGtCQUFrQixDQUFDLENBQUMsQ0FBQyxLQUFLLElBQUksR0FBR0Qsa0JBQWtCLEdBQUcsRUFBRTtFQUM5S1gsR0FBRyxJQUFJZSxjQUFjLENBQUNiLE1BQU07RUFDNUIsTUFBTWMsbUJBQW1CLEdBQUdwQyxJQUFJLENBQUNvQixHQUFHLENBQUMsS0FBSyxHQUFHLElBQUksQ0FBQ2UsY0FBYyxJQUFJbkMsSUFBSSxDQUFDb0IsR0FBRyxDQUFDLEtBQUssR0FBRyxHQUFHcEIsSUFBSSxDQUFDb0IsR0FBRyxDQUFDLEdBQUcsRUFBRTtFQUN0R0EsR0FBRyxJQUFJZ0IsbUJBQW1CLENBQUNkLE1BQU07RUFDakMsTUFBTWUsa0JBQWtCLEdBQUd4QyxXQUFXLENBQUN3QixZQUFZLENBQUM7RUFDcEQsTUFBTWlCLFVBQVUsR0FBR3RDLElBQUksQ0FBQ29CLEdBQUcsQ0FBQyxLQUFLaUIsa0JBQWtCLEdBQUdBLGtCQUFrQixHQUFHLEVBQUU7RUFFN0UsSUFBSSxDQUFDQyxVQUFVLEVBQUU7SUFDZixNQUFNLElBQUlDLEtBQUssQ0FBQ0MsZUFBZSxDQUFDLENBQUMsQ0FBQ0wsY0FBYyxJQUFJLGlCQUFpQixFQUFFLENBQUNDLG1CQUFtQixJQUFJLGtCQUFrQixFQUFHLElBQUdDLGtCQUFtQixHQUFFLENBQUMsQ0FBQ0ksTUFBTSxDQUFDQyxPQUFPLENBQUMsQ0FBQ0MsSUFBSSxDQUFDLE1BQU0sQ0FBQyxFQUFFM0MsSUFBSSxDQUFDb0IsR0FBRyxDQUFDLEVBQUVwQixJQUFJLENBQUMsQ0FBQztFQUMvTDtFQUVBb0IsR0FBRyxJQUFJa0IsVUFBVSxDQUFDaEIsTUFBTTtFQUN4QixPQUFPO0lBQ0xqQixjQUFjLEVBQUVlLEdBQUc7SUFDbkJoQixVQUFVO0lBQ1ZFLGVBQWUsRUFBRSxDQUFDLENBQUMyQix1QkFBdUI7SUFDMUN6QixNQUFNLEVBQUUyQixjQUFjLEdBQUdTLElBQUksQ0FBQ0MsR0FBRyxDQUFDQyxNQUFNLENBQUNYLGNBQWMsQ0FBQ1ksTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLEdBQUcsQ0FBQztJQUMxRXhDLFdBQVcsRUFBRXlDLGNBQWMsQ0FBQzNCLFlBQVksRUFBRWpCLFVBQVUsRUFBRWdDLG1CQUFtQixFQUFFRCxjQUFjO0VBQzNGLENBQUM7QUFDSDtBQUVBLFNBQVNOLGdCQUFnQkEsQ0FBQ3pCLFVBQVUsRUFBRUosSUFBSSxFQUFFb0IsR0FBRyxFQUFFO0VBQy9DLElBQUksQ0FBQ2hCLFVBQVUsRUFBRTtJQUNmLE1BQU0sSUFBSW1DLEtBQUssQ0FBQ0MsZUFBZSxDQUFDLGdCQUFnQixFQUFFeEMsSUFBSSxDQUFDb0IsR0FBRyxDQUFDLEVBQUVwQixJQUFJLENBQUMsQ0FBQztFQUNyRTtBQUNGO0FBRUEsU0FBU2lELFlBQVlBLENBQUNDLENBQUMsRUFBRWhDLEdBQUcsRUFBRTtFQUM1QixPQUFPZ0MsQ0FBQyxDQUFDaEMsR0FBRyxDQUFDO0FBQ2Y7QUFFQSxTQUFTOEIsY0FBY0EsQ0FBQzNCLFlBQVksRUFBRWpCLFVBQVUsRUFBRWdDLG1CQUFtQixFQUFFRCxjQUFjLEVBQUU7RUFDckYsSUFBSUMsbUJBQW1CLEVBQUU7SUFDdkIsT0FBT0EsbUJBQW1CLEtBQUssR0FBRztFQUNwQztFQUVBLElBQUlELGNBQWMsRUFBRTtJQUNsQixPQUFPLEtBQUs7RUFDZDtFQUVBLElBQUlkLFlBQVksS0FBSyxHQUFHLElBQUk0QixZQUFZLENBQUNuRCxlQUFlLEVBQUVNLFVBQVUsQ0FBQ1ksV0FBVyxFQUFFLENBQUMsRUFBRTtJQUNuRixPQUFPLEtBQUs7RUFDZDtFQUVBLE9BQU8sSUFBSTtBQUNiO0FBRUEsU0FBU0csWUFBWUEsQ0FBQ2YsVUFBVSxFQUFFO0VBQ2hDLElBQUkrQyxhQUFhO0VBRWpCLE9BQU8sQ0FBQ0EsYUFBYSxHQUFHRixZQUFZLENBQUNsRCxZQUFZLEVBQUVLLFVBQVUsQ0FBQyxLQUFLLElBQUksR0FBRytDLGFBQWEsR0FBRy9DLFVBQVU7QUFDdEc7QUFFQSxTQUFTb0MsZUFBZUEsQ0FBQ1ksUUFBUSxFQUFFQyxLQUFLLEVBQUVyRCxJQUFJLEVBQUU7RUFDOUMsT0FBUSxZQUFXb0QsUUFBUyxlQUFjQyxLQUFLLElBQUksSUFBSSxHQUFHQSxLQUFLLEdBQUcsRUFBRyxTQUFRckQsSUFBSztBQUNwRjtBQUNBLGdFQUFnRTtBQUNoRSJ9