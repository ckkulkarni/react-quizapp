a46d564f50eafd449ecde84a05d3bad3
"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.TargetConnector = void 0;
var _shallowequal = require("@react-dnd/shallowequal");
var _isRef = require("./isRef.js");
var _wrapConnectorHooks = require("./wrapConnectorHooks.js");
class TargetConnector {
  get connectTarget() {
    return this.dropTarget;
  }
  reconnect() {
    // if nothing has changed then don't resubscribe
    const didChange = this.didHandlerIdChange() || this.didDropTargetChange() || this.didOptionsChange();
    if (didChange) {
      this.disconnectDropTarget();
    }
    const dropTarget = this.dropTarget;
    if (!this.handlerId) {
      return;
    }
    if (!dropTarget) {
      this.lastConnectedDropTarget = dropTarget;
      return;
    }
    if (didChange) {
      this.lastConnectedHandlerId = this.handlerId;
      this.lastConnectedDropTarget = dropTarget;
      this.lastConnectedDropTargetOptions = this.dropTargetOptions;
      this.unsubscribeDropTarget = this.backend.connectDropTarget(this.handlerId, dropTarget, this.dropTargetOptions);
    }
  }
  receiveHandlerId(newHandlerId) {
    if (newHandlerId === this.handlerId) {
      return;
    }
    this.handlerId = newHandlerId;
    this.reconnect();
  }
  get dropTargetOptions() {
    return this.dropTargetOptionsInternal;
  }
  set dropTargetOptions(options) {
    this.dropTargetOptionsInternal = options;
  }
  didHandlerIdChange() {
    return this.lastConnectedHandlerId !== this.handlerId;
  }
  didDropTargetChange() {
    return this.lastConnectedDropTarget !== this.dropTarget;
  }
  didOptionsChange() {
    return !(0, _shallowequal.shallowEqual)(this.lastConnectedDropTargetOptions, this.dropTargetOptions);
  }
  disconnectDropTarget() {
    if (this.unsubscribeDropTarget) {
      this.unsubscribeDropTarget();
      this.unsubscribeDropTarget = undefined;
    }
  }
  get dropTarget() {
    return this.dropTargetNode || this.dropTargetRef && this.dropTargetRef.current;
  }
  clearDropTarget() {
    this.dropTargetRef = null;
    this.dropTargetNode = null;
  }
  constructor(backend) {
    this.hooks = (0, _wrapConnectorHooks.wrapConnectorHooks)({
      dropTarget: (node, options) => {
        this.clearDropTarget();
        this.dropTargetOptions = options;
        if ((0, _isRef.isRef)(node)) {
          this.dropTargetRef = node;
        } else {
          this.dropTargetNode = node;
        }
        this.reconnect();
      }
    });
    this.handlerId = null;
    // The drop target may either be attached via ref or connect function
    this.dropTargetRef = null;
    this.dropTargetOptionsInternal = null;
    this.lastConnectedHandlerId = null;
    this.lastConnectedDropTarget = null;
    this.lastConnectedDropTargetOptions = null;
    this.backend = backend;
  }
}
exports.TargetConnector = TargetConnector;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfc2hhbGxvd2VxdWFsIiwicmVxdWlyZSIsIl9pc1JlZiIsIl93cmFwQ29ubmVjdG9ySG9va3MiLCJUYXJnZXRDb25uZWN0b3IiLCJjb25uZWN0VGFyZ2V0IiwiZHJvcFRhcmdldCIsInJlY29ubmVjdCIsImRpZENoYW5nZSIsImRpZEhhbmRsZXJJZENoYW5nZSIsImRpZERyb3BUYXJnZXRDaGFuZ2UiLCJkaWRPcHRpb25zQ2hhbmdlIiwiZGlzY29ubmVjdERyb3BUYXJnZXQiLCJoYW5kbGVySWQiLCJsYXN0Q29ubmVjdGVkRHJvcFRhcmdldCIsImxhc3RDb25uZWN0ZWRIYW5kbGVySWQiLCJsYXN0Q29ubmVjdGVkRHJvcFRhcmdldE9wdGlvbnMiLCJkcm9wVGFyZ2V0T3B0aW9ucyIsInVuc3Vic2NyaWJlRHJvcFRhcmdldCIsImJhY2tlbmQiLCJjb25uZWN0RHJvcFRhcmdldCIsInJlY2VpdmVIYW5kbGVySWQiLCJuZXdIYW5kbGVySWQiLCJkcm9wVGFyZ2V0T3B0aW9uc0ludGVybmFsIiwib3B0aW9ucyIsInNoYWxsb3dFcXVhbCIsInVuZGVmaW5lZCIsImRyb3BUYXJnZXROb2RlIiwiZHJvcFRhcmdldFJlZiIsImN1cnJlbnQiLCJjbGVhckRyb3BUYXJnZXQiLCJjb25zdHJ1Y3RvciIsImhvb2tzIiwid3JhcENvbm5lY3Rvckhvb2tzIiwibm9kZSIsImlzUmVmIiwiZXhwb3J0cyJdLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9pbnRlcm5hbHMvVGFyZ2V0Q29ubmVjdG9yLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IHNoYWxsb3dFcXVhbCB9IGZyb20gJ0ByZWFjdC1kbmQvc2hhbGxvd2VxdWFsJ1xuaW1wb3J0IHR5cGUgeyBCYWNrZW5kLCBJZGVudGlmaWVyLCBVbnN1YnNjcmliZSB9IGZyb20gJ2RuZC1jb3JlJ1xuaW1wb3J0IHR5cGUgeyBSZWZPYmplY3QgfSBmcm9tICdyZWFjdCdcblxuaW1wb3J0IHR5cGUgeyBEcm9wVGFyZ2V0T3B0aW9ucyB9IGZyb20gJy4uL3R5cGVzL2luZGV4LmpzJ1xuaW1wb3J0IHsgaXNSZWYgfSBmcm9tICcuL2lzUmVmLmpzJ1xuaW1wb3J0IHR5cGUgeyBDb25uZWN0b3IgfSBmcm9tICcuL1NvdXJjZUNvbm5lY3Rvci5qcydcbmltcG9ydCB7IHdyYXBDb25uZWN0b3JIb29rcyB9IGZyb20gJy4vd3JhcENvbm5lY3Rvckhvb2tzLmpzJ1xuXG5leHBvcnQgY2xhc3MgVGFyZ2V0Q29ubmVjdG9yIGltcGxlbWVudHMgQ29ubmVjdG9yIHtcblx0cHVibGljIGhvb2tzID0gd3JhcENvbm5lY3Rvckhvb2tzKHtcblx0XHRkcm9wVGFyZ2V0OiAobm9kZTogYW55LCBvcHRpb25zOiBEcm9wVGFyZ2V0T3B0aW9ucykgPT4ge1xuXHRcdFx0dGhpcy5jbGVhckRyb3BUYXJnZXQoKVxuXHRcdFx0dGhpcy5kcm9wVGFyZ2V0T3B0aW9ucyA9IG9wdGlvbnNcblx0XHRcdGlmIChpc1JlZihub2RlKSkge1xuXHRcdFx0XHR0aGlzLmRyb3BUYXJnZXRSZWYgPSBub2RlXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLmRyb3BUYXJnZXROb2RlID0gbm9kZVxuXHRcdFx0fVxuXHRcdFx0dGhpcy5yZWNvbm5lY3QoKVxuXHRcdH0sXG5cdH0pXG5cblx0cHJpdmF0ZSBoYW5kbGVySWQ6IElkZW50aWZpZXIgfCBudWxsID0gbnVsbFxuXHQvLyBUaGUgZHJvcCB0YXJnZXQgbWF5IGVpdGhlciBiZSBhdHRhY2hlZCB2aWEgcmVmIG9yIGNvbm5lY3QgZnVuY3Rpb25cblx0cHJpdmF0ZSBkcm9wVGFyZ2V0UmVmOiBSZWZPYmplY3Q8YW55PiB8IG51bGwgPSBudWxsXG5cdHByaXZhdGUgZHJvcFRhcmdldE5vZGU6IGFueVxuXHRwcml2YXRlIGRyb3BUYXJnZXRPcHRpb25zSW50ZXJuYWw6IERyb3BUYXJnZXRPcHRpb25zIHwgbnVsbCA9IG51bGxcblx0cHJpdmF0ZSB1bnN1YnNjcmliZURyb3BUYXJnZXQ6IFVuc3Vic2NyaWJlIHwgdW5kZWZpbmVkXG5cblx0cHJpdmF0ZSBsYXN0Q29ubmVjdGVkSGFuZGxlcklkOiBJZGVudGlmaWVyIHwgbnVsbCA9IG51bGxcblx0cHJpdmF0ZSBsYXN0Q29ubmVjdGVkRHJvcFRhcmdldDogYW55ID0gbnVsbFxuXHRwcml2YXRlIGxhc3RDb25uZWN0ZWREcm9wVGFyZ2V0T3B0aW9uczogRHJvcFRhcmdldE9wdGlvbnMgfCBudWxsID0gbnVsbFxuXHRwcml2YXRlIHJlYWRvbmx5IGJhY2tlbmQ6IEJhY2tlbmRcblxuXHRwdWJsaWMgY29uc3RydWN0b3IoYmFja2VuZDogQmFja2VuZCkge1xuXHRcdHRoaXMuYmFja2VuZCA9IGJhY2tlbmRcblx0fVxuXG5cdHB1YmxpYyBnZXQgY29ubmVjdFRhcmdldCgpOiBhbnkge1xuXHRcdHJldHVybiB0aGlzLmRyb3BUYXJnZXRcblx0fVxuXG5cdHB1YmxpYyByZWNvbm5lY3QoKTogdm9pZCB7XG5cdFx0Ly8gaWYgbm90aGluZyBoYXMgY2hhbmdlZCB0aGVuIGRvbid0IHJlc3Vic2NyaWJlXG5cdFx0Y29uc3QgZGlkQ2hhbmdlID1cblx0XHRcdHRoaXMuZGlkSGFuZGxlcklkQ2hhbmdlKCkgfHxcblx0XHRcdHRoaXMuZGlkRHJvcFRhcmdldENoYW5nZSgpIHx8XG5cdFx0XHR0aGlzLmRpZE9wdGlvbnNDaGFuZ2UoKVxuXG5cdFx0aWYgKGRpZENoYW5nZSkge1xuXHRcdFx0dGhpcy5kaXNjb25uZWN0RHJvcFRhcmdldCgpXG5cdFx0fVxuXG5cdFx0Y29uc3QgZHJvcFRhcmdldCA9IHRoaXMuZHJvcFRhcmdldFxuXHRcdGlmICghdGhpcy5oYW5kbGVySWQpIHtcblx0XHRcdHJldHVyblxuXHRcdH1cblx0XHRpZiAoIWRyb3BUYXJnZXQpIHtcblx0XHRcdHRoaXMubGFzdENvbm5lY3RlZERyb3BUYXJnZXQgPSBkcm9wVGFyZ2V0XG5cdFx0XHRyZXR1cm5cblx0XHR9XG5cblx0XHRpZiAoZGlkQ2hhbmdlKSB7XG5cdFx0XHR0aGlzLmxhc3RDb25uZWN0ZWRIYW5kbGVySWQgPSB0aGlzLmhhbmRsZXJJZFxuXHRcdFx0dGhpcy5sYXN0Q29ubmVjdGVkRHJvcFRhcmdldCA9IGRyb3BUYXJnZXRcblx0XHRcdHRoaXMubGFzdENvbm5lY3RlZERyb3BUYXJnZXRPcHRpb25zID0gdGhpcy5kcm9wVGFyZ2V0T3B0aW9uc1xuXG5cdFx0XHR0aGlzLnVuc3Vic2NyaWJlRHJvcFRhcmdldCA9IHRoaXMuYmFja2VuZC5jb25uZWN0RHJvcFRhcmdldChcblx0XHRcdFx0dGhpcy5oYW5kbGVySWQsXG5cdFx0XHRcdGRyb3BUYXJnZXQsXG5cdFx0XHRcdHRoaXMuZHJvcFRhcmdldE9wdGlvbnMsXG5cdFx0XHQpXG5cdFx0fVxuXHR9XG5cblx0cHVibGljIHJlY2VpdmVIYW5kbGVySWQobmV3SGFuZGxlcklkOiBJZGVudGlmaWVyIHwgbnVsbCk6IHZvaWQge1xuXHRcdGlmIChuZXdIYW5kbGVySWQgPT09IHRoaXMuaGFuZGxlcklkKSB7XG5cdFx0XHRyZXR1cm5cblx0XHR9XG5cblx0XHR0aGlzLmhhbmRsZXJJZCA9IG5ld0hhbmRsZXJJZFxuXHRcdHRoaXMucmVjb25uZWN0KClcblx0fVxuXG5cdHB1YmxpYyBnZXQgZHJvcFRhcmdldE9wdGlvbnMoKTogRHJvcFRhcmdldE9wdGlvbnMge1xuXHRcdHJldHVybiB0aGlzLmRyb3BUYXJnZXRPcHRpb25zSW50ZXJuYWxcblx0fVxuXHRwdWJsaWMgc2V0IGRyb3BUYXJnZXRPcHRpb25zKG9wdGlvbnM6IERyb3BUYXJnZXRPcHRpb25zKSB7XG5cdFx0dGhpcy5kcm9wVGFyZ2V0T3B0aW9uc0ludGVybmFsID0gb3B0aW9uc1xuXHR9XG5cblx0cHJpdmF0ZSBkaWRIYW5kbGVySWRDaGFuZ2UoKTogYm9vbGVhbiB7XG5cdFx0cmV0dXJuIHRoaXMubGFzdENvbm5lY3RlZEhhbmRsZXJJZCAhPT0gdGhpcy5oYW5kbGVySWRcblx0fVxuXG5cdHByaXZhdGUgZGlkRHJvcFRhcmdldENoYW5nZSgpOiBib29sZWFuIHtcblx0XHRyZXR1cm4gdGhpcy5sYXN0Q29ubmVjdGVkRHJvcFRhcmdldCAhPT0gdGhpcy5kcm9wVGFyZ2V0XG5cdH1cblxuXHRwcml2YXRlIGRpZE9wdGlvbnNDaGFuZ2UoKTogYm9vbGVhbiB7XG5cdFx0cmV0dXJuICFzaGFsbG93RXF1YWwoXG5cdFx0XHR0aGlzLmxhc3RDb25uZWN0ZWREcm9wVGFyZ2V0T3B0aW9ucyxcblx0XHRcdHRoaXMuZHJvcFRhcmdldE9wdGlvbnMsXG5cdFx0KVxuXHR9XG5cblx0cHVibGljIGRpc2Nvbm5lY3REcm9wVGFyZ2V0KCkge1xuXHRcdGlmICh0aGlzLnVuc3Vic2NyaWJlRHJvcFRhcmdldCkge1xuXHRcdFx0dGhpcy51bnN1YnNjcmliZURyb3BUYXJnZXQoKVxuXHRcdFx0dGhpcy51bnN1YnNjcmliZURyb3BUYXJnZXQgPSB1bmRlZmluZWRcblx0XHR9XG5cdH1cblxuXHRwcml2YXRlIGdldCBkcm9wVGFyZ2V0KCkge1xuXHRcdHJldHVybiAoXG5cdFx0XHR0aGlzLmRyb3BUYXJnZXROb2RlIHx8ICh0aGlzLmRyb3BUYXJnZXRSZWYgJiYgdGhpcy5kcm9wVGFyZ2V0UmVmLmN1cnJlbnQpXG5cdFx0KVxuXHR9XG5cblx0cHJpdmF0ZSBjbGVhckRyb3BUYXJnZXQoKSB7XG5cdFx0dGhpcy5kcm9wVGFyZ2V0UmVmID0gbnVsbFxuXHRcdHRoaXMuZHJvcFRhcmdldE5vZGUgPSBudWxsXG5cdH1cbn1cbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQUEsSUFBQUEsYUFBQSxHQUFBQyxPQUFBO0FBS0EsSUFBQUMsTUFBQSxHQUFBRCxPQUFBO0FBRUEsSUFBQUUsbUJBQUEsR0FBQUYsT0FBQTtBQUVPLE1BQU1HLGVBQWU7RUE4QjNCLElBQVdDLGFBQWFBLENBQUEsRUFBUTtJQUMvQixPQUFPLElBQUksQ0FBQ0MsVUFBVTs7RUFHdkJDLFNBQWdCQSxDQUFBLEVBQVM7SUFDeEI7SUFDQSxNQUFNQyxTQUFTLEdBQ2QsSUFBSSxDQUFDQyxrQkFBa0IsRUFBRSxJQUN6QixJQUFJLENBQUNDLG1CQUFtQixFQUFFLElBQzFCLElBQUks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