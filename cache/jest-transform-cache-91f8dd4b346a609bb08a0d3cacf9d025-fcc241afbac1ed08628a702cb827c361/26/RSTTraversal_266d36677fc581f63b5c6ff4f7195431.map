{"version":3,"names":["propsOfNode","childrenOfNode","hasClassName","treeForEach","treeFilter","findParentNode","pathToNode","parentsOfNode","nodeHasId","nodeMatchesObjectProps","getTextFromNode","getTextFromHostNodes","getHTMLFromHostNodes","_arrayPrototype","require","_object3","_isSubset","_functionPrototype","_isRegex","_getAdapter","node","props","adapter","_getAdapter2","adapterHasIsFragment","isFragment","renderedArray","Array","isArray","rendered","_arrayPrototype2","map","currentChild","className","classes","String","replace","_isRegex2","test","indexOf","tree","fn","forEach","results","push","root","targetNode","pathFilter","path","filter","length","queue","hasNode","testNode","current","pop","children","apply","_toConsumableArray","reverse","id","CAN_NEVER_MATCH","replaceUndefined","v","replaceUndefinedValues","obj","_object4","reduce","acc","_ref","_ref2","_slicedToArray","k","_object2","_defineProperty","_isSubset2","getTextFromHostNode","hostNode","textContent","getTextFromRSTNode","_ref3","getCustom","handleHostNodes","recurse","_ref3$nullRenderRetur","nullRenderReturnsNull","undefined","type","nodeType","join","_ref4","displayName","_functionPrototype2","item","nodes","concat","nodeToHostNode","getHTMLFromHostNode","outerHTML"],"sources":["../src/RSTTraversal.js"],"sourcesContent":["import flat from 'array.prototype.flat';\nimport entries from 'object.entries';\nimport isSubset from 'is-subset';\nimport functionName from 'function.prototype.name';\nimport isRegex from 'is-regex';\nimport getAdapter from './getAdapter';\n\nexport function propsOfNode(node) {\n  return (node && node.props) || {};\n}\n\nexport function childrenOfNode(node) {\n  if (!node) return [];\n\n  const adapter = getAdapter();\n  const adapterHasIsFragment = adapter.isFragment && typeof adapter.isFragment === 'function';\n\n  const renderedArray = Array.isArray(node.rendered) ? flat(node.rendered, 1) : [node.rendered];\n\n  // React adapters before 16 will not have isFragment\n  if (!adapterHasIsFragment) {\n    return renderedArray;\n  }\n\n  return flat(renderedArray.map((currentChild) => {\n    // If the node is a Fragment, we want to return its children, not the fragment itself\n    if (adapter.isFragment(currentChild)) {\n      return childrenOfNode(currentChild);\n    }\n\n    return currentChild;\n  }), 1);\n}\n\nexport function hasClassName(node, className) {\n  let classes = propsOfNode(node).className || '';\n  classes = String(classes).replace(/\\s/g, ' ');\n  if (isRegex(className)) return className.test(classes);\n  return ` ${classes} `.indexOf(` ${className} `) > -1;\n}\n\nexport function treeForEach(tree, fn) {\n  if (tree) {\n    fn(tree);\n  }\n  childrenOfNode(tree).forEach((node) => treeForEach(node, fn));\n}\n\nexport function treeFilter(tree, fn) {\n  const results = [];\n  treeForEach(tree, (node) => {\n    if (fn(node)) {\n      results.push(node);\n    }\n  });\n  return results;\n}\n\n/**\n * To support sibling selectors we need to be able to find\n * the siblings of a node. The easiest way to do that is find\n * the parent of the node and access its children.\n *\n * This would be unneeded if the RST spec included sibling pointers\n * such as node.nextSibling and node.prevSibling\n * @param {*} root\n * @param {*} targetNode\n */\nexport function findParentNode(root, targetNode) {\n  const results = treeFilter(\n    root,\n    (node) => {\n      if (!node.rendered) {\n        return false;\n      }\n\n      return childrenOfNode(node).indexOf(targetNode) !== -1;\n    },\n  );\n  return results[0] || null;\n}\n\nfunction pathFilter(path, fn) {\n  return path.filter((tree) => treeFilter(tree, fn).length !== 0);\n}\n\nexport function pathToNode(node, root) {\n  const queue = [root];\n  const path = [];\n\n  const hasNode = (testNode) => node === testNode;\n\n  while (queue.length) {\n    const current = queue.pop();\n    const children = childrenOfNode(current);\n    if (current === node) return pathFilter(path, hasNode);\n\n    path.push(current);\n\n    if (children.length === 0) {\n      // leaf node. if it isn't the node we are looking for, we pop.\n      path.pop();\n    }\n    queue.push(...children);\n  }\n\n  return null;\n}\n\nexport function parentsOfNode(node, root) {\n  return (pathToNode(node, root) || []).reverse();\n}\n\nexport function nodeHasId(node, id) {\n  return propsOfNode(node).id === id;\n}\n\nconst CAN_NEVER_MATCH = {};\nfunction replaceUndefined(v) {\n  return typeof v !== 'undefined' ? v : CAN_NEVER_MATCH;\n}\nfunction replaceUndefinedValues(obj) {\n  return entries(obj)\n    .reduce((acc, [k, v]) => ({ ...acc, [k]: replaceUndefined(v) }), {});\n}\n\nexport function nodeMatchesObjectProps(node, props) {\n  return isSubset(propsOfNode(node), replaceUndefinedValues(props));\n}\n\nfunction getTextFromHostNode(hostNode) {\n  if (typeof hostNode === 'string') {\n    return String(hostNode || '');\n  }\n  if (!hostNode) {\n    return '';\n  }\n  return hostNode.textContent || '';\n}\n\nfunction getTextFromRSTNode(node, {\n  getCustom,\n  handleHostNodes,\n  recurse,\n  nullRenderReturnsNull = false,\n}) {\n  if (node == null) {\n    return '';\n  }\n\n  if (typeof node === 'string' || typeof node === 'number') {\n    return String(node);\n  }\n\n  if (getCustom && node.type && typeof node.type === 'function') {\n    return getCustom(node);\n  }\n\n  if (handleHostNodes && node.nodeType === 'host') {\n    return handleHostNodes(node);\n  }\n  if (node.rendered == null && nullRenderReturnsNull) {\n    return null;\n  }\n  return childrenOfNode(node).map(recurse).join('');\n}\n\nexport function getTextFromNode(node) {\n  return getTextFromRSTNode(node, {\n    recurse: getTextFromNode,\n    getCustom({ type }) {\n      return `<${type.displayName || functionName(type)} />`;\n    },\n  });\n}\n\nexport function getTextFromHostNodes(node, adapter) {\n  return getTextFromRSTNode(node, {\n    recurse(item) {\n      return getTextFromHostNodes(item, adapter);\n    },\n    handleHostNodes(item) {\n      const nodes = [].concat(adapter.nodeToHostNode(item, true));\n      return nodes.map(getTextFromHostNode).join('');\n    },\n  });\n}\n\nfunction getHTMLFromHostNode(hostNode) {\n  if (hostNode == null) {\n    return null;\n  }\n  return hostNode.outerHTML.replace(/\\sdata-(reactid|reactroot)+=\"([^\"]*)+\"/g, '');\n}\n\nexport function getHTMLFromHostNodes(node, adapter) {\n  return getTextFromRSTNode(node, {\n    recurse(item) {\n      return getHTMLFromHostNodes(item, adapter);\n    },\n    handleHostNodes(item) {\n      const nodes = [].concat(adapter.nodeToHostNode(item, true));\n      return nodes.map(getHTMLFromHostNode).join('');\n    },\n    nullRenderReturnsNull: true,\n  });\n}\n"],"mappings":"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"}