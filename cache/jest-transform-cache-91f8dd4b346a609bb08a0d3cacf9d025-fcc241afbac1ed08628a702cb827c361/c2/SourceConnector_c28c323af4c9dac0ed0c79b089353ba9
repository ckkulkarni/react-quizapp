d35cefdb67cf2763595e7da9ff14effc
"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.SourceConnector = void 0;
var _shallowequal = require("@react-dnd/shallowequal");
var _isRef = require("./isRef.js");
var _wrapConnectorHooks = require("./wrapConnectorHooks.js");
class SourceConnector {
  receiveHandlerId(newHandlerId) {
    if (this.handlerId === newHandlerId) {
      return;
    }
    this.handlerId = newHandlerId;
    this.reconnect();
  }
  get connectTarget() {
    return this.dragSource;
  }
  get dragSourceOptions() {
    return this.dragSourceOptionsInternal;
  }
  set dragSourceOptions(options) {
    this.dragSourceOptionsInternal = options;
  }
  get dragPreviewOptions() {
    return this.dragPreviewOptionsInternal;
  }
  set dragPreviewOptions(options) {
    this.dragPreviewOptionsInternal = options;
  }
  reconnect() {
    const didChange = this.reconnectDragSource();
    this.reconnectDragPreview(didChange);
  }
  reconnectDragSource() {
    const dragSource = this.dragSource;
    // if nothing has changed then don't resubscribe
    const didChange = this.didHandlerIdChange() || this.didConnectedDragSourceChange() || this.didDragSourceOptionsChange();
    if (didChange) {
      this.disconnectDragSource();
    }
    if (!this.handlerId) {
      return didChange;
    }
    if (!dragSource) {
      this.lastConnectedDragSource = dragSource;
      return didChange;
    }
    if (didChange) {
      this.lastConnectedHandlerId = this.handlerId;
      this.lastConnectedDragSource = dragSource;
      this.lastConnectedDragSourceOptions = this.dragSourceOptions;
      this.dragSourceUnsubscribe = this.backend.connectDragSource(this.handlerId, dragSource, this.dragSourceOptions);
    }
    return didChange;
  }
  reconnectDragPreview(forceDidChange = false) {
    const dragPreview = this.dragPreview;
    // if nothing has changed then don't resubscribe
    const didChange = forceDidChange || this.didHandlerIdChange() || this.didConnectedDragPreviewChange() || this.didDragPreviewOptionsChange();
    if (didChange) {
      this.disconnectDragPreview();
    }
    if (!this.handlerId) {
      return;
    }
    if (!dragPreview) {
      this.lastConnectedDragPreview = dragPreview;
      return;
    }
    if (didChange) {
      this.lastConnectedHandlerId = this.handlerId;
      this.lastConnectedDragPreview = dragPreview;
      this.lastConnectedDragPreviewOptions = this.dragPreviewOptions;
      this.dragPreviewUnsubscribe = this.backend.connectDragPreview(this.handlerId, dragPreview, this.dragPreviewOptions);
    }
  }
  didHandlerIdChange() {
    return this.lastConnectedHandlerId !== this.handlerId;
  }
  didConnectedDragSourceChange() {
    return this.lastConnectedDragSource !== this.dragSource;
  }
  didConnectedDragPreviewChange() {
    return this.lastConnectedDragPreview !== this.dragPreview;
  }
  didDragSourceOptionsChange() {
    return !(0, _shallowequal.shallowEqual)(this.lastConnectedDragSourceOptions, this.dragSourceOptions);
  }
  didDragPreviewOptionsChange() {
    return !(0, _shallowequal.shallowEqual)(this.lastConnectedDragPreviewOptions, this.dragPreviewOptions);
  }
  disconnectDragSource() {
    if (this.dragSourceUnsubscribe) {
      this.dragSourceUnsubscribe();
      this.dragSourceUnsubscribe = undefined;
    }
  }
  disconnectDragPreview() {
    if (this.dragPreviewUnsubscribe) {
      this.dragPreviewUnsubscribe();
      this.dragPreviewUnsubscribe = undefined;
      this.dragPreviewNode = null;
      this.dragPreviewRef = null;
    }
  }
  get dragSource() {
    return this.dragSourceNode || this.dragSourceRef && this.dragSourceRef.current;
  }
  get dragPreview() {
    return this.dragPreviewNode || this.dragPreviewRef && this.dragPreviewRef.current;
  }
  clearDragSource() {
    this.dragSourceNode = null;
    this.dragSourceRef = null;
  }
  clearDragPreview() {
    this.dragPreviewNode = null;
    this.dragPreviewRef = null;
  }
  constructor(backend) {
    this.hooks = (0, _wrapConnectorHooks.wrapConnectorHooks)({
      dragSource: (node, options) => {
        this.clearDragSource();
        this.dragSourceOptions = options || null;
        if ((0, _isRef.isRef)(node)) {
          this.dragSourceRef = node;
        } else {
          this.dragSourceNode = node;
        }
        this.reconnectDragSource();
      },
      dragPreview: (node, options) => {
        this.clearDragPreview();
        this.dragPreviewOptions = options || null;
        if ((0, _isRef.isRef)(node)) {
          this.dragPreviewRef = node;
        } else {
          this.dragPreviewNode = node;
        }
        this.reconnectDragPreview();
      }
    });
    this.handlerId = null;
    // The drop target may either be attached via ref or connect function
    this.dragSourceRef = null;
    this.dragSourceOptionsInternal = null;
    // The drag preview may either be attached via ref or connect function
    this.dragPreviewRef = null;
    this.dragPreviewOptionsInternal = null;
    this.lastConnectedHandlerId = null;
    this.lastConnectedDragSource = null;
    this.lastConnectedDragSourceOptions = null;
    this.lastConnectedDragPreview = null;
    this.lastConnectedDragPreviewOptions = null;
    this.backend = backend;
  }
}
exports.SourceConnector = SourceConnector;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfc2hhbGxvd2VxdWFsIiwicmVxdWlyZSIsIl9pc1JlZiIsIl93cmFwQ29ubmVjdG9ySG9va3MiLCJTb3VyY2VDb25uZWN0b3IiLCJyZWNlaXZlSGFuZGxlcklkIiwibmV3SGFuZGxlcklkIiwiaGFuZGxlcklkIiwicmVjb25uZWN0IiwiY29ubmVjdFRhcmdldCIsImRyYWdTb3VyY2UiLCJkcmFnU291cmNlT3B0aW9ucyIsImRyYWdTb3VyY2VPcHRpb25zSW50ZXJuYWwiLCJvcHRpb25zIiwiZHJhZ1ByZXZpZXdPcHRpb25zIiwiZHJhZ1ByZXZpZXdPcHRpb25zSW50ZXJuYWwiLCJkaWRDaGFuZ2UiLCJyZWNvbm5lY3REcmFnU291cmNlIiwicmVjb25uZWN0RHJhZ1ByZXZpZXciLCJkaWRIYW5kbGVySWRDaGFuZ2UiLCJkaWRDb25uZWN0ZWREcmFnU291cmNlQ2hhbmdlIiwiZGlkRHJhZ1NvdXJjZU9wdGlvbnNDaGFuZ2UiLCJkaXNjb25uZWN0RHJhZ1NvdXJjZSIsImxhc3RDb25uZWN0ZWREcmFnU291cmNlIiwibGFzdENvbm5lY3RlZEhhbmRsZXJJZCIsImxhc3RDb25uZWN0ZWREcmFnU291cmNlT3B0aW9ucyIsImRyYWdTb3VyY2VVbnN1YnNjcmliZSIsImJhY2tlbmQiLCJjb25uZWN0RHJhZ1NvdXJjZSIsImZvcmNlRGlkQ2hhbmdlIiwiZHJhZ1ByZXZpZXciLCJkaWRDb25uZWN0ZWREcmFnUHJldmlld0NoYW5nZSIsImRpZERyYWdQcmV2aWV3T3B0aW9uc0NoYW5nZSIsImRpc2Nvbm5lY3REcmFnUHJldmlldyIsImxhc3RDb25uZWN0ZWREcmFnUHJldmlldyIsImxhc3RDb25uZWN0ZWREcmFnUHJldmlld09wdGlvbnMiLCJkcmFnUHJldmlld1Vuc3Vic2NyaWJlIiwiY29ubmVjdERyYWdQcmV2aWV3Iiwic2hhbGxvd0VxdWFsIiwidW5kZWZpbmVkIiwiZHJhZ1ByZXZpZXdOb2RlIiwiZHJhZ1ByZXZpZXdSZWYiLCJkcmFnU291cmNlTm9kZSIsImRyYWdTb3VyY2VSZWYiLCJjdXJyZW50IiwiY2xlYXJEcmFnU291cmNlIiwiY2xlYXJEcmFnUHJldmlldyIsImNvbnN0cnVjdG9yIiwiaG9va3MiLCJ3cmFwQ29ubmVjdG9ySG9va3MiLCJub2RlIiwiaXNSZWYiLCJleHBvcnRzIl0sInNvdXJjZXMiOlsiLi4vLi4vc3JjL2ludGVybmFscy9Tb3VyY2VDb25uZWN0b3IudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgc2hhbGxvd0VxdWFsIH0gZnJvbSAnQHJlYWN0LWRuZC9zaGFsbG93ZXF1YWwnXG5pbXBvcnQgdHlwZSB7IEJhY2tlbmQsIElkZW50aWZpZXIsIFVuc3Vic2NyaWJlIH0gZnJvbSAnZG5kLWNvcmUnXG5pbXBvcnQgdHlwZSB7IFJlYWN0RWxlbWVudCwgUmVmLCBSZWZPYmplY3QgfSBmcm9tICdyZWFjdCdcblxuaW1wb3J0IHR5cGUgeyBEcmFnUHJldmlld09wdGlvbnMsIERyYWdTb3VyY2VPcHRpb25zIH0gZnJvbSAnLi4vdHlwZXMvaW5kZXguanMnXG5pbXBvcnQgeyBpc1JlZiB9IGZyb20gJy4vaXNSZWYuanMnXG5pbXBvcnQgeyB3cmFwQ29ubmVjdG9ySG9va3MgfSBmcm9tICcuL3dyYXBDb25uZWN0b3JIb29rcy5qcydcblxuZXhwb3J0IGludGVyZmFjZSBDb25uZWN0b3Ige1xuXHRob29rczogYW55XG5cdGNvbm5lY3RUYXJnZXQ6IGFueVxuXHRyZWNlaXZlSGFuZGxlcklkKGhhbmRsZXJJZDogSWRlbnRpZmllciB8IG51bGwpOiB2b2lkXG5cdHJlY29ubmVjdCgpOiB2b2lkXG59XG5cbmV4cG9ydCBjbGFzcyBTb3VyY2VDb25uZWN0b3IgaW1wbGVtZW50cyBDb25uZWN0b3Ige1xuXHRwdWJsaWMgaG9va3MgPSB3cmFwQ29ubmVjdG9ySG9va3Moe1xuXHRcdGRyYWdTb3VyY2U6IChcblx0XHRcdG5vZGU6IEVsZW1lbnQgfCBSZWFjdEVsZW1lbnQgfCBSZWY8YW55Pixcblx0XHRcdG9wdGlvbnM/OiBEcmFnU291cmNlT3B0aW9ucyxcblx0XHQpID0+IHtcblx0XHRcdHRoaXMuY2xlYXJEcmFnU291cmNlKClcblx0XHRcdHRoaXMuZHJhZ1NvdXJjZU9wdGlvbnMgPSBvcHRpb25zIHx8IG51bGxcblx0XHRcdGlmIChpc1JlZihub2RlKSkge1xuXHRcdFx0XHR0aGlzLmRyYWdTb3VyY2VSZWYgPSBub2RlIGFzIFJlZk9iamVjdDxhbnk+XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLmRyYWdTb3VyY2VOb2RlID0gbm9kZVxuXHRcdFx0fVxuXHRcdFx0dGhpcy5yZWNvbm5lY3REcmFnU291cmNlKClcblx0XHR9LFxuXHRcdGRyYWdQcmV2aWV3OiAobm9kZTogYW55LCBvcHRpb25zPzogRHJhZ1ByZXZpZXdPcHRpb25zKSA9PiB7XG5cdFx0XHR0aGlzLmNsZWFyRHJhZ1ByZXZpZXcoKVxuXHRcdFx0dGhpcy5kcmFnUHJldmlld09wdGlvbnMgPSBvcHRpb25zIHx8IG51bGxcblx0XHRcdGlmIChpc1JlZihub2RlKSkge1xuXHRcdFx0XHR0aGlzLmRyYWdQcmV2aWV3UmVmID0gbm9kZVxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5kcmFnUHJldmlld05vZGUgPSBub2RlXG5cdFx0XHR9XG5cdFx0XHR0aGlzLnJlY29ubmVjdERyYWdQcmV2aWV3KClcblx0XHR9LFxuXHR9KVxuXHRwcml2YXRlIGhhbmRsZXJJZDogSWRlbnRpZmllciB8IG51bGwgPSBudWxsXG5cblx0Ly8gVGhlIGRyb3AgdGFyZ2V0IG1heSBlaXRoZXIgYmUgYXR0YWNoZWQgdmlhIHJlZiBvciBjb25uZWN0IGZ1bmN0aW9uXG5cdHByaXZhdGUgZHJhZ1NvdXJjZVJlZjogUmVmT2JqZWN0PGFueT4gfCBudWxsID0gbnVsbFxuXHRwcml2YXRlIGRyYWdTb3VyY2VOb2RlOiBhbnlcblx0cHJpdmF0ZSBkcmFnU291cmNlT3B0aW9uc0ludGVybmFsOiBEcmFnU291cmNlT3B0aW9ucyB8IG51bGwgPSBudWxsXG5cdHByaXZhdGUgZHJhZ1NvdXJjZVVuc3Vic2NyaWJlOiBVbnN1YnNjcmliZSB8IHVuZGVmaW5lZFxuXG5cdC8vIFRoZSBkcmFnIHByZXZpZXcgbWF5IGVpdGhlciBiZSBhdHRhY2hlZCB2aWEgcmVmIG9yIGNvbm5lY3QgZnVuY3Rpb25cblx0cHJpdmF0ZSBkcmFnUHJldmlld1JlZjogUmVmT2JqZWN0PGFueT4gfCBudWxsID0gbnVsbFxuXHRwcml2YXRlIGRyYWdQcmV2aWV3Tm9kZTogYW55XG5cdHByaXZhdGUgZHJhZ1ByZXZpZXdPcHRpb25zSW50ZXJuYWw6IERyYWdQcmV2aWV3T3B0aW9ucyB8IG51bGwgPSBudWxsXG5cdHByaXZhdGUgZHJhZ1ByZXZpZXdVbnN1YnNjcmliZTogVW5zdWJzY3JpYmUgfCB1bmRlZmluZWRcblxuXHRwcml2YXRlIGxhc3RDb25uZWN0ZWRIYW5kbGVySWQ6IElkZW50aWZpZXIgfCBudWxsID0gbnVsbFxuXHRwcml2YXRlIGxhc3RDb25uZWN0ZWREcmFnU291cmNlOiBhbnkgPSBudWxsXG5cdHByaXZhdGUgbGFzdENvbm5lY3RlZERyYWdTb3VyY2VPcHRpb25zOiBhbnkgPSBudWxsXG5cdHByaXZhdGUgbGFzdENvbm5lY3RlZERyYWdQcmV2aWV3OiBhbnkgPSBudWxsXG5cdHByaXZhdGUgbGFzdENvbm5lY3RlZERyYWdQcmV2aWV3T3B0aW9uczogYW55ID0gbnVsbFxuXG5cdHByaXZhdGUgcmVhZG9ubHkgYmFja2VuZDogQmFja2VuZFxuXG5cdHB1YmxpYyBjb25zdHJ1Y3RvcihiYWNrZW5kOiBCYWNrZW5kKSB7XG5cdFx0dGhpcy5iYWNrZW5kID0gYmFja2VuZFxuXHR9XG5cblx0cHVibGljIHJlY2VpdmVIYW5kbGVySWQobmV3SGFuZGxlcklkOiBJZGVudGlmaWVyIHwgbnVsbCk6IHZvaWQge1xuXHRcdGlmICh0aGlzLmhhbmRsZXJJZCA9PT0gbmV3SGFuZGxlcklkKSB7XG5cdFx0XHRyZXR1cm5cblx0XHR9XG5cblx0XHR0aGlzLmhhbmRsZXJJZCA9IG5ld0hhbmRsZXJJZFxuXHRcdHRoaXMucmVjb25uZWN0KClcblx0fVxuXG5cdHB1YmxpYyBnZXQgY29ubmVjdFRhcmdldCgpOiBhbnkge1xuXHRcdHJldHVybiB0aGlzLmRyYWdTb3VyY2Vcblx0fVxuXG5cdHB1YmxpYyBnZXQgZHJhZ1NvdXJjZU9wdGlvbnMoKTogRHJhZ1NvdXJjZU9wdGlvbnMgfCBudWxsIHtcblx0XHRyZXR1cm4gdGhpcy5kcmFnU291cmNlT3B0aW9uc0ludGVybmFsXG5cdH1cblx0cHVibGljIHNldCBkcmFnU291cmNlT3B0aW9ucyhvcHRpb25zOiBEcmFnU291cmNlT3B0aW9ucyB8IG51bGwpIHtcblx0XHR0aGlzLmRyYWdTb3VyY2VPcHRpb25zSW50ZXJuYWwgPSBvcHRpb25zXG5cdH1cblxuXHRwdWJsaWMgZ2V0IGRyYWdQcmV2aWV3T3B0aW9ucygpOiBEcmFnUHJldmlld09wdGlvbnMgfCBudWxsIHtcblx0XHRyZXR1cm4gdGhpcy5kcmFnUHJldmlld09wdGlvbnNJbnRlcm5hbFxuXHR9XG5cblx0cHVibGljIHNldCBkcmFnUHJldmlld09wdGlvbnMob3B0aW9uczogRHJhZ1ByZXZpZXdPcHRpb25zIHwgbnVsbCkge1xuXHRcdHRoaXMuZHJhZ1ByZXZpZXdPcHRpb25zSW50ZXJuYWwgPSBvcHRpb25zXG5cdH1cblxuXHRwdWJsaWMgcmVjb25uZWN0KCk6IHZvaWQge1xuXHRcdGNvbnN0IGRpZENoYW5nZSA9IHRoaXMucmVjb25uZWN0RHJhZ1NvdXJjZSgpXG5cdFx0dGhpcy5yZWNvbm5lY3REcmFnUHJldmlldyhkaWRDaGFuZ2UpXG5cdH1cblxuXHRwcml2YXRlIHJlY29ubmVjdERyYWdTb3VyY2UoKTogYm9vbGVhbiB7XG5cdFx0Y29uc3QgZHJhZ1NvdXJjZSA9IHRoaXMuZHJhZ1NvdXJjZVxuXHRcdC8vIGlmIG5vdGhpbmcgaGFzIGNoYW5nZWQgdGhlbiBkb24ndCByZXN1YnNjcmliZVxuXHRcdGNvbnN0IGRpZENoYW5nZSA9XG5cdFx0XHR0aGlzLmRpZEhhbmRsZXJJZENoYW5nZSgpIHx8XG5cdFx0XHR0aGlzLmRpZENvbm5lY3RlZERyYWdTb3VyY2VDaGFuZ2UoKSB8fFxuXHRcdFx0dGhpcy5kaWREcmFnU291cmNlT3B0aW9uc0NoYW5nZSgpXG5cblx0XHRpZiAoZGlkQ2hhbmdlKSB7XG5cdFx0XHR0aGlzLmRpc2Nvbm5lY3REcmFnU291cmNlKClcblx0XHR9XG5cblx0XHRpZiAoIXRoaXMuaGFuZGxlcklkKSB7XG5cdFx0XHRyZXR1cm4gZGlkQ2hhbmdlXG5cdFx0fVxuXHRcdGlmICghZHJhZ1NvdXJjZSkge1xuXHRcdFx0dGhpcy5sYXN0Q29ubmVjdGVkRHJhZ1NvdXJjZSA9IGRyYWdTb3VyY2Vcblx0XHRcdHJldHVybiBkaWRDaGFuZ2Vcblx0XHR9XG5cblx0XHRpZiAoZGlkQ2hhbmdlKSB7XG5cdFx0XHR0aGlzLmxhc3RDb25uZWN0ZWRIYW5kbGVySWQgPSB0aGlzLmhhbmRsZXJJZFxuXHRcdFx0dGhpcy5sYXN0Q29ubmVjdGVkRHJhZ1NvdXJjZSA9IGRyYWdTb3VyY2Vcblx0XHRcdHRoaXMubGFzdENvbm5lY3RlZERyYWdTb3VyY2VPcHRpb25zID0gdGhpcy5kcmFnU291cmNlT3B0aW9uc1xuXHRcdFx0dGhpcy5kcmFnU291cmNlVW5zdWJzY3JpYmUgPSB0aGlzLmJhY2tlbmQuY29ubmVjdERyYWdTb3VyY2UoXG5cdFx0XHRcdHRoaXMuaGFuZGxlcklkLFxuXHRcdFx0XHRkcmFnU291cmNlLFxuXHRcdFx0XHR0aGlzLmRyYWdTb3VyY2VPcHRpb25zLFxuXHRcdFx0KVxuXHRcdH1cblx0XHRyZXR1cm4gZGlkQ2hhbmdlXG5cdH1cblxuXHRwcml2YXRlIHJlY29ubmVjdERyYWdQcmV2aWV3KGZvcmNlRGlkQ2hhbmdlID0gZmFsc2UpOiB2b2lkIHtcblx0XHRjb25zdCBkcmFnUHJldmlldyA9IHRoaXMuZHJhZ1ByZXZpZXdcblx0XHQvLyBpZiBub3RoaW5nIGhhcyBjaGFuZ2VkIHRoZW4gZG9uJ3QgcmVzdWJzY3JpYmVcblx0XHRjb25zdCBkaWRDaGFuZ2UgPVxuXHRcdFx0Zm9yY2VEaWRDaGFuZ2UgfHxcblx0XHRcdHRoaXMuZGlkSGFuZGxlcklkQ2hhbmdlKCkgfHxcblx0XHRcdHRoaXMuZGlkQ29ubmVjdGVkRHJhZ1ByZXZpZXdDaGFuZ2UoKSB8fFxuXHRcdFx0dGhpcy5kaWREcmFnUHJldmlld09wdGlvbnNDaGFuZ2UoKVxuXG5cdFx0aWYgKGRpZENoYW5nZSkge1xuXHRcdFx0dGhpcy5kaXNjb25uZWN0RHJhZ1ByZXZpZXcoKVxuXHRcdH1cblxuXHRcdGlmICghdGhpcy5oYW5kbGVySWQpIHtcblx0XHRcdHJldHVyblxuXHRcdH1cblx0XHRpZiAoIWRyYWdQcmV2aWV3KSB7XG5cdFx0XHR0aGlzLmxhc3RDb25uZWN0ZWREcmFnUHJldmlldyA9IGRyYWdQcmV2aWV3XG5cdFx0XHRyZXR1cm5cblx0XHR9XG5cblx0XHRpZiAoZGlkQ2hhbmdlKSB7XG5cdFx0XHR0aGlzLmxhc3RDb25uZWN0ZWRIYW5kbGVySWQgPSB0aGlzLmhhbmRsZXJJZFxuXHRcdFx0dGhpcy5sYXN0Q29ubmVjdGVkRHJhZ1ByZXZpZXcgPSBkcmFnUHJldmlld1xuXHRcdFx0dGhpcy5sYXN0Q29ubmVjdGVkRHJhZ1ByZXZpZXdPcHRpb25zID0gdGhpcy5kcmFnUHJldmlld09wdGlvbnNcblx0XHRcdHRoaXMuZHJhZ1ByZXZpZXdVbnN1YnNjcmliZSA9IHRoaXMuYmFja2VuZC5jb25uZWN0RHJhZ1ByZXZpZXcoXG5cdFx0XHRcdHRoaXMuaGFuZGxlcklkLFxuXHRcdFx0XHRkcmFnUHJldmlldyxcblx0XHRcdFx0dGhpcy5kcmFnUHJldmlld09wdGlvbnMsXG5cdFx0XHQpXG5cdFx0fVxuXHR9XG5cblx0cHJpdmF0ZSBkaWRIYW5kbGVySWRDaGFuZ2UoKTogYm9vbGVhbiB7XG5cdFx0cmV0dXJuIHRoaXMubGFzdENvbm5lY3RlZEhhbmRsZXJJZCAhPT0gdGhpcy5oYW5kbGVySWRcblx0fVxuXG5cdHByaXZhdGUgZGlkQ29ubmVjdGVkRHJhZ1NvdXJjZUNoYW5nZSgpOiBib29sZWFuIHtcblx0XHRyZXR1cm4gdGhpcy5sYXN0Q29ubmVjdGVkRHJhZ1NvdXJjZSAhPT0gdGhpcy5kcmFnU291cmNlXG5cdH1cblxuXHRwcml2YXRlIGRpZENvbm5lY3RlZERyYWdQcmV2aWV3Q2hhbmdlKCk6IGJvb2xlYW4ge1xuXHRcdHJldHVybiB0aGlzLmxhc3RDb25uZWN0ZWREcmFnUHJldmlldyAhPT0gdGhpcy5kcmFnUHJldmlld1xuXHR9XG5cblx0cHJpdmF0ZSBkaWREcmFnU291cmNlT3B0aW9uc0NoYW5nZSgpOiBib29sZWFuIHtcblx0XHRyZXR1cm4gIXNoYWxsb3dFcXVhbChcblx0XHRcdHRoaXMubGFzdENvbm5lY3RlZERyYWdTb3VyY2VPcHRpb25zLFxuXHRcdFx0dGhpcy5kcmFnU291cmNlT3B0aW9ucyxcblx0XHQpXG5cdH1cblxuXHRwcml2YXRlIGRpZERyYWdQcmV2aWV3T3B0aW9uc0NoYW5nZSgpOiBib29sZWFuIHtcblx0XHRyZXR1cm4gIXNoYWxsb3dFcXVhbChcblx0XHRcdHRoaXMubGFzdENvbm5lY3RlZERyYWdQcmV2aWV3T3B0aW9ucyxcblx0XHRcdHRoaXMuZHJhZ1ByZXZpZXdPcHRpb25zLFxuXHRcdClcblx0fVxuXG5cdHB1YmxpYyBkaXNjb25uZWN0RHJhZ1NvdXJjZSgpIHtcblx0XHRpZiAodGhpcy5kcmFnU291cmNlVW5zdWJzY3JpYmUpIHtcblx0XHRcdHRoaXMuZHJhZ1NvdXJjZVVuc3Vic2NyaWJlKClcblx0XHRcdHRoaXMuZHJhZ1NvdXJjZVVuc3Vic2NyaWJlID0gdW5kZWZpbmVkXG5cdFx0fVxuXHR9XG5cblx0cHVibGljIGRpc2Nvbm5lY3REcmFnUHJldmlldygpIHtcblx0XHRpZiAodGhpcy5kcmFnUHJldmlld1Vuc3Vic2NyaWJlKSB7XG5cdFx0XHR0aGlzLmRyYWdQcmV2aWV3VW5zdWJzY3JpYmUoKVxuXHRcdFx0dGhpcy5kcmFnUHJldmlld1Vuc3Vic2NyaWJlID0gdW5kZWZpbmVkXG5cdFx0XHR0aGlzLmRyYWdQcmV2aWV3Tm9kZSA9IG51bGxcblx0XHRcdHRoaXMuZHJhZ1ByZXZpZXdSZWYgPSBudWxsXG5cdFx0fVxuXHR9XG5cblx0cHJpdmF0ZSBnZXQgZHJhZ1NvdXJjZSgpIHtcblx0XHRyZXR1cm4gKFxuXHRcdFx0dGhpcy5kcmFnU291cmNlTm9kZSB8fCAodGhpcy5kcmFnU291cmNlUmVmICYmIHRoaXMuZHJhZ1NvdXJjZVJlZi5jdXJyZW50KVxuXHRcdClcblx0fVxuXG5cdHByaXZhdGUgZ2V0IGRyYWdQcmV2aWV3KCkge1xuXHRcdHJldHVybiAoXG5cdFx0XHR0aGlzLmRyYWdQcmV2aWV3Tm9kZSB8fFxuXHRcdFx0KHRoaXMuZHJhZ1ByZXZpZXdSZWYgJiYgdGhpcy5kcmFnUHJldmlld1JlZi5jdXJyZW50KVxuXHRcdClcblx0fVxuXG5cdHByaXZhdGUgY2xlYXJEcmFnU291cmNlKCkge1xuXHRcdHRoaXMuZHJhZ1NvdXJjZU5vZGUgPSBudWxsXG5cdFx0dGhpcy5kcmFnU291cmNlUmVmID0gbnVsbFxuXHR9XG5cblx0cHJpdmF0ZSBjbGVhckRyYWdQcmV2aWV3KCkge1xuXHRcdHRoaXMuZHJhZ1ByZXZpZXdOb2RlID0gbnVsbFxuXHRcdHRoaXMuZHJhZ1ByZXZpZXdSZWYgPSBudWxsXG5cdH1cbn1cbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQUEsSUFBQUEsYUFBQSxHQUFBQyxPQUFBO0FBS0EsSUFBQUMsTUFBQSxHQUFBRCxPQUFBO0FBQ0EsSUFBQUUsbUJBQUEsR0FBQUYsT0FBQTtBQVNPLE1BQU1HLGVBQWU7RUFvRDNCQyxnQkFBdUJBLENBQUNDLFlBQStCLEVBQVE7SUFDOUQsSUFBSSxJQUFJLENBQUNDLFNBQVMsS0FBS0QsWUFBWSxFQUFFO01BQ3BDOztJQUdELElBQUksQ0FBQ0MsU0FBUyxHQUFHRCxZQUFZO0lBQzdCLElBQUksQ0FBQ0UsU0FBUyxFQUFFOztFQUdqQixJQUFXQyxhQUFhQSxDQUFBLEVBQVE7SUFDL0IsT0FBTyxJQUFJLENBQUNDLFVBQVU7O0VBR3ZCLElBQVdDLGlCQUFpQkEsQ0FBQSxFQUE2QjtJQUN4RCxPQUFPLElBQUksQ0FBQ0MseUJBQXlCOztFQUV0QyxJQUFXRCxpQkFBaUJBLENB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