{"version":3,"names":["_invariant","require","_coords","_dirtiness","_matchesType","DragDropMonitorImpl","subscribeToStateChange","listener","options","handlerIds","invariant","Array","isArray","prevStateId","store","getState","stateId","handleChange","state","currentStateId","canSkipListener","areDirty","dirtyHandlerIds","subscribe","subscribeToOffsetChange","previousState","dragOffset","nextState","canDragSource","sourceId","source","registry","getSource","isDragging","canDrag","canDropOnTarget","targetId","target","getTarget","didDrop","targetType","getTargetType","draggedItemType","getItemType","matchesType","canDrop","Boolean","isDraggingSource","isSourcePublic","sourceType","getSourceType","isOverTarget","shallow","targetIds","getTargetIds","length","index","indexOf","dragOperation","itemType","getItem","item","getSourceId","getDropResult","dropResult","getInitialClientOffset","initialClientOffset","getInitialSourceClientOffset","initialSourceClientOffset","getClientOffset","clientOffset","getSourceClientOffset","getDifferenceFromInitialOffset","constructor","exports"],"sources":["../../src/classes/DragDropMonitorImpl.ts"],"sourcesContent":["import { invariant } from '@react-dnd/invariant'\nimport type { Store } from 'redux'\n\nimport type {\n\tDragDropMonitor,\n\tHandlerRegistry,\n\tIdentifier,\n\tListener,\n\tUnsubscribe,\n\tXYCoord,\n} from '../interfaces.js'\nimport type { State } from '../reducers/index.js'\nimport {\n\tgetDifferenceFromInitialOffset,\n\tgetSourceClientOffset,\n} from '../utils/coords.js'\nimport { areDirty } from '../utils/dirtiness.js'\nimport { matchesType } from '../utils/matchesType.js'\n\nexport class DragDropMonitorImpl implements DragDropMonitor {\n\tprivate store: Store<State>\n\tpublic readonly registry: HandlerRegistry\n\n\tpublic constructor(store: Store<State>, registry: HandlerRegistry) {\n\t\tthis.store = store\n\t\tthis.registry = registry\n\t}\n\n\tpublic subscribeToStateChange(\n\t\tlistener: Listener,\n\t\toptions: { handlerIds?: string[] } = {},\n\t): Unsubscribe {\n\t\tconst { handlerIds } = options\n\t\tinvariant(typeof listener === 'function', 'listener must be a function.')\n\t\tinvariant(\n\t\t\ttypeof handlerIds === 'undefined' || Array.isArray(handlerIds),\n\t\t\t'handlerIds, when specified, must be an array of strings.',\n\t\t)\n\n\t\tlet prevStateId = this.store.getState().stateId\n\t\tconst handleChange = () => {\n\t\t\tconst state = this.store.getState()\n\t\t\tconst currentStateId = state.stateId\n\t\t\ttry {\n\t\t\t\tconst canSkipListener =\n\t\t\t\t\tcurrentStateId === prevStateId ||\n\t\t\t\t\t(currentStateId === prevStateId + 1 &&\n\t\t\t\t\t\t!areDirty(state.dirtyHandlerIds, handlerIds))\n\n\t\t\t\tif (!canSkipListener) {\n\t\t\t\t\tlistener()\n\t\t\t\t}\n\t\t\t} finally {\n\t\t\t\tprevStateId = currentStateId\n\t\t\t}\n\t\t}\n\n\t\treturn this.store.subscribe(handleChange)\n\t}\n\n\tpublic subscribeToOffsetChange(listener: Listener): Unsubscribe {\n\t\tinvariant(typeof listener === 'function', 'listener must be a function.')\n\n\t\tlet previousState = this.store.getState().dragOffset\n\t\tconst handleChange = () => {\n\t\t\tconst nextState = this.store.getState().dragOffset\n\t\t\tif (nextState === previousState) {\n\t\t\t\treturn\n\t\t\t}\n\n\t\t\tpreviousState = nextState\n\t\t\tlistener()\n\t\t}\n\n\t\treturn this.store.subscribe(handleChange)\n\t}\n\n\tpublic canDragSource(sourceId: string | undefined): boolean {\n\t\tif (!sourceId) {\n\t\t\treturn false\n\t\t}\n\t\tconst source = this.registry.getSource(sourceId)\n\t\tinvariant(source, `Expected to find a valid source. sourceId=${sourceId}`)\n\n\t\tif (this.isDragging()) {\n\t\t\treturn false\n\t\t}\n\n\t\treturn source.canDrag(this, sourceId)\n\t}\n\n\tpublic canDropOnTarget(targetId: string | undefined): boolean {\n\t\t// undefined on initial render\n\t\tif (!targetId) {\n\t\t\treturn false\n\t\t}\n\t\tconst target = this.registry.getTarget(targetId)\n\t\tinvariant(target, `Expected to find a valid target. targetId=${targetId}`)\n\n\t\tif (!this.isDragging() || this.didDrop()) {\n\t\t\treturn false\n\t\t}\n\n\t\tconst targetType = this.registry.getTargetType(targetId)\n\t\tconst draggedItemType = this.getItemType()\n\t\treturn (\n\t\t\tmatchesType(targetType, draggedItemType) && target.canDrop(this, targetId)\n\t\t)\n\t}\n\n\tpublic isDragging(): boolean {\n\t\treturn Boolean(this.getItemType())\n\t}\n\n\tpublic isDraggingSource(sourceId: string | undefined): boolean {\n\t\t// undefined on initial render\n\t\tif (!sourceId) {\n\t\t\treturn false\n\t\t}\n\t\tconst source = this.registry.getSource(sourceId, true)\n\t\tinvariant(source, `Expected to find a valid source. sourceId=${sourceId}`)\n\n\t\tif (!this.isDragging() || !this.isSourcePublic()) {\n\t\t\treturn false\n\t\t}\n\n\t\tconst sourceType = this.registry.getSourceType(sourceId)\n\t\tconst draggedItemType = this.getItemType()\n\t\tif (sourceType !== draggedItemType) {\n\t\t\treturn false\n\t\t}\n\n\t\treturn source.isDragging(this, sourceId)\n\t}\n\n\tpublic isOverTarget(\n\t\ttargetId: string | undefined,\n\t\toptions = { shallow: false },\n\t): boolean {\n\t\t// undefined on initial render\n\t\tif (!targetId) {\n\t\t\treturn false\n\t\t}\n\n\t\tconst { shallow } = options\n\t\tif (!this.isDragging()) {\n\t\t\treturn false\n\t\t}\n\n\t\tconst targetType = this.registry.getTargetType(targetId)\n\t\tconst draggedItemType = this.getItemType()\n\t\tif (draggedItemType && !matchesType(targetType, draggedItemType)) {\n\t\t\treturn false\n\t\t}\n\n\t\tconst targetIds = this.getTargetIds()\n\t\tif (!targetIds.length) {\n\t\t\treturn false\n\t\t}\n\n\t\tconst index = targetIds.indexOf(targetId)\n\t\tif (shallow) {\n\t\t\treturn index === targetIds.length - 1\n\t\t} else {\n\t\t\treturn index > -1\n\t\t}\n\t}\n\n\tpublic getItemType(): Identifier {\n\t\treturn this.store.getState().dragOperation.itemType as Identifier\n\t}\n\n\tpublic getItem(): any {\n\t\treturn this.store.getState().dragOperation.item\n\t}\n\n\tpublic getSourceId(): string | null {\n\t\treturn this.store.getState().dragOperation.sourceId\n\t}\n\n\tpublic getTargetIds(): string[] {\n\t\treturn this.store.getState().dragOperation.targetIds\n\t}\n\n\tpublic getDropResult(): any {\n\t\treturn this.store.getState().dragOperation.dropResult\n\t}\n\n\tpublic didDrop(): boolean {\n\t\treturn this.store.getState().dragOperation.didDrop\n\t}\n\n\tpublic isSourcePublic(): boolean {\n\t\treturn Boolean(this.store.getState().dragOperation.isSourcePublic)\n\t}\n\n\tpublic getInitialClientOffset(): XYCoord | null {\n\t\treturn this.store.getState().dragOffset.initialClientOffset\n\t}\n\n\tpublic getInitialSourceClientOffset(): XYCoord | null {\n\t\treturn this.store.getState().dragOffset.initialSourceClientOffset\n\t}\n\n\tpublic getClientOffset(): XYCoord | null {\n\t\treturn this.store.getState().dragOffset.clientOffset\n\t}\n\n\tpublic getSourceClientOffset(): XYCoord | null {\n\t\treturn getSourceClientOffset(this.store.getState().dragOffset)\n\t}\n\n\tpublic getDifferenceFromInitialOffset(): XYCoord | null {\n\t\treturn getDifferenceFromInitialOffset(this.store.getState().dragOffset)\n\t}\n}\n"],"mappings":"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"}