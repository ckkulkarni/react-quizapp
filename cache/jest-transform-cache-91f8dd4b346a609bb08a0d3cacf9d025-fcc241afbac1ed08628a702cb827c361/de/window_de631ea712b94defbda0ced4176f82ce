6d8f8e2f1bcb6831dc6b2ac63e1d3a02
"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;
var _Path2D = _interopRequireDefault(require("./classes/Path2D"));
var _CanvasGradient = _interopRequireDefault(require("./classes/CanvasGradient"));
var _CanvasPattern = _interopRequireDefault(require("./classes/CanvasPattern"));
var _CanvasRenderingContext2D = _interopRequireDefault(require("./classes/CanvasRenderingContext2D"));
var _DOMMatrix = _interopRequireDefault(require("./classes/DOMMatrix"));
var _ImageData = _interopRequireDefault(require("./classes/ImageData"));
var _TextMetrics = _interopRequireDefault(require("./classes/TextMetrics"));
var _ImageBitmap = _interopRequireDefault(require("./classes/ImageBitmap"));
var _prototype = _interopRequireDefault(require("./mock/prototype"));
var _createImageBitmap = _interopRequireDefault(require("./mock/createImageBitmap"));
function _interopRequireDefault(obj) {
  return obj && obj.__esModule ? obj : {
    default: obj
  };
}
/**
 * Created by hustcc 17/12/25.
 * Contract: i@hust.cc
 */
var _default = win => {
  const d = win.document;
  const f = win.document.createElement;

  // jsdom@11.6.2 || jest@^22.0.0, console.error in Function getContext();
  // https://github.com/jsdom/jsdom/blob/4c7698f760fc64f20b2a0ddff450eddbdd193176/lib/jsdom/living/nodes/HTMLCanvasElement-impl.js#L55-L58
  // console.error will make ci error.
  // try {
  //   // get the context 2d.
  //   const ctx = d.createElement('canvas').getContext('2d');
  //
  //   // if canvas and context2d all exist, means mock is not needed.
  //   if (ctx) {
  //     console.warn('Context 2d of canvas is exist! No need to mock');
  //     return win;
  //   }
  // } catch (_) {
  //   // catch the throw `Error: Not implemented: HTMLCanvasElement.prototype.getContext`
  //   // https://github.com/jsdom/jsdom/blob/4c7698f760fc64f20b2a0ddff450eddbdd193176/lib/jsdom/living/nodes/HTMLCanvasElement-impl.js
  //   // when throw error, means mock is needed.
  //   // code continue
  // }
  // if ctx not exist, mock it.
  // just mock canvas creator.
  /*
  win.document.createElement = param => param.toString().toLowerCase() === 'canvas'
    ? createCanvas('canvas')
    : f.call(d, param);
  */
  // if not exist, then mock it.
  if (!win.Path2D) win.Path2D = _Path2D.default;
  if (!win.CanvasGradient) win.CanvasGradient = _CanvasGradient.default;
  if (!win.CanvasPattern) win.CanvasPattern = _CanvasPattern.default;
  if (!win.CanvasRenderingContext2D) win.CanvasRenderingContext2D = _CanvasRenderingContext2D.default;
  if (!win.DOMMatrix) win.DOMMatrix = _DOMMatrix.default;
  if (!win.ImageData) win.ImageData = _ImageData.default;
  if (!win.TextMetrics) win.TextMetrics = _TextMetrics.default;
  if (!win.ImageBitmap) win.ImageBitmap = _ImageBitmap.default;
  if (!win.createImageBitmap) win.createImageBitmap = _createImageBitmap.default;
  (0, _prototype.default)(win);
  return win;
};
exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJPYmplY3QiLCJkZWZpbmVQcm9wZXJ0eSIsImV4cG9ydHMiLCJ2YWx1ZSIsImRlZmF1bHQiLCJfUGF0aDJEIiwiX2ludGVyb3BSZXF1aXJlRGVmYXVsdCIsInJlcXVpcmUiLCJfQ2FudmFzR3JhZGllbnQiLCJfQ2FudmFzUGF0dGVybiIsIl9DYW52YXNSZW5kZXJpbmdDb250ZXh0MkQiLCJfRE9NTWF0cml4IiwiX0ltYWdlRGF0YSIsIl9UZXh0TWV0cmljcyIsIl9JbWFnZUJpdG1hcCIsIl9wcm90b3R5cGUiLCJfY3JlYXRlSW1hZ2VCaXRtYXAiLCJvYmoiLCJfX2VzTW9kdWxlIiwiX2RlZmF1bHQiLCJ3aW4iLCJkIiwiZG9jdW1lbnQiLCJmIiwiY3JlYXRlRWxlbWVudCIsIlBhdGgyRCIsIkNhbnZhc0dyYWRpZW50IiwiQ2FudmFzUGF0dGVybiIsIkNhbnZhc1JlbmRlcmluZ0NvbnRleHQyRCIsIkRPTU1hdHJpeCIsIkltYWdlRGF0YSIsIlRleHRNZXRyaWNzIiwiSW1hZ2VCaXRtYXAiLCJjcmVhdGVJbWFnZUJpdG1hcCJdLCJzb3VyY2VzIjpbIndpbmRvdy5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcblxuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7XG4gIHZhbHVlOiB0cnVlXG59KTtcbmV4cG9ydHMuZGVmYXVsdCA9IHZvaWQgMDtcbnZhciBfUGF0aDJEID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChyZXF1aXJlKFwiLi9jbGFzc2VzL1BhdGgyRFwiKSk7XG52YXIgX0NhbnZhc0dyYWRpZW50ID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChyZXF1aXJlKFwiLi9jbGFzc2VzL0NhbnZhc0dyYWRpZW50XCIpKTtcbnZhciBfQ2FudmFzUGF0dGVybiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZShcIi4vY2xhc3Nlcy9DYW52YXNQYXR0ZXJuXCIpKTtcbnZhciBfQ2FudmFzUmVuZGVyaW5nQ29udGV4dDJEID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChyZXF1aXJlKFwiLi9jbGFzc2VzL0NhbnZhc1JlbmRlcmluZ0NvbnRleHQyRFwiKSk7XG52YXIgX0RPTU1hdHJpeCA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZShcIi4vY2xhc3Nlcy9ET01NYXRyaXhcIikpO1xudmFyIF9JbWFnZURhdGEgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmUoXCIuL2NsYXNzZXMvSW1hZ2VEYXRhXCIpKTtcbnZhciBfVGV4dE1ldHJpY3MgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmUoXCIuL2NsYXNzZXMvVGV4dE1ldHJpY3NcIikpO1xudmFyIF9JbWFnZUJpdG1hcCA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZShcIi4vY2xhc3Nlcy9JbWFnZUJpdG1hcFwiKSk7XG52YXIgX3Byb3RvdHlwZSA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZShcIi4vbW9jay9wcm90b3R5cGVcIikpO1xudmFyIF9jcmVhdGVJbWFnZUJpdG1hcCA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZShcIi4vbW9jay9jcmVhdGVJbWFnZUJpdG1hcFwiKSk7XG5mdW5jdGlvbiBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KG9iaikgeyByZXR1cm4gb2JqICYmIG9iai5fX2VzTW9kdWxlID8gb2JqIDogeyBkZWZhdWx0OiBvYmogfTsgfVxuLyoqXG4gKiBDcmVhdGVkIGJ5IGh1c3RjYyAxNy8xMi8yNS5cbiAqIENvbnRyYWN0OiBpQGh1c3QuY2NcbiAqL1xudmFyIF9kZWZhdWx0ID0gd2luID0+IHtcbiAgY29uc3QgZCA9IHdpbi5kb2N1bWVudDtcbiAgY29uc3QgZiA9IHdpbi5kb2N1bWVudC5jcmVhdGVFbGVtZW50O1xuXG4gIC8vIGpzZG9tQDExLjYuMiB8fCBqZXN0QF4yMi4wLjAsIGNvbnNvbGUuZXJyb3IgaW4gRnVuY3Rpb24gZ2V0Q29udGV4dCgpO1xuICAvLyBodHRwczovL2dpdGh1Yi5jb20vanNkb20vanNkb20vYmxvYi80Yzc2OThmNzYwZmM2NGYyMGIyYTBkZGZmNDUwZWRkYmRkMTkzMTc2L2xpYi9qc2RvbS9saXZpbmcvbm9kZXMvSFRNTENhbnZhc0VsZW1lbnQtaW1wbC5qcyNMNTUtTDU4XG4gIC8vIGNvbnNvbGUuZXJyb3Igd2lsbCBtYWtlIGNpIGVycm9yLlxuICAvLyB0cnkge1xuICAvLyAgIC8vIGdldCB0aGUgY29udGV4dCAyZC5cbiAgLy8gICBjb25zdCBjdHggPSBkLmNyZWF0ZUVsZW1lbnQoJ2NhbnZhcycpLmdldENvbnRleHQoJzJkJyk7XG4gIC8vXG4gIC8vICAgLy8gaWYgY2FudmFzIGFuZCBjb250ZXh0MmQgYWxsIGV4aXN0LCBtZWFucyBtb2NrIGlzIG5vdCBuZWVkZWQuXG4gIC8vICAgaWYgKGN0eCkge1xuICAvLyAgICAgY29uc29sZS53YXJuKCdDb250ZXh0IDJkIG9mIGNhbnZhcyBpcyBleGlzdCEgTm8gbmVlZCB0byBtb2NrJyk7XG4gIC8vICAgICByZXR1cm4gd2luO1xuICAvLyAgIH1cbiAgLy8gfSBjYXRjaCAoXykge1xuICAvLyAgIC8vIGNhdGNoIHRoZSB0aHJvdyBgRXJyb3I6IE5vdCBpbXBsZW1lbnRlZDogSFRNTENhbnZhc0VsZW1lbnQucHJvdG90eXBlLmdldENvbnRleHRgXG4gIC8vICAgLy8gaHR0cHM6Ly9naXRodWIuY29tL2pzZG9tL2pzZG9tL2Jsb2IvNGM3Njk4Zjc2MGZjNjRmMjBiMmEwZGRmZjQ1MGVkZGJkZDE5MzE3Ni9saWIvanNkb20vbGl2aW5nL25vZGVzL0hUTUxDYW52YXNFbGVtZW50LWltcGwuanNcbiAgLy8gICAvLyB3aGVuIHRocm93IGVycm9yLCBtZWFucyBtb2NrIGlzIG5lZWRlZC5cbiAgLy8gICAvLyBjb2RlIGNvbnRpbnVlXG4gIC8vIH1cbiAgLy8gaWYgY3R4IG5vdCBleGlzdCwgbW9jayBpdC5cbiAgLy8ganVzdCBtb2NrIGNhbnZhcyBjcmVhdG9yLlxuICAvKlxuICB3aW4uZG9jdW1lbnQuY3JlYXRlRWxlbWVudCA9IHBhcmFtID0+IHBhcmFtLnRvU3RyaW5nKCkudG9Mb3dlckNhc2UoKSA9PT0gJ2NhbnZhcydcbiAgICA/IGNyZWF0ZUNhbnZhcygnY2FudmFzJylcbiAgICA6IGYuY2FsbChkLCBwYXJhbSk7XG4gICovXG4gIC8vIGlmIG5vdCBleGlzdCwgdGhlbiBtb2NrIGl0LlxuICBpZiAoIXdpbi5QYXRoMkQpIHdpbi5QYXRoMkQgPSBfUGF0aDJELmRlZmF1bHQ7XG4gIGlmICghd2luLkNhbnZhc0dyYWRpZW50KSB3aW4uQ2FudmFzR3JhZGllbnQgPSBfQ2FudmFzR3JhZGllbnQuZGVmYXVsdDtcbiAgaWYgKCF3aW4uQ2FudmFzUGF0dGVybikgd2luLkNhbnZhc1BhdHRlcm4gPSBfQ2FudmFzUGF0dGVybi5kZWZhdWx0O1xuICBpZiAoIXdpbi5DYW52YXNSZW5kZXJpbmdDb250ZXh0MkQpIHdpbi5DYW52YXNSZW5kZXJpbmdDb250ZXh0MkQgPSBfQ2FudmFzUmVuZGVyaW5nQ29udGV4dDJELmRlZmF1bHQ7XG4gIGlmICghd2luLkRPTU1hdHJpeCkgd2luLkRPTU1hdHJpeCA9IF9ET01NYXRyaXguZGVmYXVsdDtcbiAgaWYgKCF3aW4uSW1hZ2VEYXRhKSB3aW4uSW1hZ2VEYXRhID0gX0ltYWdlRGF0YS5kZWZhdWx0O1xuICBpZiAoIXdpbi5UZXh0TWV0cmljcykgd2luLlRleHRNZXRyaWNzID0gX1RleHRNZXRyaWNzLmRlZmF1bHQ7XG4gIGlmICghd2luLkltYWdlQml0bWFwKSB3aW4uSW1hZ2VCaXRtYXAgPSBfSW1hZ2VCaXRtYXAuZGVmYXVsdDtcbiAgaWYgKCF3aW4uY3JlYXRlSW1hZ2VCaXRtYXApIHdpbi5jcmVhdGVJbWFnZUJpdG1hcCA9IF9jcmVhdGVJbWFnZUJpdG1hcC5kZWZhdWx0O1xuICAoMCwgX3Byb3RvdHlwZS5kZWZhdWx0KSh3aW4pO1xuICByZXR1cm4gd2luO1xufTtcbmV4cG9ydHMuZGVmYXVsdCA9IF9kZWZhdWx0OyJdLCJtYXBwaW5ncyI6IkFB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