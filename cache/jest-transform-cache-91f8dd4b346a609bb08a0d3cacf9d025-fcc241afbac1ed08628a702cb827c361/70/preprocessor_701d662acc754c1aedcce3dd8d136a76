a7470a8c1cce83964bd81c516b3d119d
"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.Preprocessor = void 0;
const unicode_js_1 = require("../common/unicode.js");
const error_codes_js_1 = require("../common/error-codes.js");
//Const
const DEFAULT_BUFFER_WATERLINE = 1 << 16;
//Preprocessor
//NOTE: HTML input preprocessing
//(see: http://www.whatwg.org/specs/web-apps/current-work/multipage/parsing.html#preprocessing-the-input-stream)
class Preprocessor {
  constructor(handler) {
    this.handler = handler;
    this.html = '';
    this.pos = -1;
    // NOTE: Initial `lastGapPos` is -2, to ensure `col` on initialisation is 0
    this.lastGapPos = -2;
    this.gapStack = [];
    this.skipNextNewLine = false;
    this.lastChunkWritten = false;
    this.endOfChunkHit = false;
    this.bufferWaterline = DEFAULT_BUFFER_WATERLINE;
    this.isEol = false;
    this.lineStartPos = 0;
    this.droppedBufferSize = 0;
    this.line = 1;
    //NOTE: avoid reporting errors twice on advance/retreat
    this.lastErrOffset = -1;
  }
  /** The column on the current line. If we just saw a gap (eg. a surrogate pair), return the index before. */
  get col() {
    return this.pos - this.lineStartPos + Number(this.lastGapPos !== this.pos);
  }
  get offset() {
    return this.droppedBufferSize + this.pos;
  }
  getError(code) {
    const {
      line,
      col,
      offset
    } = this;
    return {
      code,
      startLine: line,
      endLine: line,
      startCol: col,
      endCol: col,
      startOffset: offset,
      endOffset: offset
    };
  }
  _err(code) {
    if (this.handler.onParseError && this.lastErrOffset !== this.offset) {
      this.lastErrOffset = this.offset;
      this.handler.onParseError(this.getError(code));
    }
  }
  _addGap() {
    this.gapStack.push(this.lastGapPos);
    this.lastGapPos = this.pos;
  }
  _processSurrogate(cp) {
    //NOTE: try to peek a surrogate pair
    if (this.pos !== this.html.length - 1) {
      const nextCp = this.html.charCodeAt(this.pos + 1);
      if ((0, unicode_js_1.isSurrogatePair)(nextCp)) {
        //NOTE: we have a surrogate pair. Peek pair character and recalculate code point.
        this.pos++;
        //NOTE: add a gap that should be avoided during retreat
        this._addGap();
        return (0, unicode_js_1.getSurrogatePairCodePoint)(cp, nextCp);
      }
    }
    //NOTE: we are at the end of a chunk, therefore we can't infer the surrogate pair yet.
    else if (!this.lastChunkWritten) {
      this.endOfChunkHit = true;
      return unicode_js_1.CODE_POINTS.EOF;
    }
    //NOTE: isolated surrogate
    this._err(error_codes_js_1.ERR.surrogateInInputStream);
    return cp;
  }
  willDropParsedChunk() {
    return this.pos > this.bufferWaterline;
  }
  dropParsedChunk() {
    if (this.willDropParsedChunk()) {
      this.html = this.html.substring(this.pos);
      this.lineStartPos -= this.pos;
      this.droppedBufferSize += this.pos;
      this.pos = 0;
      this.lastGapPos = -2;
      this.gapStack.length = 0;
    }
  }
  write(chunk, isLastChunk) {
    if (this.html.length > 0) {
      this.html += chunk;
    } else {
      this.html = chunk;
    }
    this.endOfChunkHit = false;
    this.lastChunkWritten = isLastChunk;
  }
  insertHtmlAtCurrentPos(chunk) {
    this.html = this.html.substring(0, this.pos + 1) + chunk + this.html.substring(this.pos + 1);
    this.endOfChunkHit = false;
  }
  startsWith(pattern, caseSensitive) {
    // Check if our buffer has enough characters
    if (this.pos + pattern.length > this.html.length) {
      this.endOfChunkHit = !this.lastChunkWritten;
      return false;
    }
    if (caseSensitive) {
      return this.html.startsWith(pattern, this.pos);
    }
    for (let i = 0; i < pattern.length; i++) {
      const cp = this.html.charCodeAt(this.pos + i) | 0x20;
      if (cp !== pattern.charCodeAt(i)) {
        return false;
      }
    }
    return true;
  }
  peek(offset) {
    const pos = this.pos + offset;
    if (pos >= this.html.length) {
      this.endOfChunkHit = !this.lastChunkWritten;
      return unicode_js_1.CODE_POINTS.EOF;
    }
    const code = this.html.charCodeAt(pos);
    return code === unicode_js_1.CODE_POINTS.CARRIAGE_RETURN ? unicode_js_1.CODE_POINTS.LINE_FEED : code;
  }
  advance() {
    this.pos++;
    //NOTE: LF should be in the last column of the line
    if (this.isEol) {
      this.isEol = false;
      this.line++;
      this.lineStartPos = this.pos;
    }
    if (this.pos >= this.html.length) {
      this.endOfChunkHit = !this.lastChunkWritten;
      return unicode_js_1.CODE_POINTS.EOF;
    }
    let cp = this.html.charCodeAt(this.pos);
    //NOTE: all U+000D CARRIAGE RETURN (CR) characters must be converted to U+000A LINE FEED (LF) characters
    if (cp === unicode_js_1.CODE_POINTS.CARRIAGE_RETURN) {
      this.isEol = true;
      this.skipNextNewLine = true;
      return unicode_js_1.CODE_POINTS.LINE_FEED;
    }
    //NOTE: any U+000A LINE FEED (LF) characters that immediately follow a U+000D CARRIAGE RETURN (CR) character
    //must be ignored.
    if (cp === unicode_js_1.CODE_POINTS.LINE_FEED) {
      this.isEol = true;
      if (this.skipNextNewLine) {
        // `line` will be bumped again in the recursive call.
        this.line--;
        this.skipNextNewLine = false;
        this._addGap();
        return this.advance();
      }
    }
    this.skipNextNewLine = false;
    if ((0, unicode_js_1.isSurrogate)(cp)) {
      cp = this._processSurrogate(cp);
    }
    //OPTIMIZATION: first check if code point is in the common allowed
    //range (ASCII alphanumeric, whitespaces, big chunk of BMP)
    //before going into detailed performance cost validation.
    const isCommonValidRange = this.handler.onParseError === null || cp > 0x1f && cp < 0x7f || cp === unicode_js_1.CODE_POINTS.LINE_FEED || cp === unicode_js_1.CODE_POINTS.CARRIAGE_RETURN || cp > 0x9f && cp < 64976;
    if (!isCommonValidRange) {
      this._checkForProblematicCharacters(cp);
    }
    return cp;
  }
  _checkForProblematicCharacters(cp) {
    if ((0, unicode_js_1.isControlCodePoint)(cp)) {
      this._err(error_codes_js_1.ERR.controlCharacterInInputStream);
    } else if ((0, unicode_js_1.isUndefinedCodePoint)(cp)) {
      this._err(error_codes_js_1.ERR.noncharacterInInputStream);
    }
  }
  retreat(count) {
    this.pos -= count;
    while (this.pos < this.lastGapPos) {
      this.lastGapPos = this.gapStack.pop();
      this.pos--;
    }
    this.isEol = false;
  }
}
exports.Preprocessor = Preprocessor;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJPYmplY3QiLCJkZWZpbmVQcm9wZXJ0eSIsImV4cG9ydHMiLCJ2YWx1ZSIsIlByZXByb2Nlc3NvciIsInVuaWNvZGVfanNfMSIsInJlcXVpcmUiLCJlcnJvcl9jb2Rlc19qc18xIiwiREVGQVVMVF9CVUZGRVJfV0FURVJMSU5FIiwiY29uc3RydWN0b3IiLCJoYW5kbGVyIiwiaHRtbCIsInBvcyIsImxhc3RHYXBQb3MiLCJnYXBTdGFjayIsInNraXBOZXh0TmV3TGluZSIsImxhc3RDaHVua1dyaXR0ZW4iLCJlbmRPZkNodW5rSGl0IiwiYnVmZmVyV2F0ZXJsaW5lIiwiaXNFb2wiLCJsaW5lU3RhcnRQb3MiLCJkcm9wcGVkQnVmZmVyU2l6ZSIsImxpbmUiLCJsYXN0RXJyT2Zmc2V0IiwiY29sIiwiTnVtYmVyIiwib2Zmc2V0IiwiZ2V0RXJyb3IiLCJjb2RlIiwic3RhcnRMaW5lIiwiZW5kTGluZSIsInN0YXJ0Q29sIiwiZW5kQ29sIiwic3RhcnRPZmZzZXQiLCJlbmRPZmZzZXQiLCJfZXJyIiwib25QYXJzZUVycm9yIiwiX2FkZEdhcCIsInB1c2giLCJfcHJvY2Vzc1N1cnJvZ2F0ZSIsImNwIiwibGVuZ3RoIiwibmV4dENwIiwiY2hhckNvZGVBdCIsImlzU3Vycm9nYXRlUGFpciIsImdldFN1cnJvZ2F0ZVBhaXJDb2RlUG9pbnQiLCJDT0RFX1BPSU5UUyIsIkVPRiIsIkVSUiIsInN1cnJvZ2F0ZUluSW5wdXRTdHJlYW0iLCJ3aWxsRHJvcFBhcnNlZENodW5rIiwiZHJvcFBhcnNlZENodW5rIiwic3Vic3RyaW5nIiwid3JpdGUiLCJjaHVuayIsImlzTGFzdENodW5rIiwiaW5zZXJ0SHRtbEF0Q3VycmVudFBvcyIsInN0YXJ0c1dpdGgiLCJwYXR0ZXJuIiwiY2FzZVNlbnNpdGl2ZSIsImkiLCJwZWVrIiwiQ0FSUklBR0VfUkVUVVJOIiwiTElORV9GRUVEIiwiYWR2YW5jZSIsImlzU3Vycm9nYXRlIiwiaXNDb21tb25WYWxpZFJhbmdlIiwiX2NoZWNrRm9yUHJvYmxlbWF0aWNDaGFyYWN0ZXJzIiwiaXNDb250cm9sQ29kZVBvaW50IiwiY29udHJvbENoYXJhY3RlckluSW5wdXRTdHJlYW0iLCJpc1VuZGVmaW5lZENvZGVQb2ludCIsIm5vbmNoYXJhY3RlckluSW5wdXRTdHJlYW0iLCJyZXRyZWF0IiwiY291bnQiLCJwb3AiXSwic291cmNlcyI6WyJwcmVwcm9jZXNzb3IuanMiXSwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLlByZXByb2Nlc3NvciA9IHZvaWQgMDtcbmNvbnN0IHVuaWNvZGVfanNfMSA9IHJlcXVpcmUoXCIuLi9jb21tb24vdW5pY29kZS5qc1wiKTtcbmNvbnN0IGVycm9yX2NvZGVzX2pzXzEgPSByZXF1aXJlKFwiLi4vY29tbW9uL2Vycm9yLWNvZGVzLmpzXCIpO1xuLy9Db25zdFxuY29uc3QgREVGQVVMVF9CVUZGRVJfV0FURVJMSU5FID0gMSA8PCAxNjtcbi8vUHJlcHJvY2Vzc29yXG4vL05PVEU6IEhUTUwgaW5wdXQgcHJlcHJvY2Vzc2luZ1xuLy8oc2VlOiBodHRwOi8vd3d3LndoYXR3Zy5vcmcvc3BlY3Mvd2ViLWFwcHMvY3VycmVudC13b3JrL211bHRpcGFnZS9wYXJzaW5nLmh0bWwjcHJlcHJvY2Vzc2luZy10aGUtaW5wdXQtc3RyZWFtKVxuY2xhc3MgUHJlcHJvY2Vzc29yIHtcbiAgICBjb25zdHJ1Y3RvcihoYW5kbGVyKSB7XG4gICAgICAgIHRoaXMuaGFuZGxlciA9IGhhbmRsZXI7XG4gICAgICAgIHRoaXMuaHRtbCA9ICcnO1xuICAgICAgICB0aGlzLnBvcyA9IC0xO1xuICAgICAgICAvLyBOT1RFOiBJbml0aWFsIGBsYXN0R2FwUG9zYCBpcyAtMiwgdG8gZW5zdXJlIGBjb2xgIG9uIGluaXRpYWxpc2F0aW9uIGlzIDBcbiAgICAgICAgdGhpcy5sYXN0R2FwUG9zID0gLTI7XG4gICAgICAgIHRoaXMuZ2FwU3RhY2sgPSBbXTtcbiAgICAgICAgdGhpcy5za2lwTmV4dE5ld0xpbmUgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5sYXN0Q2h1bmtXcml0dGVuID0gZmFsc2U7XG4gICAgICAgIHRoaXMuZW5kT2ZDaHVua0hpdCA9IGZhbHNlO1xuICAgICAgICB0aGlzLmJ1ZmZlcldhdGVybGluZSA9IERFRkFVTFRfQlVGRkVSX1dBVEVSTElORTtcbiAgICAgICAgdGhpcy5pc0VvbCA9IGZhbHNlO1xuICAgICAgICB0aGlzLmxpbmVTdGFydFBvcyA9IDA7XG4gICAgICAgIHRoaXMuZHJvcHBlZEJ1ZmZlclNpemUgPSAwO1xuICAgICAgICB0aGlzLmxpbmUgPSAxO1xuICAgICAgICAvL05PVEU6IGF2b2lkIHJlcG9ydGluZyBlcnJvcnMgdHdpY2Ugb24gYWR2YW5jZS9yZXRyZWF0XG4gICAgICAgIHRoaXMubGFzdEVyck9mZnNldCA9IC0xO1xuICAgIH1cbiAgICAvKiogVGhlIGNvbHVtbiBvbiB0aGUgY3VycmVudCBsaW5lLiBJZiB3ZSBqdXN0IHNhdyBhIGdhcCAoZWcuIGEgc3Vycm9nYXRlIHBhaXIpLCByZXR1cm4gdGhlIGluZGV4IGJlZm9yZS4gKi9cbiAgICBnZXQgY29sKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5wb3MgLSB0aGlzLmxpbmVTdGFydFBvcyArIE51bWJlcih0aGlzLmxhc3RHYXBQb3MgIT09IHRoaXMucG9zKTtcbiAgICB9XG4gICAgZ2V0IG9mZnNldCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZHJvcHBlZEJ1ZmZlclNpemUgKyB0aGlzLnBvcztcbiAgICB9XG4gICAgZ2V0RXJyb3IoY29kZSkge1xuICAgICAgICBjb25zdCB7IGxpbmUsIGNvbCwgb2Zmc2V0IH0gPSB0aGlzO1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgY29kZSxcbiAgICAgICAgICAgIHN0YXJ0TGluZTogbGluZSxcbiAgICAgICAgICAgIGVuZExpbmU6IGxpbmUsXG4gICAgICAgICAgICBzdGFydENvbDogY29sLFxuICAgICAgICAgICAgZW5kQ29sOiBjb2wsXG4gICAgICAgICAgICBzdGFydE9mZnNldDogb2Zmc2V0LFxuICAgICAgICAgICAgZW5kT2Zmc2V0OiBvZmZzZXQsXG4gICAgICAgIH07XG4gICAgfVxuICAgIF9lcnIoY29kZSkge1xuICAgICAgICBpZiAodGhpcy5oYW5kbGVyLm9uUGFyc2VFcnJvciAmJiB0aGlzLmxhc3RFcnJPZmZzZXQgIT09IHRoaXMub2Zmc2V0KSB7XG4gICAgICAgICAgICB0aGlzLmxhc3RFcnJPZmZzZXQgPSB0aGlzLm9mZnNldDtcbiAgICAgICAgICAgIHRoaXMuaGFuZGxlci5vblBhcnNlRXJyb3IodGhpcy5nZXRFcnJvcihjb2RlKSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgX2FkZEdhcCgpIHtcbiAgICAgICAgdGhpcy5nYXBTdGFjay5wdXNoKHRoaXMubGFzdEdhcFBvcyk7XG4gICAgICAgIHRoaXMubGFzdEdhcFBvcyA9IHRoaXMucG9zO1xuICAgIH1cbiAgICBfcHJvY2Vzc1N1cnJvZ2F0ZShjcCkge1xuICAgICAgICAvL05PVEU6IHRyeSB0byBwZWVrIGEgc3Vycm9nYXRlIHBhaXJcbiAgICAgICAgaWYgKHRoaXMucG9zICE9PSB0aGlzLmh0bWwubGVuZ3RoIC0gMSkge1xuICAgICAgICAgICAgY29uc3QgbmV4dENwID0gdGhpcy5odG1sLmNoYXJDb2RlQXQodGhpcy5wb3MgKyAxKTtcbiAgICAgICAgICAgIGlmICgoMCwgdW5pY29kZV9qc18xLmlzU3Vycm9nYXRlUGFpcikobmV4dENwKSkge1xuICAgICAgICAgICAgICAgIC8vTk9URTogd2UgaGF2ZSBhIHN1cnJvZ2F0ZSBwYWlyLiBQZWVrIHBhaXIgY2hhcmFjdGVyIGFuZCByZWNhbGN1bGF0ZSBjb2RlIHBvaW50LlxuICAgICAgICAgICAgICAgIHRoaXMucG9zKys7XG4gICAgICAgICAgICAgICAgLy9OT1RFOiBhZGQgYSBnYXAgdGhhdCBzaG91bGQgYmUgYXZvaWRlZCBkdXJpbmcgcmV0cmVhdFxuICAgICAgICAgICAgICAgIHRoaXMuX2FkZEdhcCgpO1xuICAgICAgICAgICAgICAgIHJldHVybiAoMCwgdW5pY29kZV9qc18xLmdldFN1cnJvZ2F0ZVBhaXJDb2RlUG9pbnQpKGNwLCBuZXh0Q3ApO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIC8vTk9URTogd2UgYXJlIGF0IHRoZSBlbmQgb2YgYSBjaHVuaywgdGhlcmVmb3JlIHdlIGNhbid0IGluZmVyIHRoZSBzdXJyb2dhdGUgcGFpciB5ZXQuXG4gICAgICAgIGVsc2UgaWYgKCF0aGlzLmxhc3RDaHVua1dyaXR0ZW4pIHtcbiAgICAgICAgICAgIHRoaXMuZW5kT2ZDaHVua0hpdCA9IHRydWU7XG4gICAgICAgICAgICByZXR1cm4gdW5pY29kZV9qc18xLkNPREVfUE9JTlRTLkVPRjtcbiAgICAgICAgfVxuICAgICAgICAvL05PVEU6IGlzb2xhdGVkIHN1cnJvZ2F0ZVxuICAgICAgICB0aGlzLl9lcnIoZXJyb3JfY29kZXNfanNfMS5FUlIuc3Vycm9nYXRlSW5JbnB1dFN0cmVhbSk7XG4gICAgICAgIHJldHVybiBjcDtcbiAgICB9XG4gICAgd2lsbERyb3BQYXJzZWRDaHVuaygpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucG9zID4gdGhpcy5idWZmZXJXYXRlcmxpbmU7XG4gICAgfVxuICAgIGRyb3BQYXJzZWRDaHVuaygpIHtcbiAgICAgICAgaWYgKHRoaXMud2lsbERyb3BQYXJzZWRDaHVuaygpKSB7XG4gICAgICAgICAgICB0aGlzLmh0bWwgPSB0aGlzLmh0bWwuc3Vic3RyaW5nKHRoaXMucG9zKTtcbiAgICAgICAgICAgIHRoaXMubGluZVN0YXJ0UG9zIC09IHRoaXMucG9zO1xuICAgICAgICAgICAgdGhpcy5kcm9wcGVkQnVmZmVyU2l6ZSArPSB0aGlzLnBvcztcbiAgICAgICAgICAgIHRoaXMucG9zID0gMDtcbiAgICAgICAgICAgIHRoaXMubGFzdEdhcFBvcyA9IC0yO1xuICAgICAgICAgICAgdGhpcy5nYXBTdGFjay5sZW5ndGggPSAwO1xuICAgICAgICB9XG4gICAgfVxuICAgIHdyaXRlKGNodW5rLCBpc0xhc3RDaHVuaykge1xuICAgICAgICBpZiAodGhpcy5odG1sLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgIHRoaXMuaHRtbCArPSBjaHVuaztcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuaHRtbCA9IGNodW5rO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuZW5kT2ZDaHVua0hpdCA9IGZhbHNlO1xuICAgICAgICB0aGlzLmxhc3RDaHVua1dyaXR0ZW4gPSBpc0xhc3RDaHVuaztcbiAgICB9XG4gICAgaW5zZXJ0SHRtbEF0Q3VycmVudFBvcyhjaHVuaykge1xuICAgICAgICB0aGlzLmh0bWwgPSB0aGlzLmh0bWwuc3Vic3RyaW5nKDAsIHRoaXMucG9zICsgMSkgKyBjaHVuayArIHRoaXMuaHRtbC5zdWJzdHJpbmcodGhpcy5wb3MgKyAxKTtcbiAgICAgICAgdGhpcy5lbmRPZkNodW5rSGl0ID0gZmFsc2U7XG4gICAgfVxuICAgIHN0YXJ0c1dpdGgocGF0dGVybiwgY2FzZVNlbnNpdGl2ZSkge1xuICAgICAgICAvLyBDaGVjayBpZiBvdXIgYnVmZmVyIGhhcyBlbm91Z2ggY2hhcmFjdGVyc1xuICAgICAgICBpZiAodGhpcy5wb3MgKyBwYXR0ZXJuLmxlbmd0aCA+IHRoaXMuaHRtbC5sZW5ndGgpIHtcbiAgICAgICAgICAgIHRoaXMuZW5kT2ZDaHVua0hpdCA9ICF0aGlzLmxhc3RDaHVua1dyaXR0ZW47XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGNhc2VTZW5zaXRpdmUpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmh0bWwuc3RhcnRzV2l0aChwYXR0ZXJuLCB0aGlzLnBvcyk7XG4gICAgICAgIH1cbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBwYXR0ZXJuLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICBjb25zdCBjcCA9IHRoaXMuaHRtbC5jaGFyQ29kZUF0KHRoaXMucG9zICsgaSkgfCAweDIwO1xuICAgICAgICAgICAgaWYgKGNwICE9PSBwYXR0ZXJuLmNoYXJDb2RlQXQoaSkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICAgIHBlZWsob2Zmc2V0KSB7XG4gICAgICAgIGNvbnN0IHBvcyA9IHRoaXMucG9zICsgb2Zmc2V0O1xuICAgICAgICBpZiAocG9zID49IHRoaXMuaHRtbC5sZW5ndGgpIHtcbiAgICAgICAgICAgIHRoaXMuZW5kT2ZDaHVua0hpdCA9ICF0aGlzLmxhc3RDaHVua1dyaXR0ZW47XG4gICAgICAgICAgICByZXR1cm4gdW5pY29kZV9qc18xLkNPREVfUE9JTlRTLkVPRjtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBjb2RlID0gdGhpcy5odG1sLmNoYXJDb2RlQXQocG9zKTtcbiAgICAgICAgcmV0dXJuIGNvZGUgPT09IHVuaWNvZGVfanNfMS5DT0RFX1BPSU5UUy5DQVJSSUFHRV9SRVRVUk4gPyB1bmljb2RlX2pzXzEuQ09ERV9QT0lOVFMuTElORV9GRUVEIDogY29kZTtcbiAgICB9XG4gICAgYWR2YW5jZSgpIHtcbiAgICAgICAgdGhpcy5wb3MrKztcbiAgICAgICAgLy9OT1RFOiBMRiBzaG91bGQgYmUgaW4gdGhlIGxhc3QgY29sdW1uIG9mIHRoZSBsaW5lXG4gICAgICAgIGlmICh0aGlzLmlzRW9sKSB7XG4gICAgICAgICAgICB0aGlzLmlzRW9sID0gZmFsc2U7XG4gICAgICAgICAgICB0aGlzLmxpbmUrKztcbiAgICAgICAgICAgIHRoaXMubGluZVN0YXJ0UG9zID0gdGhpcy5wb3M7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMucG9zID49IHRoaXMuaHRtbC5sZW5ndGgpIHtcbiAgICAgICAgICAgIHRoaXMuZW5kT2ZDaHVua0hpdCA9ICF0aGlzLmxhc3RDaHVua1dyaXR0ZW47XG4gICAgICAgICAgICByZXR1cm4gdW5pY29kZV9qc18xLkNPREVfUE9JTlRTLkVPRjtcbiAgICAgICAgfVxuICAgICAgICBsZXQgY3AgPSB0aGlzLmh0bWwuY2hhckNvZGVBdCh0aGlzLnBvcyk7XG4gICAgICAgIC8vTk9URTogYWxsIFUrMDAwRCBDQVJSSUFHRSBSRVRVUk4gKENSKSBjaGFyYWN0ZXJzIG11c3QgYmUgY29udmVydGVkIHRvIFUrMDAwQSBMSU5FIEZFRUQgKExGKSBjaGFyYWN0ZXJzXG4gICAgICAgIGlmIChjcCA9PT0gdW5pY29kZV9qc18xLkNPREVfUE9JTlRTLkNBUlJJQUdFX1JFVFVSTikge1xuICAgICAgICAgICAgdGhpcy5pc0VvbCA9IHRydWU7XG4gICAgICAgICAgICB0aGlzLnNraXBOZXh0TmV3TGluZSA9IHRydWU7XG4gICAgICAgICAgICByZXR1cm4gdW5pY29kZV9qc18xLkNPREVfUE9JTlRTLkxJTkVfRkVFRDtcbiAgICAgICAgfVxuICAgICAgICAvL05PVEU6IGFueSBVKzAwMEEgTElORSBGRUVEIChMRikgY2hhcmFjdGVycyB0aGF0IGltbWVkaWF0ZWx5IGZvbGxvdyBhIFUrMDAwRCBDQVJSSUFHRSBSRVRVUk4gKENSKSBjaGFyYWN0ZXJcbiAgICAgICAgLy9tdXN0IGJlIGlnbm9yZWQuXG4gICAgICAgIGlmIChjcCA9PT0gdW5pY29kZV9qc18xLkNPREVfUE9JTlRTLkxJTkVfRkVFRCkge1xuICAgICAgICAgICAgdGhpcy5pc0VvbCA9IHRydWU7XG4gICAgICAgICAgICBpZiAodGhpcy5za2lwTmV4dE5ld0xpbmUpIHtcbiAgICAgICAgICAgICAgICAvLyBgbGluZWAgd2lsbCBiZSBidW1wZWQgYWdhaW4gaW4gdGhlIHJlY3Vyc2l2ZSBjYWxsLlxuICAgICAgICAgICAgICAgIHRoaXMubGluZS0tO1xuICAgICAgICAgICAgICAgIHRoaXMuc2tpcE5leHROZXdMaW5lID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgdGhpcy5fYWRkR2FwKCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuYWR2YW5jZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHRoaXMuc2tpcE5leHROZXdMaW5lID0gZmFsc2U7XG4gICAgICAgIGlmICgoMCwgdW5pY29kZV9qc18xLmlzU3Vycm9nYXRlKShjcCkpIHtcbiAgICAgICAgICAgIGNwID0gdGhpcy5fcHJvY2Vzc1N1cnJvZ2F0ZShjcCk7XG4gICAgICAgIH1cbiAgICAgICAgLy9PUFRJTUlaQVRJT046IGZpcnN0IGNoZWNrIGlmIGNvZGUgcG9pbnQgaXMgaW4gdGhlIGNvbW1vbiBhbGxvd2VkXG4gICAgICAgIC8vcmFuZ2UgKEFTQ0lJIGFscGhhbnVtZXJpYywgd2hpdGVzcGFjZXMsIGJpZyBjaHVuayBvZiBCTVApXG4gICAgICAgIC8vYmVmb3JlIGdvaW5nIGludG8gZGV0YWlsZWQgcGVyZm9ybWFuY2UgY29zdCB2YWxpZGF0aW9uLlxuICAgICAgICBjb25zdCBpc0NvbW1vblZhbGlkUmFuZ2UgPSB0aGlzLmhhbmRsZXIub25QYXJzZUVycm9yID09PSBudWxsIHx8XG4gICAgICAgICAgICAoY3AgPiAweDFmICYmIGNwIDwgMHg3ZikgfHxcbiAgICAgICAgICAgIGNwID09PSB1bmljb2RlX2pzXzEuQ09ERV9QT0lOVFMuTElORV9GRUVEIHx8XG4gICAgICAgICAgICBjcCA9PT0gdW5pY29kZV9qc18xLkNPREVfUE9JTlRTLkNBUlJJQUdFX1JFVFVSTiB8fFxuICAgICAgICAgICAgKGNwID4gMHg5ZiAmJiBjcCA8IDY0OTc2KTtcbiAgICAgICAgaWYgKCFpc0NvbW1vblZhbGlkUmFuZ2UpIHtcbiAgICAgICAgICAgIHRoaXMuX2NoZWNrRm9yUHJvYmxlbWF0aWNDaGFyYWN0ZXJzKGNwKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gY3A7XG4gICAgfVxuICAgIF9jaGVja0ZvclByb2JsZW1hdGljQ2hhcmFjdGVycyhjcCkge1xuICAgICAgICBpZiAoKDAsIHVuaWNvZGVfanNfMS5pc0NvbnRyb2xDb2RlUG9pbnQpKGNwKSkge1xuICAgICAgICAgICAgdGhpcy5fZXJyKGVycm9yX2NvZGVzX2pzXzEuRVJSLmNvbnRyb2xDaGFyYWN0ZXJJbklucHV0U3RyZWFtKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmICgoMCwgdW5pY29kZV9qc18xLmlzVW5kZWZpbmVkQ29kZVBvaW50KShjcCkpIHtcbiAgICAgICAgICAgIHRoaXMuX2VycihlcnJvcl9jb2Rlc19qc18xLkVSUi5ub25jaGFyYWN0ZXJJbklucHV0U3RyZWFtKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICByZXRyZWF0KGNvdW50KSB7XG4gICAgICAgIHRoaXMucG9zIC09IGNvdW50O1xuICAgICAgICB3aGlsZSAodGhpcy5wb3MgPCB0aGlzLmxhc3RHYXBQb3MpIHtcbiAgICAgICAgICAgIHRoaXMubGFzdEdhcFBvcyA9IHRoaXMuZ2FwU3RhY2sucG9wKCk7XG4gICAgICAgICAgICB0aGlzLnBvcy0tO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuaXNFb2wgPSBmYWxzZTtcbiAgICB9XG59XG5leHBvcnRzLlByZXByb2Nlc3NvciA9IFByZXByb2Nlc3Nvcjtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPXByZXByb2Nlc3Nvci5qcy5tYXAiXSwibWFwcGluZ3MiOiJBQUFBLFlBQVk7O0FBQ1pBLE1BQU0sQ0FBQ0MsY0FBYyxDQUFDQyxPQUFPLEVBQUUsWUFBWSxFQUFFO0VBQUVDLEtBQUssRUFBRTtBQUFLLENBQUMsQ0FBQztBQUM3REQsT0FBTyxDQUFDRSxZQUFZLEdBQUcsS0FBSyxDQUFDO0FBQzdCLE1BQU1DLFlBQVksR0FBR0MsT0FBTyxDQUFDLHNCQUFzQixDQUFDO0FBQ3BELE1BQU1DLGdCQUFnQixHQUFHRCxPQUFPLENBQUMsMEJBQTBCLENBQUM7QUFDNUQ7QUFDQSxNQUFNRSx3QkFBd0IsR0FBRyxDQUFDLElBQUksRUFBRTtBQUN4QztBQUNBO0FBQ0E7QUFDQSxNQUFNSixZQUFZLENBQUM7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