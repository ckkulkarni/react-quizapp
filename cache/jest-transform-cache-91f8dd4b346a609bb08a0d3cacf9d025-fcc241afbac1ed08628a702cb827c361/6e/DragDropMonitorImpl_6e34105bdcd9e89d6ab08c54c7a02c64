e7a60a65ded62452e00998a802731e06
"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.DragDropMonitorImpl = void 0;
var _invariant = require("@react-dnd/invariant");
var _coords = require("../utils/coords.js");
var _dirtiness = require("../utils/dirtiness.js");
var _matchesType = require("../utils/matchesType.js");
class DragDropMonitorImpl {
  subscribeToStateChange(listener, options = {}) {
    const {
      handlerIds
    } = options;
    (0, _invariant.invariant)(typeof listener === 'function', 'listener must be a function.');
    (0, _invariant.invariant)(typeof handlerIds === 'undefined' || Array.isArray(handlerIds), 'handlerIds, when specified, must be an array of strings.');
    let prevStateId = this.store.getState().stateId;
    const handleChange = () => {
      const state = this.store.getState();
      const currentStateId = state.stateId;
      try {
        const canSkipListener = currentStateId === prevStateId || currentStateId === prevStateId + 1 && !(0, _dirtiness.areDirty)(state.dirtyHandlerIds, handlerIds);
        if (!canSkipListener) {
          listener();
        }
      } finally {
        prevStateId = currentStateId;
      }
    };
    return this.store.subscribe(handleChange);
  }
  subscribeToOffsetChange(listener) {
    (0, _invariant.invariant)(typeof listener === 'function', 'listener must be a function.');
    let previousState = this.store.getState().dragOffset;
    const handleChange = () => {
      const nextState = this.store.getState().dragOffset;
      if (nextState === previousState) {
        return;
      }
      previousState = nextState;
      listener();
    };
    return this.store.subscribe(handleChange);
  }
  canDragSource(sourceId) {
    if (!sourceId) {
      return false;
    }
    const source = this.registry.getSource(sourceId);
    (0, _invariant.invariant)(source, `Expected to find a valid source. sourceId=${sourceId}`);
    if (this.isDragging()) {
      return false;
    }
    return source.canDrag(this, sourceId);
  }
  canDropOnTarget(targetId) {
    // undefined on initial render
    if (!targetId) {
      return false;
    }
    const target = this.registry.getTarget(targetId);
    (0, _invariant.invariant)(target, `Expected to find a valid target. targetId=${targetId}`);
    if (!this.isDragging() || this.didDrop()) {
      return false;
    }
    const targetType = this.registry.getTargetType(targetId);
    const draggedItemType = this.getItemType();
    return (0, _matchesType.matchesType)(targetType, draggedItemType) && target.canDrop(this, targetId);
  }
  isDragging() {
    return Boolean(this.getItemType());
  }
  isDraggingSource(sourceId) {
    // undefined on initial render
    if (!sourceId) {
      return false;
    }
    const source = this.registry.getSource(sourceId, true);
    (0, _invariant.invariant)(source, `Expected to find a valid source. sourceId=${sourceId}`);
    if (!this.isDragging() || !this.isSourcePublic()) {
      return false;
    }
    const sourceType = this.registry.getSourceType(sourceId);
    const draggedItemType = this.getItemType();
    if (sourceType !== draggedItemType) {
      return false;
    }
    return source.isDragging(this, sourceId);
  }
  isOverTarget(targetId, options = {
    shallow: false
  }) {
    // undefined on initial render
    if (!targetId) {
      return false;
    }
    const {
      shallow
    } = options;
    if (!this.isDragging()) {
      return false;
    }
    const targetType = this.registry.getTargetType(targetId);
    const draggedItemType = this.getItemType();
    if (draggedItemType && !(0, _matchesType.matchesType)(targetType, draggedItemType)) {
      return false;
    }
    const targetIds = this.getTargetIds();
    if (!targetIds.length) {
      return false;
    }
    const index = targetIds.indexOf(targetId);
    if (shallow) {
      return index === targetIds.length - 1;
    } else {
      return index > -1;
    }
  }
  getItemType() {
    return this.store.getState().dragOperation.itemType;
  }
  getItem() {
    return this.store.getState().dragOperation.item;
  }
  getSourceId() {
    return this.store.getState().dragOperation.sourceId;
  }
  getTargetIds() {
    return this.store.getState().dragOperation.targetIds;
  }
  getDropResult() {
    return this.store.getState().dragOperation.dropResult;
  }
  didDrop() {
    return this.store.getState().dragOperation.didDrop;
  }
  isSourcePublic() {
    return Boolean(this.store.getState().dragOperation.isSourcePublic);
  }
  getInitialClientOffset() {
    return this.store.getState().dragOffset.initialClientOffset;
  }
  getInitialSourceClientOffset() {
    return this.store.getState().dragOffset.initialSourceClientOffset;
  }
  getClientOffset() {
    return this.store.getState().dragOffset.clientOffset;
  }
  getSourceClientOffset() {
    return (0, _coords.getSourceClientOffset)(this.store.getState().dragOffset);
  }
  getDifferenceFromInitialOffset() {
    return (0, _coords.getDifferenceFromInitialOffset)(this.store.getState().dragOffset);
  }
  constructor(store, registry) {
    this.store = store;
    this.registry = registry;
  }
}
exports.DragDropMonitorImpl = DragDropMonitorImpl;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfaW52YXJpYW50IiwicmVxdWlyZSIsIl9jb29yZHMiLCJfZGlydGluZXNzIiwiX21hdGNoZXNUeXBlIiwiRHJhZ0Ryb3BNb25pdG9ySW1wbCIsInN1YnNjcmliZVRvU3RhdGVDaGFuZ2UiLCJsaXN0ZW5lciIsIm9wdGlvbnMiLCJoYW5kbGVySWRzIiwiaW52YXJpYW50IiwiQXJyYXkiLCJpc0FycmF5IiwicHJldlN0YXRlSWQiLCJzdG9yZSIsImdldFN0YXRlIiwic3RhdGVJZCIsImhhbmRsZUNoYW5nZSIsInN0YXRlIiwiY3VycmVudFN0YXRlSWQiLCJjYW5Ta2lwTGlzdGVuZXIiLCJhcmVEaXJ0eSIsImRpcnR5SGFuZGxlcklkcyIsInN1YnNjcmliZSIsInN1YnNjcmliZVRvT2Zmc2V0Q2hhbmdlIiwicHJldmlvdXNTdGF0ZSIsImRyYWdPZmZzZXQiLCJuZXh0U3RhdGUiLCJjYW5EcmFnU291cmNlIiwic291cmNlSWQiLCJzb3VyY2UiLCJyZWdpc3RyeSIsImdldFNvdXJjZSIsImlzRHJhZ2dpbmciLCJjYW5EcmFnIiwiY2FuRHJvcE9uVGFyZ2V0IiwidGFyZ2V0SWQiLCJ0YXJnZXQiLCJnZXRUYXJnZXQiLCJkaWREcm9wIiwidGFyZ2V0VHlwZSIsImdldFRhcmdldFR5cGUiLCJkcmFnZ2VkSXRlbVR5cGUiLCJnZXRJdGVtVHlwZSIsIm1hdGNoZXNUeXBlIiwiY2FuRHJvcCIsIkJvb2xlYW4iLCJpc0RyYWdnaW5nU291cmNlIiwiaXNTb3VyY2VQdWJsaWMiLCJzb3VyY2VUeXBlIiwiZ2V0U291cmNlVHlwZSIsImlzT3ZlclRhcmdldCIsInNoYWxsb3ciLCJ0YXJnZXRJZHMiLCJnZXRUYXJnZXRJZHMiLCJsZW5ndGgiLCJpbmRleCIsImluZGV4T2YiLCJkcmFnT3BlcmF0aW9uIiwiaXRlbVR5cGUiLCJnZXRJdGVtIiwiaXRlbSIsImdldFNvdXJjZUlkIiwiZ2V0RHJvcFJlc3VsdCIsImRyb3BSZXN1bHQiLCJnZXRJbml0aWFsQ2xpZW50T2Zmc2V0IiwiaW5pdGlhbENsaWVudE9mZnNldCIsImdldEluaXRpYWxTb3VyY2VDbGllbnRPZmZzZXQiLCJpbml0aWFsU291cmNlQ2xpZW50T2Zmc2V0IiwiZ2V0Q2xpZW50T2Zmc2V0IiwiY2xpZW50T2Zmc2V0IiwiZ2V0U291cmNlQ2xpZW50T2Zmc2V0IiwiZ2V0RGlmZmVyZW5jZUZyb21Jbml0aWFsT2Zmc2V0IiwiY29uc3RydWN0b3IiLCJleHBvcnRzIl0sInNvdXJjZXMiOlsiLi4vLi4vc3JjL2NsYXNzZXMvRHJhZ0Ryb3BNb25pdG9ySW1wbC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBpbnZhcmlhbnQgfSBmcm9tICdAcmVhY3QtZG5kL2ludmFyaWFudCdcbmltcG9ydCB0eXBlIHsgU3RvcmUgfSBmcm9tICdyZWR1eCdcblxuaW1wb3J0IHR5cGUge1xuXHREcmFnRHJvcE1vbml0b3IsXG5cdEhhbmRsZXJSZWdpc3RyeSxcblx0SWRlbnRpZmllcixcblx0TGlzdGVuZXIsXG5cdFVuc3Vic2NyaWJlLFxuXHRYWUNvb3JkLFxufSBmcm9tICcuLi9pbnRlcmZhY2VzLmpzJ1xuaW1wb3J0IHR5cGUgeyBTdGF0ZSB9IGZyb20gJy4uL3JlZHVjZXJzL2luZGV4LmpzJ1xuaW1wb3J0IHtcblx0Z2V0RGlmZmVyZW5jZUZyb21Jbml0aWFsT2Zmc2V0LFxuXHRnZXRTb3VyY2VDbGllbnRPZmZzZXQsXG59IGZyb20gJy4uL3V0aWxzL2Nvb3Jkcy5qcydcbmltcG9ydCB7IGFyZURpcnR5IH0gZnJvbSAnLi4vdXRpbHMvZGlydGluZXNzLmpzJ1xuaW1wb3J0IHsgbWF0Y2hlc1R5cGUgfSBmcm9tICcuLi91dGlscy9tYXRjaGVzVHlwZS5qcydcblxuZXhwb3J0IGNsYXNzIERyYWdEcm9wTW9uaXRvckltcGwgaW1wbGVtZW50cyBEcmFnRHJvcE1vbml0b3Ige1xuXHRwcml2YXRlIHN0b3JlOiBTdG9yZTxTdGF0ZT5cblx0cHVibGljIHJlYWRvbmx5IHJlZ2lzdHJ5OiBIYW5kbGVyUmVnaXN0cnlcblxuXHRwdWJsaWMgY29uc3RydWN0b3Ioc3RvcmU6IFN0b3JlPFN0YXRlPiwgcmVnaXN0cnk6IEhhbmRsZXJSZWdpc3RyeSkge1xuXHRcdHRoaXMuc3RvcmUgPSBzdG9yZVxuXHRcdHRoaXMucmVnaXN0cnkgPSByZWdpc3RyeVxuXHR9XG5cblx0cHVibGljIHN1YnNjcmliZVRvU3RhdGVDaGFuZ2UoXG5cdFx0bGlzdGVuZXI6IExpc3RlbmVyLFxuXHRcdG9wdGlvbnM6IHsgaGFuZGxlcklkcz86IHN0cmluZ1tdIH0gPSB7fSxcblx0KTogVW5zdWJzY3JpYmUge1xuXHRcdGNvbnN0IHsgaGFuZGxlcklkcyB9ID0gb3B0aW9uc1xuXHRcdGludmFyaWFudCh0eXBlb2YgbGlzdGVuZXIgPT09ICdmdW5jdGlvbicsICdsaXN0ZW5lciBtdXN0IGJlIGEgZnVuY3Rpb24uJylcblx0XHRpbnZhcmlhbnQoXG5cdFx0XHR0eXBlb2YgaGFuZGxlcklkcyA9PT0gJ3VuZGVmaW5lZCcgfHwgQXJyYXkuaXNBcnJheShoYW5kbGVySWRzKSxcblx0XHRcdCdoYW5kbGVySWRzLCB3aGVuIHNwZWNpZmllZCwgbXVzdCBiZSBhbiBhcnJheSBvZiBzdHJpbmdzLicsXG5cdFx0KVxuXG5cdFx0bGV0IHByZXZTdGF0ZUlkID0gdGhpcy5zdG9yZS5nZXRTdGF0ZSgpLnN0YXRlSWRcblx0XHRjb25zdCBoYW5kbGVDaGFuZ2UgPSAoKSA9PiB7XG5cdFx0XHRjb25zdCBzdGF0ZSA9IHRoaXMuc3RvcmUuZ2V0U3RhdGUoKVxuXHRcdFx0Y29uc3QgY3VycmVudFN0YXRlSWQgPSBzdGF0ZS5zdGF0ZUlkXG5cdFx0XHR0cnkge1xuXHRcdFx0XHRjb25zdCBjYW5Ta2lwTGlzdGVuZXIgPVxuXHRcdFx0XHRcdGN1cnJlbnRTdGF0ZUlkID09PSBwcmV2U3RhdGVJZCB8fFxuXHRcdFx0XHRcdChjdXJyZW50U3RhdGVJZCA9PT0gcHJldlN0YXRlSWQgKyAxICYmXG5cdFx0XHRcdFx0XHQhYXJlRGlydHkoc3RhdGUuZGlydHlIYW5kbGVySWRzLCBoYW5kbGVySWRzKSlcblxuXHRcdFx0XHRpZiAoIWNhblNraXBMaXN0ZW5lcikge1xuXHRcdFx0XHRcdGxpc3RlbmVyKClcblx0XHRcdFx0fVxuXHRcdFx0fSBmaW5hbGx5IHtcblx0XHRcdFx0cHJldlN0YXRlSWQgPSBjdXJyZW50U3RhdGVJZFxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdHJldHVybiB0aGlzLnN0b3JlLnN1YnNjcmliZShoYW5kbGVDaGFuZ2UpXG5cdH1cblxuXHRwdWJsaWMgc3Vic2NyaWJlVG9PZmZzZXRDaGFuZ2UobGlzdGVuZXI6IExpc3RlbmVyKTogVW5zdWJzY3JpYmUge1xuXHRcdGludmFyaWFudCh0eXBlb2YgbGlzdGVuZXIgPT09ICdmdW5jdGlvbicsICdsaXN0ZW5lciBtdXN0IGJlIGEgZnVuY3Rpb24uJylcblxuXHRcdGxldCBwcmV2aW91c1N0YXRlID0gdGhpcy5zdG9yZS5nZXRTdGF0ZSgpLmRyYWdPZmZzZXRcblx0XHRjb25zdCBoYW5kbGVDaGFuZ2UgPSAoKSA9PiB7XG5cdFx0XHRjb25zdCBuZXh0U3RhdGUgPSB0aGlzLnN0b3JlLmdldFN0YXRlKCkuZHJhZ09mZnNldFxuXHRcdFx0aWYgKG5leHRTdGF0ZSA9PT0gcHJldmlvdXNTdGF0ZSkge1xuXHRcdFx0XHRyZXR1cm5cblx0XHRcdH1cblxuXHRcdFx0cHJldmlvdXNTdGF0ZSA9IG5leHRTdGF0ZVxuXHRcdFx0bGlzdGVuZXIoKVxuXHRcdH1cblxuXHRcdHJldHVybiB0aGlzLnN0b3JlLnN1YnNjcmliZShoYW5kbGVDaGFuZ2UpXG5cdH1cblxuXHRwdWJsaWMgY2FuRHJhZ1NvdXJjZShzb3VyY2VJZDogc3RyaW5nIHwgdW5kZWZpbmVkKTogYm9vbGVhbiB7XG5cdFx0aWYgKCFzb3VyY2VJZCkge1xuXHRcdFx0cmV0dXJuIGZhbHNlXG5cdFx0fVxuXHRcdGNvbnN0IHNvdXJjZSA9IHRoaXMucmVnaXN0cnkuZ2V0U291cmNlKHNvdXJjZUlkKVxuXHRcdGludmFyaWFudChzb3VyY2UsIGBFeHBlY3RlZCB0byBmaW5kIGEgdmFsaWQgc291cmNlLiBzb3VyY2VJZD0ke3NvdXJjZUlkfWApXG5cblx0XHRpZiAodGhpcy5pc0RyYWdnaW5nKCkpIHtcblx0XHRcdHJldHVybiBmYWxzZVxuXHRcdH1cblxuXHRcdHJldHVybiBzb3VyY2UuY2FuRHJhZyh0aGlzLCBzb3VyY2VJZClcblx0fVxuXG5cdHB1YmxpYyBjYW5Ecm9wT25UYXJnZXQodGFyZ2V0SWQ6IHN0cmluZyB8IHVuZGVmaW5lZCk6IGJvb2xlYW4ge1xuXHRcdC8vIHVuZGVmaW5lZCBvbiBpbml0aWFsIHJlbmRlclxuXHRcdGlmICghdGFyZ2V0SWQpIHtcblx0XHRcdHJldHVybiBmYWxzZVxuXHRcdH1cblx0XHRjb25zdCB0YXJnZXQgPSB0aGlzLnJlZ2lzdHJ5LmdldFRhcmdldCh0YXJnZXRJZClcblx0XHRpbnZhcmlhbnQodGFyZ2V0LCBgRXhwZWN0ZWQgdG8gZmluZCBhIHZhbGlkIHRhcmdldC4gdGFyZ2V0SWQ9JHt0YXJnZXRJZH1gKVxuXG5cdFx0aWYgKCF0aGlzLmlzRHJhZ2dpbmcoKSB8fCB0aGlzLmRpZERyb3AoKSkge1xuXHRcdFx0cmV0dXJuIGZhbHNlXG5cdFx0fVxuXG5cdFx0Y29uc3QgdGFyZ2V0VHlwZSA9IHRoaXMucmVnaXN0cnkuZ2V0VGFyZ2V0VHlwZSh0YXJnZXRJZClcblx0XHRjb25zdCBkcmFnZ2VkSXRlbVR5cGUgPSB0aGlzLmdldEl0ZW1UeXBlKClcblx0XHRyZXR1cm4gKFxuXHRcdFx0bWF0Y2hlc1R5cGUodGFyZ2V0VHlwZSwgZHJhZ2dlZEl0ZW1UeXBlKSAmJiB0YXJnZXQuY2FuRHJvcCh0aGlzLCB0YXJnZXRJZClcblx0XHQpXG5cdH1cblxuXHRwdWJsaWMgaXNEcmFnZ2luZygpOiBib29sZWFuIHtcblx0XHRyZXR1cm4gQm9vbGVhbih0aGlzLmdldEl0ZW1UeXBlKCkpXG5cdH1cblxuXHRwdWJsaWMgaXNEcmFnZ2luZ1NvdXJjZShzb3VyY2VJZDogc3RyaW5nIHwgdW5kZWZpbmVkKTogYm9vbGVhbiB7XG5cdFx0Ly8gdW5kZWZpbmVkIG9uIGluaXRpYWwgcmVuZGVyXG5cdFx0aWYgKCFzb3VyY2VJZCkge1xuXHRcdFx0cmV0dXJuIGZhbHNlXG5cdFx0fVxuXHRcdGNvbnN0IHNvdXJjZSA9IHRoaXMucmVnaXN0cnkuZ2V0U291cmNlKHNvdXJjZUlkLCB0cnVlKVxuXHRcdGludmFyaWFudChzb3VyY2UsIGBFeHBlY3RlZCB0byBmaW5kIGEgdmFsaWQgc291cmNlLiBzb3VyY2VJZD0ke3NvdXJjZUlkfWApXG5cblx0XHRpZiAoIXRoaXMuaXNEcmFnZ2luZygpIHx8ICF0aGlzLmlzU291cmNlUHVibGljKCkpIHtcblx0XHRcdHJldHVybiBmYWxzZVxuXHRcdH1cblxuXHRcdGNvbnN0IHNvdXJjZVR5cGUgPSB0aGlzLnJlZ2lzdHJ5LmdldFNvdXJjZVR5cGUoc291cmNlSWQpXG5cdFx0Y29uc3QgZHJhZ2dlZEl0ZW1UeXBlID0gdGhpcy5nZXRJdGVtVHlwZSgpXG5cdFx0aWYgKHNvdXJjZVR5cGUgIT09IGRyYWdnZWRJdGVtVHlwZSkge1xuXHRcdFx0cmV0dXJuIGZhbHNlXG5cdFx0fVxuXG5cdFx0cmV0dXJuIHNvdXJjZS5pc0RyYWdnaW5nKHRoaXMsIHNvdXJjZUlkKVxuXHR9XG5cblx0cHVibGljIGlzT3ZlclRhcmdldChcblx0XHR0YXJnZXRJZDogc3RyaW5nIHwgdW5kZWZpbmVkLFxuXHRcdG9wdGlvbnMgPSB7IHNoYWxsb3c6IGZhbHNlIH0sXG5cdCk6IGJvb2xlYW4ge1xuXHRcdC8vIHVuZGVmaW5lZCBvbiBpbml0aWFsIHJlbmRlclxuXHRcdGlmICghdGFyZ2V0SWQpIHtcblx0XHRcdHJldHVybiBmYWxzZVxuXHRcdH1cblxuXHRcdGNvbnN0IHsgc2hhbGxvdyB9ID0gb3B0aW9uc1xuXHRcdGlmICghdGhpcy5pc0RyYWdnaW5nKCkpIHtcblx0XHRcdHJldHVybiBmYWxzZVxuXHRcdH1cblxuXHRcdGNvbnN0IHRhcmdldFR5cGUgPSB0aGlzLnJlZ2lzdHJ5LmdldFRhcmdldFR5cGUodGFyZ2V0SWQpXG5cdFx0Y29uc3QgZHJhZ2dlZEl0ZW1UeXBlID0gdGhpcy5nZXRJdGVtVHlwZSgpXG5cdFx0aWYgKGRyYWdnZWRJdGVtVHlwZSAmJiAhbWF0Y2hlc1R5cGUodGFyZ2V0VHlwZSwgZHJhZ2dlZEl0ZW1UeXBlKSkge1xuXHRcdFx0cmV0dXJuIGZhbHNlXG5cdFx0fVxuXG5cdFx0Y29uc3QgdGFyZ2V0SWRzID0gdGhpcy5nZXRUYXJnZXRJZHMoKVxuXHRcdGlmICghdGFyZ2V0SWRzLmxlbmd0aCkge1xuXHRcdFx0cmV0dXJuIGZhbHNlXG5cdFx0fVxuXG5cdFx0Y29uc3QgaW5kZXggPSB0YXJnZXRJZHMuaW5kZXhPZih0YXJnZXRJZClcblx0XHRpZiAoc2hhbGxvdykge1xuXHRcdFx0cmV0dXJuIGluZGV4ID09PSB0YXJnZXRJZHMubGVuZ3RoIC0gMVxuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gaW5kZXggPiAtMVxuXHRcdH1cblx0fVxuXG5cdHB1YmxpYyBnZXRJdGVtVHlwZSgpOiBJZGVudGlmaWVyIHtcblx0XHRyZXR1cm4gdGhpcy5zdG9yZS5nZXRTdGF0ZSgpLmRyYWdPcGVyYXRpb24uaXRlbVR5cGUgYXMgSWRlbnRpZmllclxuXHR9XG5cblx0cHVibGljIGdldEl0ZW0oKTogYW55IHtcblx0XHRyZXR1cm4gdGhpcy5zdG9yZS5nZXRTdGF0ZSgpLmRyYWdPcGVyYXRpb24uaXRlbVxuXHR9XG5cblx0cHVibGljIGdldFNvdXJjZUlkKCk6IHN0cmluZyB8IG51bGwge1xuXHRcdHJldHVybiB0aGlzLnN0b3JlLmdldFN0YXRlKCkuZHJhZ09wZXJhdGlvbi5zb3VyY2VJZFxuXHR9XG5cblx0cHVibGljIGdldFRhcmdldElkcygpOiBzdHJpbmdbXSB7XG5cdFx0cmV0dXJuIHRoaXMuc3RvcmUuZ2V0U3RhdGUoKS5kcmFnT3BlcmF0aW9uLnRhcmdldElkc1xuXHR9XG5cblx0cHVibGljIGdldERyb3BSZXN1bHQoKTogYW55IHtcblx0XHRyZXR1cm4gdGhpcy5zdG9yZS5nZXRTdGF0ZSgpLmRyYWdPcGVyYXRpb24uZHJvcFJlc3VsdFxuXHR9XG5cblx0cHVibGljIGRpZERyb3AoKTogYm9vbGVhbiB7XG5cdFx0cmV0dXJuIHRoaXMuc3RvcmUuZ2V0U3RhdGUoKS5kcmFnT3BlcmF0aW9uLmRpZERyb3Bcblx0fVxuXG5cdHB1YmxpYyBpc1NvdXJjZVB1YmxpYygpOiBib29sZWFuIHtcblx0XHRyZXR1cm4gQm9vbGVhbih0aGlzLnN0b3JlLmdldFN0YXRlKCkuZHJhZ09wZXJhdGlvbi5pc1NvdXJjZVB1YmxpYylcblx0fVxuXG5cdHB1YmxpYyBnZXRJbml0aWFsQ2xpZW50T2Zmc2V0KCk6IFhZQ29vcmQgfCBudWxsIHtcblx0XHRyZXR1cm4gdGhpcy5zdG9yZS5nZXRTdGF0ZSgpLmRyYWdPZmZzZXQuaW5pdGlhbENsaWVudE9mZnNldFxuXHR9XG5cblx0cHVibGljIGdldEluaXRpYWxTb3VyY2VDbGllbnRPZmZzZXQoKTogWFlDb29yZCB8IG51bGwge1xuXHRcdHJldHVybiB0aGlzLnN0b3JlLmdldFN0YXRlKCkuZHJhZ09mZnNldC5pbml0aWFsU291cmNlQ2xpZW50T2Zmc2V0XG5cdH1cblxuXHRwdWJsaWMgZ2V0Q2xpZW50T2Zmc2V0KCk6IFhZQ29vcmQgfCBudWxsIHtcblx0XHRyZXR1cm4gdGhpcy5zdG9yZS5nZXRTdGF0ZSgpLmRyYWdPZmZzZXQuY2xpZW50T2Zmc2V0XG5cdH1cblxuXHRwdWJsaWMgZ2V0U291cmNlQ2xpZW50T2Zmc2V0KCk6IFhZQ29vcmQgfCBudWxsIHtcblx0XHRyZXR1cm4gZ2V0U291cmNlQ2xpZW50T2Zmc2V0KHRoaXMuc3RvcmUuZ2V0U3RhdGUoKS5kcmFnT2Zmc2V0KVxuXHR9XG5cblx0cHVibGljIGdldERpZmZlcmVuY2VGcm9tSW5pdGlhbE9mZnNldCgpOiBYWUNvb3JkIHwgbnVsbCB7XG5cdFx0cmV0dXJuIGdldERpZmZlcmVuY2VGcm9tSW5pdGlhbE9mZnNldCh0aGlzLnN0b3JlLmdldFN0YXRlKCkuZHJhZ09mZnNldClcblx0fVxufVxuIl0sIm1hcHBpbmdzIjoiOzs7Ozs7QUFBQSxJQUFBQSxVQUFBLEdBQUFD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