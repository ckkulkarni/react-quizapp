{"version":3,"names":["_invariant","require","_js_utils","_setClientOffset","_types","ResetCoordinatesAction","type","INIT_COORDS","payload","clientOffset","sourceClientOffset","createBeginDrag","manager","beginDrag","sourceIds","options","publishSource","getSourceClientOffset","monitor","getMonitor","registry","getRegistry","dispatch","setClientOffset","verifyInvariants","sourceId","getDraggableSource","Error","verifyGetSourceClientOffsetIsFunction","source","getSource","item","undefined","verifyItemIsObject","pinSource","itemType","getSourceType","BEGIN_DRAG","isSourcePublic","invariant","isDragging","forEach","isObject","i","length","canDragSource"],"sources":["../../../src/actions/dragDrop/beginDrag.ts"],"sourcesContent":["import { invariant } from '@react-dnd/invariant'\n\nimport type {\n\tAction,\n\tBeginDragOptions,\n\tBeginDragPayload,\n\tDragDropManager,\n\tDragDropMonitor,\n\tHandlerRegistry,\n\tIdentifier,\n\tXYCoord,\n} from '../../interfaces.js'\nimport { isObject } from '../../utils/js_utils.js'\nimport { setClientOffset } from './local/setClientOffset.js'\nimport { BEGIN_DRAG, INIT_COORDS } from './types.js'\n\nconst ResetCoordinatesAction = {\n\ttype: INIT_COORDS,\n\tpayload: {\n\t\tclientOffset: null,\n\t\tsourceClientOffset: null,\n\t},\n}\n\nexport function createBeginDrag(manager: DragDropManager) {\n\treturn function beginDrag(\n\t\tsourceIds: Identifier[] = [],\n\t\toptions: BeginDragOptions = {\n\t\t\tpublishSource: true,\n\t\t},\n\t): Action<BeginDragPayload> | undefined {\n\t\tconst {\n\t\t\tpublishSource = true,\n\t\t\tclientOffset,\n\t\t\tgetSourceClientOffset,\n\t\t}: BeginDragOptions = options\n\t\tconst monitor = manager.getMonitor()\n\t\tconst registry = manager.getRegistry()\n\n\t\t// Initialize the coordinates using the client offset\n\t\tmanager.dispatch(setClientOffset(clientOffset))\n\n\t\tverifyInvariants(sourceIds, monitor, registry)\n\n\t\t// Get the draggable source\n\t\tconst sourceId = getDraggableSource(sourceIds, monitor)\n\t\tif (sourceId == null) {\n\t\t\tmanager.dispatch(ResetCoordinatesAction)\n\t\t\treturn\n\t\t}\n\n\t\t// Get the source client offset\n\t\tlet sourceClientOffset: XYCoord | null = null\n\t\tif (clientOffset) {\n\t\t\tif (!getSourceClientOffset) {\n\t\t\t\tthrow new Error('getSourceClientOffset must be defined')\n\t\t\t}\n\t\t\tverifyGetSourceClientOffsetIsFunction(getSourceClientOffset)\n\t\t\tsourceClientOffset = getSourceClientOffset(sourceId)\n\t\t}\n\n\t\t// Initialize the full coordinates\n\t\tmanager.dispatch(setClientOffset(clientOffset, sourceClientOffset))\n\n\t\tconst source = registry.getSource(sourceId)\n\t\tconst item = source.beginDrag(monitor, sourceId)\n\t\t// If source.beginDrag returns null, this is an indicator to cancel the drag\n\t\tif (item == null) {\n\t\t\treturn undefined\n\t\t}\n\t\tverifyItemIsObject(item)\n\t\tregistry.pinSource(sourceId)\n\n\t\tconst itemType = registry.getSourceType(sourceId)\n\t\treturn {\n\t\t\ttype: BEGIN_DRAG,\n\t\t\tpayload: {\n\t\t\t\titemType,\n\t\t\t\titem,\n\t\t\t\tsourceId,\n\t\t\t\tclientOffset: clientOffset || null,\n\t\t\t\tsourceClientOffset: sourceClientOffset || null,\n\t\t\t\tisSourcePublic: !!publishSource,\n\t\t\t},\n\t\t}\n\t}\n}\n\nfunction verifyInvariants(\n\tsourceIds: Identifier[],\n\tmonitor: DragDropMonitor,\n\tregistry: HandlerRegistry,\n) {\n\tinvariant(!monitor.isDragging(), 'Cannot call beginDrag while dragging.')\n\tsourceIds.forEach(function (sourceId) {\n\t\tinvariant(\n\t\t\tregistry.getSource(sourceId),\n\t\t\t'Expected sourceIds to be registered.',\n\t\t)\n\t})\n}\n\nfunction verifyGetSourceClientOffsetIsFunction(getSourceClientOffset: any) {\n\tinvariant(\n\t\ttypeof getSourceClientOffset === 'function',\n\t\t'When clientOffset is provided, getSourceClientOffset must be a function.',\n\t)\n}\n\nfunction verifyItemIsObject(item: any) {\n\tinvariant(isObject(item), 'Item must be an object.')\n}\n\nfunction getDraggableSource(sourceIds: Identifier[], monitor: DragDropMonitor) {\n\tlet sourceId = null\n\tfor (let i = sourceIds.length - 1; i >= 0; i--) {\n\t\tif (monitor.canDragSource(sourceIds[i])) {\n\t\t\tsourceId = sourceIds[i]\n\t\t\tbreak\n\t\t}\n\t}\n\treturn sourceId\n}\n"],"mappings":";;;;;;AAAA,IAAAA,UAAA,GAAAC,OAAA;AAYA,IAAAC,SAAA,GAAAD,OAAA;AACA,IAAAE,gBAAA,GAAAF,OAAA;AACA,IAAAG,MAAA,GAAAH,OAAA;AAEA,MAAMI,sBAAsB,GAAG;EAC9BC,IAAI,EAAEC,kBAAW;EACjBC,OAAO,EAAE;IACRC,YAAY,EAAE,IAAI;IAClBC,kBAAkB,EAAE;;CAErB;AAEM,SAASC,eAAeA,CAACC,OAAwB,EAAE;EACzD,OAAO,SAASC,SAASA,CACxBC,SAAuB,GAAG,EAAE,EAC5BC,OAAyB,GAAG;IAC3BC,aAAa,EAAE;GACf,EACsC;IACvC,MAAM;MACLA,aAAa,GAAG,IAAI;MACpBP,YAAY;MACZQ;IAAqB,CACrB,GAAqBF,OAAO;IAC7B,MAAMG,OAAO,GAAGN,OAAO,CAACO,UAAU,EAAE;IACpC,MAAMC,QAAQ,GAAGR,OAAO,CAACS,WAAW,EAAE;IAEtC;IACAT,OAAO,CAACU,QAAQ,CAAC,IAAAC,gCAAe,EAACd,YAAY,CAAC,CAAC;IAE/Ce,gBAAgB,CAACV,SAAS,EAAEI,OAAO,EAAEE,QAAQ,CAAC;IAE9C;IACA,MAAMK,QAAQ,GAAGC,kBAAkB,CAACZ,SAAS,EAAEI,OAAO,CAAC;IACvD,IAAIO,QAAQ,IAAI,IAAI,EAAE;MACrBb,OAAO,CAACU,QAAQ,CAACjB,sBAAsB,CAAC;MACxC;;IAGD;IACA,IAAIK,kBAAkB,GAAmB,IAAI;IAC7C,IAAID,YAAY,EAAE;MACjB,IAAI,CAACQ,qBAAqB,EAAE;QAC3B,MAAM,IAAIU,KAAK,CAAC,uCAAuC,CAAC;;MAEzDC,qCAAqC,CAACX,qBAAqB,CAAC;MAC5DP,kBAAkB,GAAGO,qBAAqB,CAACQ,QAAQ,CAAC;;IAGrD;IACAb,OAAO,CAACU,QAAQ,CAAC,IAAAC,gCAAe,EAACd,YAAY,EAAEC,kBAAkB,CAAC,CAAC;IAEnE,MAAMmB,MAAM,GAAGT,QAAQ,CAACU,SAAS,CAACL,QAAQ,CAAC;IAC3C,MAAMM,IAAI,GAAGF,MAAM,CAAChB,SAAS,CAACK,OAAO,EAAEO,QAAQ,CAAC;IAChD;IACA,IAAIM,IAAI,IAAI,IAAI,EAAE;MACjB,OAAOC,SAAS;;IAEjBC,kBAAkB,CAACF,IAAI,CAAC;IACxBX,QAAQ,CAACc,SAAS,CAACT,QAAQ,CAAC;IAE5B,MAAMU,QAAQ,GAAGf,QAAQ,CAACgB,aAAa,CAACX,QAAQ,CAAC;IACjD,OAAO;MACNnB,IAAI,EAAE+B,iBAAU;MAChB7B,OAAO,EAAE;QACR2B,QAAQ;QACRJ,IAAI;QACJN,QAAQ;QACRhB,YAAY,EAAEA,YAAY,IAAI,IAAI;QAClCC,kBAAkB,EAAEA,kBAAkB,IAAI,IAAI;QAC9C4B,cAAc,EAAE,CAAC,CAACtB;;KAEnB;GACD;;AAGF,SAASQ,gBAAgBA,CACxBV,SAAuB,EACvBI,OAAwB,EACxBE,QAAyB,EACxB;EACD,IAAAmB,oBAAS,EAAC,CAACrB,OAAO,CAACsB,UAAU,EAAE,EAAE,uCAAuC,CAAC;EACzE1B,SAAS,CAAC2B,OAAO,CAAC,UAAUhB,QAAQ,EAAE;IACrC,IAAAc,oBAAS,EACRnB,QAAQ,CAACU,SAAS,CAACL,QAAQ,CAAC,EAC5B,sCAAsC,CACtC;GACD,CAAC;;AAGH,SAASG,qCAAqCA,CAACX,qBAA0B,EAAE;EAC1E,IAAAsB,oBAAS,EACR,OAAOtB,qBAAqB,KAAK,UAAU,EAC3C,0EAA0E,CAC1E;;AAGF,SAASgB,kBAAkBA,CAACF,IAAS,EAAE;EACtC,IAAAQ,oBAAS,EAAC,IAAAG,kBAAQ,EAACX,IAAI,CAAC,EAAE,yBAAyB,CAAC;;AAGrD,SAASL,kBAAkBA,CAACZ,SAAuB,EAAEI,OAAwB,EAAE;EAC9E,IAAIO,QAAQ,GAAG,IAAI;EACnB,KAAK,IAAIkB,CAAC,GAAG7B,SAAS,CAAC8B,MAAM,GAAG,CAAC,EAAED,CAAC,IAAI,CAAC,EAAEA,CAAC,EAAE,EAAE;IAC/C,IAAIzB,OAAO,CAAC2B,aAAa,CAAC/B,SAAS,CAAC6B,CAAC,CAAC,CAAC,EAAE;MACxClB,QAAQ,GAAGX,SAAS,CAAC6B,CAAC,CAAC;MACvB;;;EAGF,OAAOlB,QAAQ"}