f81076e7ec79052383e5f570abcd927f
"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.defaultTreeAdapter = void 0;
const html_js_1 = require("../common/html.js");
function createTextNode(value) {
  return {
    nodeName: '#text',
    value,
    parentNode: null
  };
}
exports.defaultTreeAdapter = {
  //Node construction
  createDocument() {
    return {
      nodeName: '#document',
      mode: html_js_1.DOCUMENT_MODE.NO_QUIRKS,
      childNodes: []
    };
  },
  createDocumentFragment() {
    return {
      nodeName: '#document-fragment',
      childNodes: []
    };
  },
  createElement(tagName, namespaceURI, attrs) {
    return {
      nodeName: tagName,
      tagName,
      attrs,
      namespaceURI,
      childNodes: [],
      parentNode: null
    };
  },
  createCommentNode(data) {
    return {
      nodeName: '#comment',
      data,
      parentNode: null
    };
  },
  //Tree mutation
  appendChild(parentNode, newNode) {
    parentNode.childNodes.push(newNode);
    newNode.parentNode = parentNode;
  },
  insertBefore(parentNode, newNode, referenceNode) {
    const insertionIdx = parentNode.childNodes.indexOf(referenceNode);
    parentNode.childNodes.splice(insertionIdx, 0, newNode);
    newNode.parentNode = parentNode;
  },
  setTemplateContent(templateElement, contentElement) {
    templateElement.content = contentElement;
  },
  getTemplateContent(templateElement) {
    return templateElement.content;
  },
  setDocumentType(document, name, publicId, systemId) {
    const doctypeNode = document.childNodes.find(node => node.nodeName === '#documentType');
    if (doctypeNode) {
      doctypeNode.name = name;
      doctypeNode.publicId = publicId;
      doctypeNode.systemId = systemId;
    } else {
      const node = {
        nodeName: '#documentType',
        name,
        publicId,
        systemId,
        parentNode: null
      };
      exports.defaultTreeAdapter.appendChild(document, node);
    }
  },
  setDocumentMode(document, mode) {
    document.mode = mode;
  },
  getDocumentMode(document) {
    return document.mode;
  },
  detachNode(node) {
    if (node.parentNode) {
      const idx = node.parentNode.childNodes.indexOf(node);
      node.parentNode.childNodes.splice(idx, 1);
      node.parentNode = null;
    }
  },
  insertText(parentNode, text) {
    if (parentNode.childNodes.length > 0) {
      const prevNode = parentNode.childNodes[parentNode.childNodes.length - 1];
      if (exports.defaultTreeAdapter.isTextNode(prevNode)) {
        prevNode.value += text;
        return;
      }
    }
    exports.defaultTreeAdapter.appendChild(parentNode, createTextNode(text));
  },
  insertTextBefore(parentNode, text, referenceNode) {
    const prevNode = parentNode.childNodes[parentNode.childNodes.indexOf(referenceNode) - 1];
    if (prevNode && exports.defaultTreeAdapter.isTextNode(prevNode)) {
      prevNode.value += text;
    } else {
      exports.defaultTreeAdapter.insertBefore(parentNode, createTextNode(text), referenceNode);
    }
  },
  adoptAttributes(recipient, attrs) {
    const recipientAttrsMap = new Set(recipient.attrs.map(attr => attr.name));
    for (let j = 0; j < attrs.length; j++) {
      if (!recipientAttrsMap.has(attrs[j].name)) {
        recipient.attrs.push(attrs[j]);
      }
    }
  },
  //Tree traversing
  getFirstChild(node) {
    return node.childNodes[0];
  },
  getChildNodes(node) {
    return node.childNodes;
  },
  getParentNode(node) {
    return node.parentNode;
  },
  getAttrList(element) {
    return element.attrs;
  },
  //Node data
  getTagName(element) {
    return element.tagName;
  },
  getNamespaceURI(element) {
    return element.namespaceURI;
  },
  getTextNodeContent(textNode) {
    return textNode.value;
  },
  getCommentNodeContent(commentNode) {
    return commentNode.data;
  },
  getDocumentTypeNodeName(doctypeNode) {
    return doctypeNode.name;
  },
  getDocumentTypeNodePublicId(doctypeNode) {
    return doctypeNode.publicId;
  },
  getDocumentTypeNodeSystemId(doctypeNode) {
    return doctypeNode.systemId;
  },
  //Node types
  isTextNode(node) {
    return node.nodeName === '#text';
  },
  isCommentNode(node) {
    return node.nodeName === '#comment';
  },
  isDocumentTypeNode(node) {
    return node.nodeName === '#documentType';
  },
  isElementNode(node) {
    return Object.prototype.hasOwnProperty.call(node, 'tagName');
  },
  // Source code location
  setNodeSourceCodeLocation(node, location) {
    node.sourceCodeLocation = location;
  },
  getNodeSourceCodeLocation(node) {
    return node.sourceCodeLocation;
  },
  updateNodeSourceCodeLocation(node, endLocation) {
    node.sourceCodeLocation = Object.assign(Object.assign({}, node.sourceCodeLocation), endLocation);
  }
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJPYmplY3QiLCJkZWZpbmVQcm9wZXJ0eSIsImV4cG9ydHMiLCJ2YWx1ZSIsImRlZmF1bHRUcmVlQWRhcHRlciIsImh0bWxfanNfMSIsInJlcXVpcmUiLCJjcmVhdGVUZXh0Tm9kZSIsIm5vZGVOYW1lIiwicGFyZW50Tm9kZSIsImNyZWF0ZURvY3VtZW50IiwibW9kZSIsIkRPQ1VNRU5UX01PREUiLCJOT19RVUlSS1MiLCJjaGlsZE5vZGVzIiwiY3JlYXRlRG9jdW1lbnRGcmFnbWVudCIsImNyZWF0ZUVsZW1lbnQiLCJ0YWdOYW1lIiwibmFtZXNwYWNlVVJJIiwiYXR0cnMiLCJjcmVhdGVDb21tZW50Tm9kZSIsImRhdGEiLCJhcHBlbmRDaGlsZCIsIm5ld05vZGUiLCJwdXNoIiwiaW5zZXJ0QmVmb3JlIiwicmVmZXJlbmNlTm9kZSIsImluc2VydGlvbklkeCIsImluZGV4T2YiLCJzcGxpY2UiLCJzZXRUZW1wbGF0ZUNvbnRlbnQiLCJ0ZW1wbGF0ZUVsZW1lbnQiLCJjb250ZW50RWxlbWVudCIsImNvbnRlbnQiLCJnZXRUZW1wbGF0ZUNvbnRlbnQiLCJzZXREb2N1bWVudFR5cGUiLCJkb2N1bWVudCIsIm5hbWUiLCJwdWJsaWNJZCIsInN5c3RlbUlkIiwiZG9jdHlwZU5vZGUiLCJmaW5kIiwibm9kZSIsInNldERvY3VtZW50TW9kZSIsImdldERvY3VtZW50TW9kZSIsImRldGFjaE5vZGUiLCJpZHgiLCJpbnNlcnRUZXh0IiwidGV4dCIsImxlbmd0aCIsInByZXZOb2RlIiwiaXNUZXh0Tm9kZSIsImluc2VydFRleHRCZWZvcmUiLCJhZG9wdEF0dHJpYnV0ZXMiLCJyZWNpcGllbnQiLCJyZWNpcGllbnRBdHRyc01hcCIsIlNldCIsIm1hcCIsImF0dHIiLCJqIiwiaGFzIiwiZ2V0Rmlyc3RDaGlsZCIsImdldENoaWxkTm9kZXMiLCJnZXRQYXJlbnROb2RlIiwiZ2V0QXR0ckxpc3QiLCJlbGVtZW50IiwiZ2V0VGFnTmFtZSIsImdldE5hbWVzcGFjZVVSSSIsImdldFRleHROb2RlQ29udGVudCIsInRleHROb2RlIiwiZ2V0Q29tbWVudE5vZGVDb250ZW50IiwiY29tbWVudE5vZGUiLCJnZXREb2N1bWVudFR5cGVOb2RlTmFtZSIsImdldERvY3VtZW50VHlwZU5vZGVQdWJsaWNJZCIsImdldERvY3VtZW50VHlwZU5vZGVTeXN0ZW1JZCIsImlzQ29tbWVudE5vZGUiLCJpc0RvY3VtZW50VHlwZU5vZGUiLCJpc0VsZW1lbnROb2RlIiwicHJvdG90eXBlIiwiaGFzT3duUHJvcGVydHkiLCJjYWxsIiwic2V0Tm9kZVNvdXJjZUNvZGVMb2NhdGlvbiIsImxvY2F0aW9uIiwic291cmNlQ29kZUxvY2F0aW9uIiwiZ2V0Tm9kZVNvdXJjZUNvZGVMb2NhdGlvbiIsInVwZGF0ZU5vZGVTb3VyY2VDb2RlTG9jYXRpb24iLCJlbmRMb2NhdGlvbiIsImFzc2lnbiJdLCJzb3VyY2VzIjpbImRlZmF1bHQuanMiXSwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLmRlZmF1bHRUcmVlQWRhcHRlciA9IHZvaWQgMDtcbmNvbnN0IGh0bWxfanNfMSA9IHJlcXVpcmUoXCIuLi9jb21tb24vaHRtbC5qc1wiKTtcbmZ1bmN0aW9uIGNyZWF0ZVRleHROb2RlKHZhbHVlKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgICAgbm9kZU5hbWU6ICcjdGV4dCcsXG4gICAgICAgIHZhbHVlLFxuICAgICAgICBwYXJlbnROb2RlOiBudWxsLFxuICAgIH07XG59XG5leHBvcnRzLmRlZmF1bHRUcmVlQWRhcHRlciA9IHtcbiAgICAvL05vZGUgY29uc3RydWN0aW9uXG4gICAgY3JlYXRlRG9jdW1lbnQoKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBub2RlTmFtZTogJyNkb2N1bWVudCcsXG4gICAgICAgICAgICBtb2RlOiBodG1sX2pzXzEuRE9DVU1FTlRfTU9ERS5OT19RVUlSS1MsXG4gICAgICAgICAgICBjaGlsZE5vZGVzOiBbXSxcbiAgICAgICAgfTtcbiAgICB9LFxuICAgIGNyZWF0ZURvY3VtZW50RnJhZ21lbnQoKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBub2RlTmFtZTogJyNkb2N1bWVudC1mcmFnbWVudCcsXG4gICAgICAgICAgICBjaGlsZE5vZGVzOiBbXSxcbiAgICAgICAgfTtcbiAgICB9LFxuICAgIGNyZWF0ZUVsZW1lbnQodGFnTmFtZSwgbmFtZXNwYWNlVVJJLCBhdHRycykge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgbm9kZU5hbWU6IHRhZ05hbWUsXG4gICAgICAgICAgICB0YWdOYW1lLFxuICAgICAgICAgICAgYXR0cnMsXG4gICAgICAgICAgICBuYW1lc3BhY2VVUkksXG4gICAgICAgICAgICBjaGlsZE5vZGVzOiBbXSxcbiAgICAgICAgICAgIHBhcmVudE5vZGU6IG51bGwsXG4gICAgICAgIH07XG4gICAgfSxcbiAgICBjcmVhdGVDb21tZW50Tm9kZShkYXRhKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBub2RlTmFtZTogJyNjb21tZW50JyxcbiAgICAgICAgICAgIGRhdGEsXG4gICAgICAgICAgICBwYXJlbnROb2RlOiBudWxsLFxuICAgICAgICB9O1xuICAgIH0sXG4gICAgLy9UcmVlIG11dGF0aW9uXG4gICAgYXBwZW5kQ2hpbGQocGFyZW50Tm9kZSwgbmV3Tm9kZSkge1xuICAgICAgICBwYXJlbnROb2RlLmNoaWxkTm9kZXMucHVzaChuZXdOb2RlKTtcbiAgICAgICAgbmV3Tm9kZS5wYXJlbnROb2RlID0gcGFyZW50Tm9kZTtcbiAgICB9LFxuICAgIGluc2VydEJlZm9yZShwYXJlbnROb2RlLCBuZXdOb2RlLCByZWZlcmVuY2VOb2RlKSB7XG4gICAgICAgIGNvbnN0IGluc2VydGlvbklkeCA9IHBhcmVudE5vZGUuY2hpbGROb2Rlcy5pbmRleE9mKHJlZmVyZW5jZU5vZGUpO1xuICAgICAgICBwYXJlbnROb2RlLmNoaWxkTm9kZXMuc3BsaWNlKGluc2VydGlvbklkeCwgMCwgbmV3Tm9kZSk7XG4gICAgICAgIG5ld05vZGUucGFyZW50Tm9kZSA9IHBhcmVudE5vZGU7XG4gICAgfSxcbiAgICBzZXRUZW1wbGF0ZUNvbnRlbnQodGVtcGxhdGVFbGVtZW50LCBjb250ZW50RWxlbWVudCkge1xuICAgICAgICB0ZW1wbGF0ZUVsZW1lbnQuY29udGVudCA9IGNvbnRlbnRFbGVtZW50O1xuICAgIH0sXG4gICAgZ2V0VGVtcGxhdGVDb250ZW50KHRlbXBsYXRlRWxlbWVudCkge1xuICAgICAgICByZXR1cm4gdGVtcGxhdGVFbGVtZW50LmNvbnRlbnQ7XG4gICAgfSxcbiAgICBzZXREb2N1bWVudFR5cGUoZG9jdW1lbnQsIG5hbWUsIHB1YmxpY0lkLCBzeXN0ZW1JZCkge1xuICAgICAgICBjb25zdCBkb2N0eXBlTm9kZSA9IGRvY3VtZW50LmNoaWxkTm9kZXMuZmluZCgobm9kZSkgPT4gbm9kZS5ub2RlTmFtZSA9PT0gJyNkb2N1bWVudFR5cGUnKTtcbiAgICAgICAgaWYgKGRvY3R5cGVOb2RlKSB7XG4gICAgICAgICAgICBkb2N0eXBlTm9kZS5uYW1lID0gbmFtZTtcbiAgICAgICAgICAgIGRvY3R5cGVOb2RlLnB1YmxpY0lkID0gcHVibGljSWQ7XG4gICAgICAgICAgICBkb2N0eXBlTm9kZS5zeXN0ZW1JZCA9IHN5c3RlbUlkO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgY29uc3Qgbm9kZSA9IHtcbiAgICAgICAgICAgICAgICBub2RlTmFtZTogJyNkb2N1bWVudFR5cGUnLFxuICAgICAgICAgICAgICAgIG5hbWUsXG4gICAgICAgICAgICAgICAgcHVibGljSWQsXG4gICAgICAgICAgICAgICAgc3lzdGVtSWQsXG4gICAgICAgICAgICAgICAgcGFyZW50Tm9kZTogbnVsbCxcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBleHBvcnRzLmRlZmF1bHRUcmVlQWRhcHRlci5hcHBlbmRDaGlsZChkb2N1bWVudCwgbm9kZSk7XG4gICAgICAgIH1cbiAgICB9LFxuICAgIHNldERvY3VtZW50TW9kZShkb2N1bWVudCwgbW9kZSkge1xuICAgICAgICBkb2N1bWVudC5tb2RlID0gbW9kZTtcbiAgICB9LFxuICAgIGdldERvY3VtZW50TW9kZShkb2N1bWVudCkge1xuICAgICAgICByZXR1cm4gZG9jdW1lbnQubW9kZTtcbiAgICB9LFxuICAgIGRldGFjaE5vZGUobm9kZSkge1xuICAgICAgICBpZiAobm9kZS5wYXJlbnROb2RlKSB7XG4gICAgICAgICAgICBjb25zdCBpZHggPSBub2RlLnBhcmVudE5vZGUuY2hpbGROb2Rlcy5pbmRleE9mKG5vZGUpO1xuICAgICAgICAgICAgbm9kZS5wYXJlbnROb2RlLmNoaWxkTm9kZXMuc3BsaWNlKGlkeCwgMSk7XG4gICAgICAgICAgICBub2RlLnBhcmVudE5vZGUgPSBudWxsO1xuICAgICAgICB9XG4gICAgfSxcbiAgICBpbnNlcnRUZXh0KHBhcmVudE5vZGUsIHRleHQpIHtcbiAgICAgICAgaWYgKHBhcmVudE5vZGUuY2hpbGROb2Rlcy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICBjb25zdCBwcmV2Tm9kZSA9IHBhcmVudE5vZGUuY2hpbGROb2Rlc1twYXJlbnROb2RlLmNoaWxkTm9kZXMubGVuZ3RoIC0gMV07XG4gICAgICAgICAgICBpZiAoZXhwb3J0cy5kZWZhdWx0VHJlZUFkYXB0ZXIuaXNUZXh0Tm9kZShwcmV2Tm9kZSkpIHtcbiAgICAgICAgICAgICAgICBwcmV2Tm9kZS52YWx1ZSArPSB0ZXh0O1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBleHBvcnRzLmRlZmF1bHRUcmVlQWRhcHRlci5hcHBlbmRDaGlsZChwYXJlbnROb2RlLCBjcmVhdGVUZXh0Tm9kZSh0ZXh0KSk7XG4gICAgfSxcbiAgICBpbnNlcnRUZXh0QmVmb3JlKHBhcmVudE5vZGUsIHRleHQsIHJlZmVyZW5jZU5vZGUpIHtcbiAgICAgICAgY29uc3QgcHJldk5vZGUgPSBwYXJlbnROb2RlLmNoaWxkTm9kZXNbcGFyZW50Tm9kZS5jaGlsZE5vZGVzLmluZGV4T2YocmVmZXJlbmNlTm9kZSkgLSAxXTtcbiAgICAgICAgaWYgKHByZXZOb2RlICYmIGV4cG9ydHMuZGVmYXVsdFRyZWVBZGFwdGVyLmlzVGV4dE5vZGUocHJldk5vZGUpKSB7XG4gICAgICAgICAgICBwcmV2Tm9kZS52YWx1ZSArPSB0ZXh0O1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgZXhwb3J0cy5kZWZhdWx0VHJlZUFkYXB0ZXIuaW5zZXJ0QmVmb3JlKHBhcmVudE5vZGUsIGNyZWF0ZVRleHROb2RlKHRleHQpLCByZWZlcmVuY2VOb2RlKTtcbiAgICAgICAgfVxuICAgIH0sXG4gICAgYWRvcHRBdHRyaWJ1dGVzKHJlY2lwaWVudCwgYXR0cnMpIHtcbiAgICAgICAgY29uc3QgcmVjaXBpZW50QXR0cnNNYXAgPSBuZXcgU2V0KHJlY2lwaWVudC5hdHRycy5tYXAoKGF0dHIpID0+IGF0dHIubmFtZSkpO1xuICAgICAgICBmb3IgKGxldCBqID0gMDsgaiA8IGF0dHJzLmxlbmd0aDsgaisrKSB7XG4gICAgICAgICAgICBpZiAoIXJlY2lwaWVudEF0dHJzTWFwLmhhcyhhdHRyc1tqXS5uYW1lKSkge1xuICAgICAgICAgICAgICAgIHJlY2lwaWVudC5hdHRycy5wdXNoKGF0dHJzW2pdKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH0sXG4gICAgLy9UcmVlIHRyYXZlcnNpbmdcbiAgICBnZXRGaXJzdENoaWxkKG5vZGUpIHtcbiAgICAgICAgcmV0dXJuIG5vZGUuY2hpbGROb2Rlc1swXTtcbiAgICB9LFxuICAgIGdldENoaWxkTm9kZXMobm9kZSkge1xuICAgICAgICByZXR1cm4gbm9kZS5jaGlsZE5vZGVzO1xuICAgIH0sXG4gICAgZ2V0UGFyZW50Tm9kZShub2RlKSB7XG4gICAgICAgIHJldHVybiBub2RlLnBhcmVudE5vZGU7XG4gICAgfSxcbiAgICBnZXRBdHRyTGlzdChlbGVtZW50KSB7XG4gICAgICAgIHJldHVybiBlbGVtZW50LmF0dHJzO1xuICAgIH0sXG4gICAgLy9Ob2RlIGRhdGFcbiAgICBnZXRUYWdOYW1lKGVsZW1lbnQpIHtcbiAgICAgICAgcmV0dXJuIGVsZW1lbnQudGFnTmFtZTtcbiAgICB9LFxuICAgIGdldE5hbWVzcGFjZVVSSShlbGVtZW50KSB7XG4gICAgICAgIHJldHVybiBlbGVtZW50Lm5hbWVzcGFjZVVSSTtcbiAgICB9LFxuICAgIGdldFRleHROb2RlQ29udGVudCh0ZXh0Tm9kZSkge1xuICAgICAgICByZXR1cm4gdGV4dE5vZGUudmFsdWU7XG4gICAgfSxcbiAgICBnZXRDb21tZW50Tm9kZUNvbnRlbnQoY29tbWVudE5vZGUpIHtcbiAgICAgICAgcmV0dXJuIGNvbW1lbnROb2RlLmRhdGE7XG4gICAgfSxcbiAgICBnZXREb2N1bWVudFR5cGVOb2RlTmFtZShkb2N0eXBlTm9kZSkge1xuICAgICAgICByZXR1cm4gZG9jdHlwZU5vZGUubmFtZTtcbiAgICB9LFxuICAgIGdldERvY3VtZW50VHlwZU5vZGVQdWJsaWNJZChkb2N0eXBlTm9kZSkge1xuICAgICAgICByZXR1cm4gZG9jdHlwZU5vZGUucHVibGljSWQ7XG4gICAgfSxcbiAgICBnZXREb2N1bWVudFR5cGVOb2RlU3lzdGVtSWQoZG9jdHlwZU5vZGUpIHtcbiAgICAgICAgcmV0dXJuIGRvY3R5cGVOb2RlLnN5c3RlbUlkO1xuICAgIH0sXG4gICAgLy9Ob2RlIHR5cGVzXG4gICAgaXNUZXh0Tm9kZShub2RlKSB7XG4gICAgICAgIHJldHVybiBub2RlLm5vZGVOYW1lID09PSAnI3RleHQnO1xuICAgIH0sXG4gICAgaXNDb21tZW50Tm9kZShub2RlKSB7XG4gICAgICAgIHJldHVybiBub2RlLm5vZGVOYW1lID09PSAnI2NvbW1lbnQnO1xuICAgIH0sXG4gICAgaXNEb2N1bWVudFR5cGVOb2RlKG5vZGUpIHtcbiAgICAgICAgcmV0dXJuIG5vZGUubm9kZU5hbWUgPT09ICcjZG9jdW1lbnRUeXBlJztcbiAgICB9LFxuICAgIGlzRWxlbWVudE5vZGUobm9kZSkge1xuICAgICAgICByZXR1cm4gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG5vZGUsICd0YWdOYW1lJyk7XG4gICAgfSxcbiAgICAvLyBTb3VyY2UgY29kZSBsb2NhdGlvblxuICAgIHNldE5vZGVTb3VyY2VDb2RlTG9jYXRpb24obm9kZSwgbG9jYXRpb24pIHtcbiAgICAgICAgbm9kZS5zb3VyY2VDb2RlTG9jYXRpb24gPSBsb2NhdGlvbjtcbiAgICB9LFxuICAgIGdldE5vZGVTb3VyY2VDb2RlTG9jYXRpb24obm9kZSkge1xuICAgICAgICByZXR1cm4gbm9kZS5zb3VyY2VDb2RlTG9jYXRpb247XG4gICAgfSxcbiAgICB1cGRhdGVOb2RlU291cmNlQ29kZUxvY2F0aW9uKG5vZGUsIGVuZExvY2F0aW9uKSB7XG4gICAgICAgIG5vZGUuc291cmNlQ29kZUxvY2F0aW9uID0gT2JqZWN0LmFzc2lnbihPYmplY3QuYXNzaWduKHt9LCBub2RlLnNvdXJjZUNvZGVMb2NhdGlvbiksIGVuZExvY2F0aW9uKTtcbiAgICB9LFxufTtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWRlZmF1bHQuanMubWFwIl0sIm1hcHBpbmdzIjoiQUFBQSxZQUFZOztBQUNaQSxNQUFNLENBQUNDLGNBQWMsQ0FBQ0MsT0FBTyxFQUFFLFlBQVksRUFBRTtFQUFFQyxLQUFLLEVBQUU7QUFBSyxDQUFDLENBQUM7QUFDN0RELE9BQU8sQ0FBQ0Usa0JBQWtCLEdBQUcsS0FBSyxDQUFDO0FBQ25DLE1BQU1DLFNBQVMsR0FBR0MsT0FBTyxDQUFDLG1CQUFtQixDQUFDO0FBQzlDLFNBQVNDLGNBQWNBLENBQUNKLEtBQUssRUFBRTtFQUMzQixPQUFPO0lBQ0hLLFFBQVEsRUFBRSxPQUFPO0lBQ2pCTCxLQUFLO0lBQ0xNLFVBQVUsRUFBRTtFQUNoQixDQUFDO0FBQ0w7QUFD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