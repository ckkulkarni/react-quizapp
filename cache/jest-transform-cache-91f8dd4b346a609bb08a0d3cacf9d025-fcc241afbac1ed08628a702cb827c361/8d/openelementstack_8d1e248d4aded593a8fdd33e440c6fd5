ee019295a35e935ece427bdba6d17f49
"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.OpenElementStack = void 0;
const html_js_1 = require("../common/html.js");
//Element utils
const IMPLICIT_END_TAG_REQUIRED = new Set([html_js_1.TAG_ID.DD, html_js_1.TAG_ID.DT, html_js_1.TAG_ID.LI, html_js_1.TAG_ID.OPTGROUP, html_js_1.TAG_ID.OPTION, html_js_1.TAG_ID.P, html_js_1.TAG_ID.RB, html_js_1.TAG_ID.RP, html_js_1.TAG_ID.RT, html_js_1.TAG_ID.RTC]);
const IMPLICIT_END_TAG_REQUIRED_THOROUGHLY = new Set([...IMPLICIT_END_TAG_REQUIRED, html_js_1.TAG_ID.CAPTION, html_js_1.TAG_ID.COLGROUP, html_js_1.TAG_ID.TBODY, html_js_1.TAG_ID.TD, html_js_1.TAG_ID.TFOOT, html_js_1.TAG_ID.TH, html_js_1.TAG_ID.THEAD, html_js_1.TAG_ID.TR]);
const SCOPING_ELEMENT_NS = new Map([[html_js_1.TAG_ID.APPLET, html_js_1.NS.HTML], [html_js_1.TAG_ID.CAPTION, html_js_1.NS.HTML], [html_js_1.TAG_ID.HTML, html_js_1.NS.HTML], [html_js_1.TAG_ID.MARQUEE, html_js_1.NS.HTML], [html_js_1.TAG_ID.OBJECT, html_js_1.NS.HTML], [html_js_1.TAG_ID.TABLE, html_js_1.NS.HTML], [html_js_1.TAG_ID.TD, html_js_1.NS.HTML], [html_js_1.TAG_ID.TEMPLATE, html_js_1.NS.HTML], [html_js_1.TAG_ID.TH, html_js_1.NS.HTML], [html_js_1.TAG_ID.ANNOTATION_XML, html_js_1.NS.MATHML], [html_js_1.TAG_ID.MI, html_js_1.NS.MATHML], [html_js_1.TAG_ID.MN, html_js_1.NS.MATHML], [html_js_1.TAG_ID.MO, html_js_1.NS.MATHML], [html_js_1.TAG_ID.MS, html_js_1.NS.MATHML], [html_js_1.TAG_ID.MTEXT, html_js_1.NS.MATHML], [html_js_1.TAG_ID.DESC, html_js_1.NS.SVG], [html_js_1.TAG_ID.FOREIGN_OBJECT, html_js_1.NS.SVG], [html_js_1.TAG_ID.TITLE, html_js_1.NS.SVG]]);
const NAMED_HEADERS = [html_js_1.TAG_ID.H1, html_js_1.TAG_ID.H2, html_js_1.TAG_ID.H3, html_js_1.TAG_ID.H4, html_js_1.TAG_ID.H5, html_js_1.TAG_ID.H6];
const TABLE_ROW_CONTEXT = [html_js_1.TAG_ID.TR, html_js_1.TAG_ID.TEMPLATE, html_js_1.TAG_ID.HTML];
const TABLE_BODY_CONTEXT = [html_js_1.TAG_ID.TBODY, html_js_1.TAG_ID.TFOOT, html_js_1.TAG_ID.THEAD, html_js_1.TAG_ID.TEMPLATE, html_js_1.TAG_ID.HTML];
const TABLE_CONTEXT = [html_js_1.TAG_ID.TABLE, html_js_1.TAG_ID.TEMPLATE, html_js_1.TAG_ID.HTML];
const TABLE_CELLS = [html_js_1.TAG_ID.TD, html_js_1.TAG_ID.TH];
//Stack of open elements
class OpenElementStack {
  get currentTmplContentOrNode() {
    return this._isInTemplate() ? this.treeAdapter.getTemplateContent(this.current) : this.current;
  }
  constructor(document, treeAdapter, handler) {
    this.treeAdapter = treeAdapter;
    this.handler = handler;
    this.items = [];
    this.tagIDs = [];
    this.stackTop = -1;
    this.tmplCount = 0;
    this.currentTagId = html_js_1.TAG_ID.UNKNOWN;
    this.current = document;
  }
  //Index of element
  _indexOf(element) {
    return this.items.lastIndexOf(element, this.stackTop);
  }
  //Update current element
  _isInTemplate() {
    return this.currentTagId === html_js_1.TAG_ID.TEMPLATE && this.treeAdapter.getNamespaceURI(this.current) === html_js_1.NS.HTML;
  }
  _updateCurrentElement() {
    this.current = this.items[this.stackTop];
    this.currentTagId = this.tagIDs[this.stackTop];
  }
  //Mutations
  push(element, tagID) {
    this.stackTop++;
    this.items[this.stackTop] = element;
    this.current = element;
    this.tagIDs[this.stackTop] = tagID;
    this.currentTagId = tagID;
    if (this._isInTemplate()) {
      this.tmplCount++;
    }
    this.handler.onItemPush(element, tagID, true);
  }
  pop() {
    const popped = this.current;
    if (this.tmplCount > 0 && this._isInTemplate()) {
      this.tmplCount--;
    }
    this.stackTop--;
    this._updateCurrentElement();
    this.handler.onItemPop(popped, true);
  }
  replace(oldElement, newElement) {
    const idx = this._indexOf(oldElement);
    this.items[idx] = newElement;
    if (idx === this.stackTop) {
      this.current = newElement;
    }
  }
  insertAfter(referenceElement, newElement, newElementID) {
    const insertionIdx = this._indexOf(referenceElement) + 1;
    this.items.splice(insertionIdx, 0, newElement);
    this.tagIDs.splice(insertionIdx, 0, newElementID);
    this.stackTop++;
    if (insertionIdx === this.stackTop) {
      this._updateCurrentElement();
    }
    this.handler.onItemPush(this.current, this.currentTagId, insertionIdx === this.stackTop);
  }
  popUntilTagNamePopped(tagName) {
    let targetIdx = this.stackTop + 1;
    do {
      targetIdx = this.tagIDs.lastIndexOf(tagName, targetIdx - 1);
    } while (targetIdx > 0 && this.treeAdapter.getNamespaceURI(this.items[targetIdx]) !== html_js_1.NS.HTML);
    this.shortenToLength(targetIdx < 0 ? 0 : targetIdx);
  }
  shortenToLength(idx) {
    while (this.stackTop >= idx) {
      const popped = this.current;
      if (this.tmplCount > 0 && this._isInTemplate()) {
        this.tmplCount -= 1;
      }
      this.stackTop--;
      this._updateCurrentElement();
      this.handler.onItemPop(popped, this.stackTop < idx);
    }
  }
  popUntilElementPopped(element) {
    const idx = this._indexOf(element);
    this.shortenToLength(idx < 0 ? 0 : idx);
  }
  popUntilPopped(tagNames, targetNS) {
    const idx = this._indexOfTagNames(tagNames, targetNS);
    this.shortenToLength(idx < 0 ? 0 : idx);
  }
  popUntilNumberedHeaderPopped() {
    this.popUntilPopped(NAMED_HEADERS, html_js_1.NS.HTML);
  }
  popUntilTableCellPopped() {
    this.popUntilPopped(TABLE_CELLS, html_js_1.NS.HTML);
  }
  popAllUpToHtmlElement() {
    //NOTE: here we assume that the root <html> element is always first in the open element stack, so
    //we perform this fast stack clean up.
    this.tmplCount = 0;
    this.shortenToLength(1);
  }
  _indexOfTagNames(tagNames, namespace) {
    for (let i = this.stackTop; i >= 0; i--) {
      if (tagNames.includes(this.tagIDs[i]) && this.treeAdapter.getNamespaceURI(this.items[i]) === namespace) {
        return i;
      }
    }
    return -1;
  }
  clearBackTo(tagNames, targetNS) {
    const idx = this._indexOfTagNames(tagNames, targetNS);
    this.shortenToLength(idx + 1);
  }
  clearBackToTableContext() {
    this.clearBackTo(TABLE_CONTEXT, html_js_1.NS.HTML);
  }
  clearBackToTableBodyContext() {
    this.clearBackTo(TABLE_BODY_CONTEXT, html_js_1.NS.HTML);
  }
  clearBackToTableRowContext() {
    this.clearBackTo(TABLE_ROW_CONTEXT, html_js_1.NS.HTML);
  }
  remove(element) {
    const idx = this._indexOf(element);
    if (idx >= 0) {
      if (idx === this.stackTop) {
        this.pop();
      } else {
        this.items.splice(idx, 1);
        this.tagIDs.splice(idx, 1);
        this.stackTop--;
        this._updateCurrentElement();
        this.handler.onItemPop(element, false);
      }
    }
  }
  //Search
  tryPeekProperlyNestedBodyElement() {
    //Properly nested <body> element (should be second element in stack).
    return this.stackTop >= 1 && this.tagIDs[1] === html_js_1.TAG_ID.BODY ? this.items[1] : null;
  }
  contains(element) {
    return this._indexOf(element) > -1;
  }
  getCommonAncestor(element) {
    const elementIdx = this._indexOf(element) - 1;
    return elementIdx >= 0 ? this.items[elementIdx] : null;
  }
  isRootHtmlElementCurrent() {
    return this.stackTop === 0 && this.tagIDs[0] === html_js_1.TAG_ID.HTML;
  }
  //Element in scope
  hasInScope(tagName) {
    for (let i = this.stackTop; i >= 0; i--) {
      const tn = this.tagIDs[i];
      const ns = this.treeAdapter.getNamespaceURI(this.items[i]);
      if (tn === tagName && ns === html_js_1.NS.HTML) {
        return true;
      }
      if (SCOPING_ELEMENT_NS.get(tn) === ns) {
        return false;
      }
    }
    return true;
  }
  hasNumberedHeaderInScope() {
    for (let i = this.stackTop; i >= 0; i--) {
      const tn = this.tagIDs[i];
      const ns = this.treeAdapter.getNamespaceURI(this.items[i]);
      if ((0, html_js_1.isNumberedHeader)(tn) && ns === html_js_1.NS.HTML) {
        return true;
      }
      if (SCOPING_ELEMENT_NS.get(tn) === ns) {
        return false;
      }
    }
    return true;
  }
  hasInListItemScope(tagName) {
    for (let i = this.stackTop; i >= 0; i--) {
      const tn = this.tagIDs[i];
      const ns = this.treeAdapter.getNamespaceURI(this.items[i]);
      if (tn === tagName && ns === html_js_1.NS.HTML) {
        return true;
      }
      if ((tn === html_js_1.TAG_ID.UL || tn === html_js_1.TAG_ID.OL) && ns === html_js_1.NS.HTML || SCOPING_ELEMENT_NS.get(tn) === ns) {
        return false;
      }
    }
    return true;
  }
  hasInButtonScope(tagName) {
    for (let i = this.stackTop; i >= 0; i--) {
      const tn = this.tagIDs[i];
      const ns = this.treeAdapter.getNamespaceURI(this.items[i]);
      if (tn === tagName && ns === html_js_1.NS.HTML) {
        return true;
      }
      if (tn === html_js_1.TAG_ID.BUTTON && ns === html_js_1.NS.HTML || SCOPING_ELEMENT_NS.get(tn) === ns) {
        return false;
      }
    }
    return true;
  }
  hasInTableScope(tagName) {
    for (let i = this.stackTop; i >= 0; i--) {
      const tn = this.tagIDs[i];
      const ns = this.treeAdapter.getNamespaceURI(this.items[i]);
      if (ns !== html_js_1.NS.HTML) {
        continue;
      }
      if (tn === tagName) {
        return true;
      }
      if (tn === html_js_1.TAG_ID.TABLE || tn === html_js_1.TAG_ID.TEMPLATE || tn === html_js_1.TAG_ID.HTML) {
        return false;
      }
    }
    return true;
  }
  hasTableBodyContextInTableScope() {
    for (let i = this.stackTop; i >= 0; i--) {
      const tn = this.tagIDs[i];
      const ns = this.treeAdapter.getNamespaceURI(this.items[i]);
      if (ns !== html_js_1.NS.HTML) {
        continue;
      }
      if (tn === html_js_1.TAG_ID.TBODY || tn === html_js_1.TAG_ID.THEAD || tn === html_js_1.TAG_ID.TFOOT) {
        return true;
      }
      if (tn === html_js_1.TAG_ID.TABLE || tn === html_js_1.TAG_ID.HTML) {
        return false;
      }
    }
    return true;
  }
  hasInSelectScope(tagName) {
    for (let i = this.stackTop; i >= 0; i--) {
      const tn = this.tagIDs[i];
      const ns = this.treeAdapter.getNamespaceURI(this.items[i]);
      if (ns !== html_js_1.NS.HTML) {
        continue;
      }
      if (tn === tagName) {
        return true;
      }
      if (tn !== html_js_1.TAG_ID.OPTION && tn !== html_js_1.TAG_ID.OPTGROUP) {
        return false;
      }
    }
    return true;
  }
  //Implied end tags
  generateImpliedEndTags() {
    while (IMPLICIT_END_TAG_REQUIRED.has(this.currentTagId)) {
      this.pop();
    }
  }
  generateImpliedEndTagsThoroughly() {
    while (IMPLICIT_END_TAG_REQUIRED_THOROUGHLY.has(this.currentTagId)) {
      this.pop();
    }
  }
  generateImpliedEndTagsWithExclusion(exclusionId) {
    while (this.currentTagId !== exclusionId && IMPLICIT_END_TAG_REQUIRED_THOROUGHLY.has(this.currentTagId)) {
      this.pop();
    }
  }
}
exports.OpenElementStack = OpenElementStack;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJPYmplY3QiLCJkZWZpbmVQcm9wZXJ0eSIsImV4cG9ydHMiLCJ2YWx1ZSIsIk9wZW5FbGVtZW50U3RhY2siLCJodG1sX2pzXzEiLCJyZXF1aXJlIiwiSU1QTElDSVRfRU5EX1RBR19SRVFVSVJFRCIsIlNldCIsIlRBR19JRCIsIkREIiwiRFQiLCJMSSIsIk9QVEdST1VQIiwiT1BUSU9OIiwiUCIsIlJCIiwiUlAiLCJSVCIsIlJUQyIsIklNUExJQ0lUX0VORF9UQUdfUkVRVUlSRURfVEhPUk9VR0hMWSIsIkNBUFRJT04iLCJDT0xHUk9VUCIsIlRCT0RZIiwiVEQiLCJURk9PVCIsIlRIIiwiVEhFQUQiLCJUUiIsIlNDT1BJTkdfRUxFTUVOVF9OUyIsIk1hcCIsIkFQUExFVCIsIk5TIiwiSFRNTCIsIk1BUlFVRUUiLCJPQkpFQ1QiLCJUQUJMRSIsIlRFTVBMQVRFIiwiQU5OT1RBVElPTl9YTUwiLCJNQVRITUwiLCJNSSIsIk1OIiwiTU8iLCJNUyIsIk1URVhUIiwiREVTQyIsIlNWRyIsIkZPUkVJR05fT0JKRUNUIiwiVElUTEUiLCJOQU1FRF9IRUFERVJTIiwiSDEiLCJIMiIsIkgzIiwiSDQiLCJINSIsIkg2IiwiVEFCTEVfUk9XX0NPTlRFWFQiLCJUQUJMRV9CT0RZX0NPTlRFWFQiLCJUQUJMRV9DT05URVhUIiwiVEFCTEVfQ0VMTFMiLCJjdXJyZW50VG1wbENvbnRlbnRPck5vZGUiLCJfaXNJblRlbXBsYXRlIiwidHJlZUFkYXB0ZXIiLCJnZXRUZW1wbGF0ZUNvbnRlbnQiLCJjdXJyZW50IiwiY29uc3RydWN0b3IiLCJkb2N1bWVudCIsImhhbmRsZXIiLCJpdGVtcyIsInRhZ0lEcyIsInN0YWNrVG9wIiwidG1wbENvdW50IiwiY3VycmVudFRhZ0lkIiwiVU5LTk9XTiIsIl9pbmRleE9mIiwiZWxlbWVudCIsImxhc3RJbmRleE9mIiwiZ2V0TmFtZXNwYWNlVVJJIiwiX3VwZGF0ZUN1cnJlbnRFbGVtZW50IiwicHVzaCIsInRhZ0lEIiwib25JdGVtUHVzaCIsInBvcCIsInBvcHBlZCIsIm9uSXRlbVBvcCIsInJlcGxhY2UiLCJvbGRFbGVtZW50IiwibmV3RWxlbWVudCIsImlkeCIsImluc2VydEFmdGVyIiwicmVmZXJlbmNlRWxlbWVudCIsIm5ld0VsZW1lbnRJRCIsImluc2VydGlvbklkeCIsInNwbGljZSIsInBvcFVudGlsVGFnTmFtZVBvcHBlZCIsInRhZ05hbWUiLCJ0YXJnZXRJZHgiLCJzaG9ydGVuVG9MZW5ndGgiLCJwb3BVbnRpbEVsZW1lbnRQb3BwZWQiLCJwb3BVbnRpbFBvcHBlZCIsInRhZ05hbWVzIiwidGFyZ2V0TlMiLCJfaW5kZXhPZlRhZ05hbWVzIiwicG9wVW50aWxOdW1iZXJlZEhlYWRlclBvcHBlZCIsInBvcFVudGlsVGFibGVDZWxsUG9wcGVkIiwicG9wQWxsVXBUb0h0bWxFbGVtZW50IiwibmFtZXNwYWNlIiwiaSIsImluY2x1ZGVzIiwiY2xlYXJCYWNrVG8iLCJjbGVhckJhY2tUb1RhYmxlQ29udGV4dCIsImNsZWFyQmFja1RvVGFibGVCb2R5Q29udGV4dCIsImNsZWFyQmFja1RvVGFibGVSb3dDb250ZXh0IiwicmVtb3ZlIiwidHJ5UGVla1Byb3Blcmx5TmVzdGVkQm9keUVsZW1lbnQiLCJCT0RZIiwiY29udGFpbnMiLCJnZXRDb21tb25BbmNlc3RvciIsImVsZW1lbnRJZHgiLCJpc1Jvb3RIdG1sRWxlbWVudEN1cnJlbnQiLCJoYXNJblNjb3BlIiwidG4iLCJucyIsImdldCIsImhhc051bWJlcmVkSGVhZGVySW5TY29wZSIsImlzTnVtYmVyZWRIZWFkZXIiLCJoYXNJbkxpc3RJdGVtU2NvcGUiLCJVTCIsIk9MIiwiaGFzSW5CdXR0b25TY29wZSIsIkJVVFRPTiIsImhhc0luVGFibGVTY29wZSIsImhhc1RhYmxlQm9keUNvbnRleHRJblRhYmxlU2NvcGUiLCJoYXNJblNlbGVjdFNjb3BlIiwiZ2VuZXJhdGVJbXBsaWVkRW5kVGFncyIsImhhcyIsImdlbmVyYXRlSW1wbGllZEVuZFRhZ3NUaG9yb3VnaGx5IiwiZ2VuZXJhdGVJbXBsaWVkRW5kVGFnc1dpdGhFeGNsdXNpb24iLCJleGNsdXNpb25JZCJdLCJzb3VyY2VzIjpbIm9wZW4tZWxlbWVudC1zdGFjay5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuT3BlbkVsZW1lbnRTdGFjayA9IHZvaWQgMDtcbmNvbnN0IGh0bWxfanNfMSA9IHJlcXVpcmUoXCIuLi9jb21tb24vaHRtbC5qc1wiKTtcbi8vRWxlbWVudCB1dGlsc1xuY29uc3QgSU1QTElDSVRfRU5EX1RBR19SRVFVSVJFRCA9IG5ldyBTZXQoW2h0bWxfanNfMS5UQUdfSUQuREQsIGh0bWxfanNfMS5UQUdfSUQuRFQsIGh0bWxfanNfMS5UQUdfSUQuTEksIGh0bWxfanNfMS5UQUdfSUQuT1BUR1JPVVAsIGh0bWxfanNfMS5UQUdfSUQuT1BUSU9OLCBodG1sX2pzXzEuVEFHX0lELlAsIGh0bWxfanNfMS5UQUdfSUQuUkIsIGh0bWxfanNfMS5UQUdfSUQuUlAsIGh0bWxfanNfMS5UQUdfSUQuUlQsIGh0bWxfanNfMS5UQUdfSUQuUlRDXSk7XG5jb25zdCBJTVBMSUNJVF9FTkRfVEFHX1JFUVVJUkVEX1RIT1JPVUdITFkgPSBuZXcgU2V0KFtcbiAgICAuLi5JTVBMSUNJVF9FTkRfVEFHX1JFUVVJUkVELFxuICAgIGh0bWxfanNfMS5UQUdfSUQuQ0FQVElPTixcbiAgICBodG1sX2pzXzEuVEFHX0lELkNPTEdST1VQLFxuICAgIGh0bWxfanNfMS5UQUdfSUQuVEJPRFksXG4gICAgaHRtbF9qc18xLlRBR19JRC5URCxcbiAgICBodG1sX2pzXzEuVEFHX0lELlRGT09ULFxuICAgIGh0bWxfanNfMS5UQUdfSUQuVEgsXG4gICAgaHRtbF9qc18xLlRBR19JRC5USEVBRCxcbiAgICBodG1sX2pzXzEuVEFHX0lELlRSLFxuXSk7XG5jb25zdCBTQ09QSU5HX0VMRU1FTlRfTlMgPSBuZXcgTWFwKFtcbiAgICBbaHRtbF9qc18xLlRBR19JRC5BUFBMRVQsIGh0bWxfanNfMS5OUy5IVE1MXSxcbiAgICBbaHRtbF9qc18xLlRBR19JRC5DQVBUSU9OLCBodG1sX2pzXzEuTlMuSFRNTF0sXG4gICAgW2h0bWxfanNfMS5UQUdfSUQuSFRNTCwgaHRtbF9qc18xLk5TLkhUTUxdLFxuICAgIFtodG1sX2pzXzEuVEFHX0lELk1BUlFVRUUsIGh0bWxfanNfMS5OUy5IVE1MXSxcbiAgICBbaHRtbF9qc18xLlRBR19JRC5PQkpFQ1QsIGh0bWxfanNfMS5OUy5IVE1MXSxcbiAgICBbaHRtbF9qc18xLlRBR19JRC5UQUJMRSwgaHRtbF9qc18xLk5TLkhUTUxdLFxuICAgIFtodG1sX2pzXzEuVEFHX0lELlRELCBodG1sX2pzXzEuTlMuSFRNTF0sXG4gICAgW2h0bWxfanNfMS5UQUdfSUQuVEVNUExBVEUsIGh0bWxfanNfMS5OUy5IVE1MXSxcbiAgICBbaHRtbF9qc18xLlRBR19JRC5USCwgaHRtbF9qc18xLk5TLkhUTUxdLFxuICAgIFtodG1sX2pzXzEuVEFHX0lELkFOTk9UQVRJT05fWE1MLCBodG1sX2pzXzEuTlMuTUFUSE1MXSxcbiAgICBbaHRtbF9qc18xLlRBR19JRC5NSSwgaHRtbF9qc18xLk5TLk1BVEhNTF0sXG4gICAgW2h0bWxfanNfMS5UQUdfSUQuTU4sIGh0bWxfanNfMS5OUy5NQVRITUxdLFxuICAgIFtodG1sX2pzXzEuVEFHX0lELk1PLCBodG1sX2pzXzEuTlMuTUFUSE1MXSxcbiAgICBbaHRtbF9qc18xLlRBR19JRC5NUywgaHRtbF9qc18xLk5TLk1BVEhNTF0sXG4gICAgW2h0bWxfanNfMS5UQUdfSUQuTVRFWFQsIGh0bWxfanNfMS5OUy5NQVRITUxdLFxuICAgIFtodG1sX2pzXzEuVEFHX0lELkRFU0MsIGh0bWxfanNfMS5OUy5TVkddLFxuICAgIFtodG1sX2pzXzEuVEFHX0lELkZPUkVJR05fT0JKRUNULCBodG1sX2pzXzEuTlMuU1ZHXSxcbiAgICBbaHRtbF9qc18xLlRBR19JRC5USVRMRSwgaHRtbF9qc18xLk5TLlNWR10sXG5dKTtcbmNvbnN0IE5BTUVEX0hFQURFUlMgPSBbaHRtbF9qc18xLlRBR19JRC5IMSwgaHRtbF9qc18xLlRBR19JRC5IMiwgaHRtbF9qc18xLlRBR19JRC5IMywgaHRtbF9qc18xLlRBR19JRC5INCwgaHRtbF9qc18xLlRBR19JRC5INSwgaHRtbF9qc18xLlRBR19JRC5INl07XG5jb25zdCBUQUJMRV9ST1dfQ09OVEVYVCA9IFtodG1sX2pzXzEuVEFHX0lELlRSLCBodG1sX2pzXzEuVEFHX0lELlRFTVBMQVRFLCBodG1sX2pzXzEuVEFHX0lELkhUTUxdO1xuY29uc3QgVEFCTEVfQk9EWV9DT05URVhUID0gW2h0bWxfanNfMS5UQUdfSUQuVEJPRFksIGh0bWxfanNfMS5UQUdfSUQuVEZPT1QsIGh0bWxfanNfMS5UQUdfSUQuVEhFQUQsIGh0bWxfanNfMS5UQUdfSUQuVEVNUExBVEUsIGh0bWxfanNfMS5UQUdfSUQuSFRNTF07XG5jb25zdCBUQUJMRV9DT05URVhUID0gW2h0bWxfanNfMS5UQUdfSUQuVEFCTEUsIGh0bWxfanNfMS5UQUdfSUQuVEVNUExBVEUsIGh0bWxfanNfMS5UQUdfSUQuSFRNTF07XG5jb25zdCBUQUJMRV9DRUxMUyA9IFtodG1sX2pzXzEuVEFHX0lELlRELCBodG1sX2pzXzEuVEFHX0lELlRIXTtcbi8vU3RhY2sgb2Ygb3BlbiBlbGVtZW50c1xuY2xhc3MgT3BlbkVsZW1lbnRTdGFjayB7XG4gICAgZ2V0IGN1cnJlbnRUbXBsQ29udGVudE9yTm9kZSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2lzSW5UZW1wbGF0ZSgpID8gdGhpcy50cmVlQWRhcHRlci5nZXRUZW1wbGF0ZUNvbnRlbnQodGhpcy5jdXJyZW50KSA6IHRoaXMuY3VycmVudDtcbiAgICB9XG4gICAgY29uc3RydWN0b3IoZG9jdW1lbnQsIHRyZWVBZGFwdGVyLCBoYW5kbGVyKSB7XG4gICAgICAgIHRoaXMudHJlZUFkYXB0ZXIgPSB0cmVlQWRhcHRlcjtcbiAgICAgICAgdGhpcy5oYW5kbGVyID0gaGFuZGxlcjtcbiAgICAgICAgdGhpcy5pdGVtcyA9IFtdO1xuICAgICAgICB0aGlzLnRhZ0lEcyA9IFtdO1xuICAgICAgICB0aGlzLnN0YWNrVG9wID0gLTE7XG4gICAgICAgIHRoaXMudG1wbENvdW50ID0gMDtcbiAgICAgICAgdGhpcy5jdXJyZW50VGFnSWQgPSBodG1sX2pzXzEuVEFHX0lELlVOS05PV047XG4gICAgICAgIHRoaXMuY3VycmVudCA9IGRvY3VtZW50O1xuICAgIH1cbiAgICAvL0luZGV4IG9mIGVsZW1lbnRcbiAgICBfaW5kZXhPZihlbGVtZW50KSB7XG4gICAgICAgIHJldHVybiB0aGlzLml0ZW1zLmxhc3RJbmRleE9mKGVsZW1lbnQsIHRoaXMuc3RhY2tUb3ApO1xuICAgIH1cbiAgICAvL1VwZGF0ZSBjdXJyZW50IGVsZW1lbnRcbiAgICBfaXNJblRlbXBsYXRlKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5jdXJyZW50VGFnSWQgPT09IGh0bWxfanNfMS5UQUdfSUQuVEVNUExBVEUgJiYgdGhpcy50cmVlQWRhcHRlci5nZXROYW1lc3BhY2VVUkkodGhpcy5jdXJyZW50KSA9PT0gaHRtbF9qc18xLk5TLkhUTUw7XG4gICAgfVxuICAgIF91cGRhdGVDdXJyZW50RWxlbWVudCgpIHtcbiAgICAgICAgdGhpcy5jdXJyZW50ID0gdGhpcy5pdGVtc1t0aGlzLnN0YWNrVG9wXTtcbiAgICAgICAgdGhpcy5jdXJyZW50VGFnSWQgPSB0aGlzLnRhZ0lEc1t0aGlzLnN0YWNrVG9wXTtcbiAgICB9XG4gICAgLy9NdXRhdGlvbnNcbiAgICBwdXNoKGVsZW1lbnQsIHRhZ0lEKSB7XG4gICAgICAgIHRoaXMuc3RhY2tUb3ArKztcbiAgICAgICAgdGhpcy5pdGVtc1t0aGlzLnN0YWNrVG9wXSA9IGVsZW1lbnQ7XG4gICAgICAgIHRoaXMuY3VycmVudCA9IGVsZW1lbnQ7XG4gICAgICAgIHRoaXMudGFnSURzW3RoaXMuc3RhY2tUb3BdID0gdGFnSUQ7XG4gICAgICAgIHRoaXMuY3VycmVudFRhZ0lkID0gdGFnSUQ7XG4gICAgICAgIGlmICh0aGlzLl9pc0luVGVtcGxhdGUoKSkge1xuICAgICAgICAgICAgdGhpcy50bXBsQ291bnQrKztcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmhhbmRsZXIub25JdGVtUHVzaChlbGVtZW50LCB0YWdJRCwgdHJ1ZSk7XG4gICAgfVxuICAgIHBvcCgpIHtcbiAgICAgICAgY29uc3QgcG9wcGVkID0gdGhpcy5jdXJyZW50O1xuICAgICAgICBpZiAodGhpcy50bXBsQ291bnQgPiAwICYmIHRoaXMuX2lzSW5UZW1wbGF0ZSgpKSB7XG4gICAgICAgICAgICB0aGlzLnRtcGxDb3VudC0tO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuc3RhY2tUb3AtLTtcbiAgICAgICAgdGhpcy5fdXBkYXRlQ3VycmVudEVsZW1lbnQoKTtcbiAgICAgICAgdGhpcy5oYW5kbGVyLm9uSXRlbVBvcChwb3BwZWQsIHRydWUpO1xuICAgIH1cbiAgICByZXBsYWNlKG9sZEVsZW1lbnQsIG5ld0VsZW1lbnQpIHtcbiAgICAgICAgY29uc3QgaWR4ID0gdGhpcy5faW5kZXhPZihvbGRFbGVtZW50KTtcbiAgICAgICAgdGhpcy5pdGVtc1tpZHhdID0gbmV3RWxlbWVudDtcbiAgICAgICAgaWYgKGlkeCA9PT0gdGhpcy5zdGFja1RvcCkge1xuICAgICAgICAgICAgdGhpcy5jdXJyZW50ID0gbmV3RWxlbWVudDtcbiAgICAgICAgfVxuICAgIH1cbiAgICBpbnNlcnRBZnRlcihyZWZlcmVuY2VFbGVtZW50LCBuZXdFbGVtZW50LCBuZXdFbGVtZW50SUQpIHtcbiAgICAgICAgY29uc3QgaW5zZXJ0aW9uSWR4ID0gdGhpcy5faW5kZXhPZihyZWZlcmVuY2VFbGVtZW50KSArIDE7XG4gICAgICAgIHRoaXMuaXRlbXMuc3BsaWNlKGluc2VydGlvbklkeCwgMCwgbmV3RWxlbWVudCk7XG4gICAgICAgIHRoaXMudGFnSURzLnNwbGljZShpbnNlcnRpb25JZHgsIDAsIG5ld0VsZW1lbnRJRCk7XG4gICAgICAgIHRoaXMuc3RhY2tUb3ArKztcbiAgICAgICAgaWYgKGluc2VydGlvbklkeCA9PT0gdGhpcy5zdGFja1RvcCkge1xuICAgICAgICAgICAgdGhpcy5fdXBkYXRlQ3VycmVudEVsZW1lbnQoKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmhhbmRsZXIub25JdGVtUHVzaCh0aGlzLmN1cnJlbnQsIHRoaXMuY3VycmVudFRhZ0lkLCBpbnNlcnRpb25JZHggPT09IHRoaXMuc3RhY2tUb3ApO1xuICAgIH1cbiAgICBwb3BVbnRpbFRhZ05hbWVQb3BwZWQodGFnTmFtZSkge1xuICAgICAgICBsZXQgdGFyZ2V0SWR4ID0gdGhpcy5zdGFja1RvcCArIDE7XG4gICAgICAgIGRvIHtcbiAgICAgICAgICAgIHRhcmdldElkeCA9IHRoaXMudGFnSURzLmxhc3RJbmRleE9mKHRhZ05hbWUsIHRhcmdldElkeCAtIDEpO1xuICAgICAgICB9IHdoaWxlICh0YXJnZXRJZHggPiAwICYmIHRoaXMudHJlZUFkYXB0ZXIuZ2V0TmFtZXNwYWNlVVJJKHRoaXMuaXRlbXNbdGFyZ2V0SWR4XSkgIT09IGh0bWxfanNfMS5OUy5IVE1MKTtcbiAgICAgICAgdGhpcy5zaG9ydGVuVG9MZW5ndGgodGFyZ2V0SWR4IDwgMCA/IDAgOiB0YXJnZXRJZHgpO1xuICAgIH1cbiAgICBzaG9ydGVuVG9MZW5ndGgoaWR4KSB7XG4gICAgICAgIHdoaWxlICh0aGlzLnN0YWNrVG9wID49IGlkeCkge1xuICAgICAgICAgICAgY29uc3QgcG9wcGVkID0gdGhpcy5jdXJyZW50O1xuICAgICAgICAgICAgaWYgKHRoaXMudG1wbENvdW50ID4gMCAmJiB0aGlzLl9pc0luVGVtcGxhdGUoKSkge1xuICAgICAgICAgICAgICAgIHRoaXMudG1wbENvdW50IC09IDE7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLnN0YWNrVG9wLS07XG4gICAgICAgICAgICB0aGlzLl91cGRhdGVDdXJyZW50RWxlbWVudCgpO1xuICAgICAgICAgICAgdGhpcy5oYW5kbGVyLm9uSXRlbVBvcChwb3BwZWQsIHRoaXMuc3RhY2tUb3AgPCBpZHgpO1xuICAgICAgICB9XG4gICAgfVxuICAgIHBvcFVudGlsRWxlbWVudFBvcHBlZChlbGVtZW50KSB7XG4gICAgICAgIGNvbnN0IGlkeCA9IHRoaXMuX2luZGV4T2YoZWxlbWVudCk7XG4gICAgICAgIHRoaXMuc2hvcnRlblRvTGVuZ3RoKGlkeCA8IDAgPyAwIDogaWR4KTtcbiAgICB9XG4gICAgcG9wVW50aWxQb3BwZWQodGFnTmFtZXMsIHRhcmdldE5TKSB7XG4gICAgICAgIGNvbnN0IGlkeCA9IHRoaXMuX2luZGV4T2ZUYWdOYW1lcyh0YWdOYW1lcywgdGFyZ2V0TlMpO1xuICAgICAgICB0aGlzLnNob3J0ZW5Ub0xlbmd0aChpZHggPCAwID8gMCA6IGlkeCk7XG4gICAgfVxuICAgIHBvcFVudGlsTnVtYmVyZWRIZWFkZXJQb3BwZWQoKSB7XG4gICAgICAgIHRoaXMucG9wVW50aWxQb3BwZWQoTkFNRURfSEVBREVSUywgaHRtbF9qc18xLk5TLkhUTUwpO1xuICAgIH1cbiAgICBwb3BVbnRpbFRhYmxlQ2VsbFBvcHBlZCgpIHtcbiAgICAgICAgdGhpcy5wb3BVbnRpbFBvcHBlZChUQUJMRV9DRUxMUywgaHRtbF9qc18xLk5TLkhUTUwpO1xuICAgIH1cbiAgICBwb3BBbGxVcFRvSHRtbEVsZW1lbnQoKSB7XG4gICAgICAgIC8vTk9URTogaGVyZSB3ZSBhc3N1bWUgdGhhdCB0aGUgcm9vdCA8aHRtbD4gZWxlbWVudCBpcyBhbHdheXMgZmlyc3QgaW4gdGhlIG9wZW4gZWxlbWVudCBzdGFjaywgc29cbiAgICAgICAgLy93ZSBwZXJmb3JtIHRoaXMgZmFzdCBzdGFjayBjbGVhbiB1cC5cbiAgICAgICAgdGhpcy50bXBsQ291bnQgPSAwO1xuICAgICAgICB0aGlzLnNob3J0ZW5Ub0xlbmd0aCgxKTtcbiAgICB9XG4gICAgX2luZGV4T2ZUYWdOYW1lcyh0YWdOYW1lcywgbmFtZXNwYWNlKSB7XG4gICAgICAgIGZvciAobGV0IGkgPSB0aGlzLnN0YWNrVG9wOyBpID49IDA7IGktLSkge1xuICAgICAgICAgICAgaWYgKHRhZ05hbWVzLmluY2x1ZGVzKHRoaXMudGFnSURzW2ldKSAmJiB0aGlzLnRyZWVBZGFwdGVyLmdldE5hbWVzcGFjZVVSSSh0aGlzLml0ZW1zW2ldKSA9PT0gbmFtZXNwYWNlKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIC0xO1xuICAgIH1cbiAgICBjbGVhckJhY2tUbyh0YWdOYW1lcywgdGFyZ2V0TlMpIHtcbiAgICAgICAgY29uc3QgaWR4ID0gdGhpcy5faW5kZXhPZlRhZ05hbWVzKHRhZ05hbWVzLCB0YXJnZXROUyk7XG4gICAgICAgIHRoaXMuc2hvcnRlblRvTGVuZ3RoKGlkeCArIDEpO1xuICAgIH1cbiAgICBjbGVhckJhY2tUb1RhYmxlQ29udGV4dCgpIHtcbiAgICAgICAgdGhpcy5jbGVhckJhY2tUbyhUQUJMRV9DT05URVhULCBodG1sX2pzXzEuTlMuSFRNTCk7XG4gICAgfVxuICAgIGNsZWFyQmFja1RvVGFibGVCb2R5Q29udGV4dCgpIHtcbiAgICAgICAgdGhpcy5jbGVhckJhY2tUbyhUQUJMRV9CT0RZX0NPTlRFWFQsIGh0bWxfanNfMS5OUy5IVE1MKTtcbiAgICB9XG4gICAgY2xlYXJCYWNrVG9UYWJsZVJvd0NvbnRleHQoKSB7XG4gICAgICAgIHRoaXMuY2xlYXJCYWNrVG8oVEFCTEVfUk9XX0NPTlRFWFQsIGh0bWxfanNfMS5OUy5IVE1MKTtcbiAgICB9XG4gICAgcmVtb3ZlKGVsZW1lbnQpIHtcbiAgICAgICAgY29uc3QgaWR4ID0gdGhpcy5faW5kZXhPZihlbGVtZW50KTtcbiAgICAgICAgaWYgKGlkeCA+PSAwKSB7XG4gICAgICAgICAgICBpZiAoaWR4ID09PSB0aGlzLnN0YWNrVG9wKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5wb3AoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMuaXRlbXMuc3BsaWNlKGlkeCwgMSk7XG4gICAgICAgICAgICAgICAgdGhpcy50YWdJRHMuc3BsaWNlKGlkeCwgMSk7XG4gICAgICAgICAgICAgICAgdGhpcy5zdGFja1RvcC0tO1xuICAgICAgICAgICAgICAgIHRoaXMuX3VwZGF0ZUN1cnJlbnRFbGVtZW50KCk7XG4gICAgICAgICAgICAgICAgdGhpcy5oYW5kbGVyLm9uSXRlbVBvcChlbGVtZW50LCBmYWxzZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgLy9TZWFyY2hcbiAgICB0cnlQZWVrUHJvcGVybHlOZXN0ZWRCb2R5RWxlbWVudCgpIHtcbiAgICAgICAgLy9Qcm9wZXJseSBuZXN0ZWQgPGJvZHk+IGVsZW1lbnQgKHNob3VsZCBiZSBzZWNvbmQgZWxlbWVudCBpbiBzdGFjaykuXG4gICAgICAgIHJldHVybiB0aGlzLnN0YWNrVG9wID49IDEgJiYgdGhpcy50YWdJRHNbMV0gPT09IGh0bWxfanNfMS5UQUdfSUQuQk9EWSA/IHRoaXMuaXRlbXNbMV0gOiBudWxsO1xuICAgIH1cbiAgICBjb250YWlucyhlbGVtZW50KSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9pbmRleE9mKGVsZW1lbnQpID4gLTE7XG4gICAgfVxuICAgIGdldENvbW1vbkFuY2VzdG9yKGVsZW1lbnQpIHtcbiAgICAgICAgY29uc3QgZWxlbWVudElkeCA9IHRoaXMuX2luZGV4T2YoZWxlbWVudCkgLSAxO1xuICAgICAgICByZXR1cm4gZWxlbWVudElkeCA+PSAwID8gdGhpcy5pdGVtc1tlbGVtZW50SWR4XSA6IG51bGw7XG4gICAgfVxuICAgIGlzUm9vdEh0bWxFbGVtZW50Q3VycmVudCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuc3RhY2tUb3AgPT09IDAgJiYgdGhpcy50YWdJRHNbMF0gPT09IGh0bWxfanNfMS5UQUdfSUQuSFRNTDtcbiAgICB9XG4gICAgLy9FbGVtZW50IGluIHNjb3BlXG4gICAgaGFzSW5TY29wZSh0YWdOYW1lKSB7XG4gICAgICAgIGZvciAobGV0IGkgPSB0aGlzLnN0YWNrVG9wOyBpID49IDA7IGktLSkge1xuICAgICAgICAgICAgY29uc3QgdG4gPSB0aGlzLnRhZ0lEc1tpXTtcbiAgICAgICAgICAgIGNvbnN0IG5zID0gdGhpcy50cmVlQWRhcHRlci5nZXROYW1lc3BhY2VVUkkodGhpcy5pdGVtc1tpXSk7XG4gICAgICAgICAgICBpZiAodG4gPT09IHRhZ05hbWUgJiYgbnMgPT09IGh0bWxfanNfMS5OUy5IVE1MKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoU0NPUElOR19FTEVNRU5UX05TLmdldCh0bikgPT09IG5zKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgICBoYXNOdW1iZXJlZEhlYWRlckluU2NvcGUoKSB7XG4gICAgICAgIGZvciAobGV0IGkgPSB0aGlzLnN0YWNrVG9wOyBpID49IDA7IGktLSkge1xuICAgICAgICAgICAgY29uc3QgdG4gPSB0aGlzLnRhZ0lEc1tpXTtcbiAgICAgICAgICAgIGNvbnN0IG5zID0gdGhpcy50cmVlQWRhcHRlci5nZXROYW1lc3BhY2VVUkkodGhpcy5pdGVtc1tpXSk7XG4gICAgICAgICAgICBpZiAoKDAsIGh0bWxfanNfMS5pc051bWJlcmVkSGVhZGVyKSh0bikgJiYgbnMgPT09IGh0bWxfanNfMS5OUy5IVE1MKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoU0NPUElOR19FTEVNRU5UX05TLmdldCh0bikgPT09IG5zKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgICBoYXNJbkxpc3RJdGVtU2NvcGUodGFnTmFtZSkge1xuICAgICAgICBmb3IgKGxldCBpID0gdGhpcy5zdGFja1RvcDsgaSA+PSAwOyBpLS0pIHtcbiAgICAgICAgICAgIGNvbnN0IHRuID0gdGhpcy50YWdJRHNbaV07XG4gICAgICAgICAgICBjb25zdCBucyA9IHRoaXMudHJlZUFkYXB0ZXIuZ2V0TmFtZXNwYWNlVVJJKHRoaXMuaXRlbXNbaV0pO1xuICAgICAgICAgICAgaWYgKHRuID09PSB0YWdOYW1lICYmIG5zID09PSBodG1sX2pzXzEuTlMuSFRNTCkge1xuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKCgodG4gPT09IGh0bWxfanNfMS5UQUdfSUQuVUwgfHwgdG4gPT09IGh0bWxfanNfMS5UQUdfSUQuT0wpICYmIG5zID09PSBodG1sX2pzXzEuTlMuSFRNTCkgfHwgU0NPUElOR19FTEVNRU5UX05TLmdldCh0bikgPT09IG5zKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgICBoYXNJbkJ1dHRvblNjb3BlKHRhZ05hbWUpIHtcbiAgICAgICAgZm9yIChsZXQgaSA9IHRoaXMuc3RhY2tUb3A7IGkgPj0gMDsgaS0tKSB7XG4gICAgICAgICAgICBjb25zdCB0biA9IHRoaXMudGFnSURzW2ldO1xuICAgICAgICAgICAgY29uc3QgbnMgPSB0aGlzLnRyZWVBZGFwdGVyLmdldE5hbWVzcGFjZVVSSSh0aGlzLml0ZW1zW2ldKTtcbiAgICAgICAgICAgIGlmICh0biA9PT0gdGFnTmFtZSAmJiBucyA9PT0gaHRtbF9qc18xLk5TLkhUTUwpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICgodG4gPT09IGh0bWxfanNfMS5UQUdfSUQuQlVUVE9OICYmIG5zID09PSBodG1sX2pzXzEuTlMuSFRNTCkgfHwgU0NPUElOR19FTEVNRU5UX05TLmdldCh0bikgPT09IG5zKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgICBoYXNJblRhYmxlU2NvcGUodGFnTmFtZSkge1xuICAgICAgICBmb3IgKGxldCBpID0gdGhpcy5zdGFja1RvcDsgaSA+PSAwOyBpLS0pIHtcbiAgICAgICAgICAgIGNvbnN0IHRuID0gdGhpcy50YWdJRHNbaV07XG4gICAgICAgICAgICBjb25zdCBucyA9IHRoaXMudHJlZUFkYXB0ZXIuZ2V0TmFtZXNwYWNlVVJJKHRoaXMuaXRlbXNbaV0pO1xuICAgICAgICAgICAgaWYgKG5zICE9PSBodG1sX2pzXzEuTlMuSFRNTCkge1xuICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHRuID09PSB0YWdOYW1lKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAodG4gPT09IGh0bWxfanNfMS5UQUdfSUQuVEFCTEUgfHwgdG4gPT09IGh0bWxfanNfMS5UQUdfSUQuVEVNUExBVEUgfHwgdG4gPT09IGh0bWxfanNfMS5UQUdfSUQuSFRNTCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gICAgaGFzVGFibGVCb2R5Q29udGV4dEluVGFibGVTY29wZSgpIHtcbiAgICAgICAgZm9yIChsZXQgaSA9IHRoaXMuc3RhY2tUb3A7IGkgPj0gMDsgaS0tKSB7XG4gICAgICAgICAgICBjb25zdCB0biA9IHRoaXMudGFnSURzW2ldO1xuICAgICAgICAgICAgY29uc3QgbnMgPSB0aGlzLnRyZWVBZGFwdGVyLmdldE5hbWVzcGFjZVVSSSh0aGlzLml0ZW1zW2ldKTtcbiAgICAgICAgICAgIGlmIChucyAhPT0gaHRtbF9qc18xLk5TLkhUTUwpIHtcbiAgICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICh0biA9PT0gaHRtbF9qc18xLlRBR19JRC5UQk9EWSB8fCB0biA9PT0gaHRtbF9qc18xLlRBR19JRC5USEVBRCB8fCB0biA9PT0gaHRtbF9qc18xLlRBR19JRC5URk9PVCkge1xuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHRuID09PSBodG1sX2pzXzEuVEFHX0lELlRBQkxFIHx8IHRuID09PSBodG1sX2pzXzEuVEFHX0lELkhUTUwpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICAgIGhhc0luU2VsZWN0U2NvcGUodGFnTmFtZSkge1xuICAgICAgICBmb3IgKGxldCBpID0gdGhpcy5zdGFja1RvcDsgaSA+PSAwOyBpLS0pIHtcbiAgICAgICAgICAgIGNvbnN0IHRuID0gdGhpcy50YWdJRHNbaV07XG4gICAgICAgICAgICBjb25zdCBucyA9IHRoaXMudHJlZUFkYXB0ZXIuZ2V0TmFtZXNwYWNlVVJJKHRoaXMuaXRlbXNbaV0pO1xuICAgICAgICAgICAgaWYgKG5zICE9PSBodG1sX2pzXzEuTlMuSFRNTCkge1xuICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHRuID09PSB0YWdOYW1lKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAodG4gIT09IGh0bWxfanNfMS5UQUdfSUQuT1BUSU9OICYmIHRuICE9PSBodG1sX2pzXzEuVEFHX0lELk9QVEdST1VQKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgICAvL0ltcGxpZWQgZW5kIHRhZ3NcbiAgICBnZW5lcmF0ZUltcGxpZWRFbmRUYWdzKCkge1xuICAgICAgICB3aGlsZSAoSU1QTElDSVRfRU5EX1RBR19SRVFVSVJFRC5oYXModGhpcy5jdXJyZW50VGFnSWQpKSB7XG4gICAgICAgICAgICB0aGlzLnBvcCgpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGdlbmVyYXRlSW1wbGllZEVuZFRhZ3NUaG9yb3VnaGx5KCkge1xuICAgICAgICB3aGlsZSAoSU1QTElDSVRfRU5EX1RBR19SRVFVSVJFRF9USE9ST1VHSExZLmhhcyh0aGlzLmN1cnJlbnRUYWdJZCkpIHtcbiAgICAgICAgICAgIHRoaXMucG9wKCk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgZ2VuZXJhdGVJbXBsaWVkRW5kVGFnc1dpdGhFeGNsdXNpb24oZXhjbHVzaW9uSWQpIHtcbiAgICAgICAgd2hpbGUgKHRoaXMuY3VycmVudFRhZ0lkICE9PSBleGNsdXNpb25JZCAmJiBJTVBMSUNJVF9FTkRfVEFHX1JFUVVJUkVEX1RIT1JPVUdITFkuaGFzKHRoaXMuY3VycmVudFRhZ0lkKSkge1xuICAgICAgICAgICAgdGhpcy5wb3AoKTtcbiAgICAgICAgfVxuICAgIH1cbn1cbmV4cG9ydHMuT3BlbkVsZW1lbnRTdGFjayA9IE9wZW5FbGVtZW50U3RhY2s7XG4vLyMgc291cmNlTWFwcGluZ1VSTD1vcGVuLWVsZW1lbnQtc3RhY2suanMubWFwIl0sIm1hcHBpbmdzIjoiQUFBQSxZQUFZOztBQUNaQSxNQUFNLENBQUNDLGNBQWMsQ0FBQ0MsT0FBTyxFQUFFLFlBQVksRUFBRTtFQUFFQyxLQUFLLEVBQUU7QUFBSyxDQUFDLENBQUM7QUFDN0RELE9BQU8sQ0FBQ0UsZ0JBQWdCLEdBQUcsS0FBSyxDQUFDO0FBQ2pDLE1BQU1DLFNBQVMsR0FBR0MsT0FBTyxD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