c59b51f9c71cbaafdb7bbbb2d6a0a6ed
"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.serializeOuter = exports.serialize = void 0;
const html_js_1 = require("../common/html.js");
const escape_js_1 = require("entities/lib/escape.js");
const default_js_1 = require("../tree-adapters/default.js");
// Sets
const VOID_ELEMENTS = new Set([html_js_1.TAG_NAMES.AREA, html_js_1.TAG_NAMES.BASE, html_js_1.TAG_NAMES.BASEFONT, html_js_1.TAG_NAMES.BGSOUND, html_js_1.TAG_NAMES.BR, html_js_1.TAG_NAMES.COL, html_js_1.TAG_NAMES.EMBED, html_js_1.TAG_NAMES.FRAME, html_js_1.TAG_NAMES.HR, html_js_1.TAG_NAMES.IMG, html_js_1.TAG_NAMES.INPUT, html_js_1.TAG_NAMES.KEYGEN, html_js_1.TAG_NAMES.LINK, html_js_1.TAG_NAMES.META, html_js_1.TAG_NAMES.PARAM, html_js_1.TAG_NAMES.SOURCE, html_js_1.TAG_NAMES.TRACK, html_js_1.TAG_NAMES.WBR]);
function isVoidElement(node, options) {
  return options.treeAdapter.isElementNode(node) && options.treeAdapter.getNamespaceURI(node) === html_js_1.NS.HTML && VOID_ELEMENTS.has(options.treeAdapter.getTagName(node));
}
const defaultOpts = {
  treeAdapter: default_js_1.defaultTreeAdapter,
  scriptingEnabled: true
};
/**
 * Serializes an AST node to an HTML string.
 *
 * @example
 *
 * ```js
 * const parse5 = require('parse5');
 *
 * const document = parse5.parse('<!DOCTYPE html><html><head></head><body>Hi there!</body></html>');
 *
 * // Serializes a document.
 * const html = parse5.serialize(document);
 *
 * // Serializes the <html> element content.
 * const str = parse5.serialize(document.childNodes[1]);
 *
 * console.log(str); //> '<head></head><body>Hi there!</body>'
 * ```
 *
 * @param node Node to serialize.
 * @param options Serialization options.
 */
function serialize(node, options) {
  const opts = Object.assign(Object.assign({}, defaultOpts), options);
  if (isVoidElement(node, opts)) {
    return '';
  }
  return serializeChildNodes(node, opts);
}
exports.serialize = serialize;
/**
 * Serializes an AST element node to an HTML string, including the element node.
 *
 * @example
 *
 * ```js
 * const parse5 = require('parse5');
 *
 * const document = parse5.parseFragment('<div>Hello, <b>world</b>!</div>');
 *
 * // Serializes the <div> element.
 * const html = parse5.serializeOuter(document.childNodes[0]);
 *
 * console.log(str); //> '<div>Hello, <b>world</b>!</div>'
 * ```
 *
 * @param node Node to serialize.
 * @param options Serialization options.
 */
function serializeOuter(node, options) {
  const opts = Object.assign(Object.assign({}, defaultOpts), options);
  return serializeNode(node, opts);
}
exports.serializeOuter = serializeOuter;
function serializeChildNodes(parentNode, options) {
  let html = '';
  // Get container of the child nodes
  const container = options.treeAdapter.isElementNode(parentNode) && options.treeAdapter.getTagName(parentNode) === html_js_1.TAG_NAMES.TEMPLATE && options.treeAdapter.getNamespaceURI(parentNode) === html_js_1.NS.HTML ? options.treeAdapter.getTemplateContent(parentNode) : parentNode;
  const childNodes = options.treeAdapter.getChildNodes(container);
  if (childNodes) {
    for (const currentNode of childNodes) {
      html += serializeNode(currentNode, options);
    }
  }
  return html;
}
function serializeNode(node, options) {
  if (options.treeAdapter.isElementNode(node)) {
    return serializeElement(node, options);
  }
  if (options.treeAdapter.isTextNode(node)) {
    return serializeTextNode(node, options);
  }
  if (options.treeAdapter.isCommentNode(node)) {
    return serializeCommentNode(node, options);
  }
  if (options.treeAdapter.isDocumentTypeNode(node)) {
    return serializeDocumentTypeNode(node, options);
  }
  // Return an empty string for unknown nodes
  return '';
}
function serializeElement(node, options) {
  const tn = options.treeAdapter.getTagName(node);
  return `<${tn}${serializeAttributes(node, options)}>${isVoidElement(node, options) ? '' : `${serializeChildNodes(node, options)}</${tn}>`}`;
}
function serializeAttributes(node, {
  treeAdapter
}) {
  let html = '';
  for (const attr of treeAdapter.getAttrList(node)) {
    html += ' ';
    if (!attr.namespace) {
      html += attr.name;
    } else switch (attr.namespace) {
      case html_js_1.NS.XML:
        {
          html += `xml:${attr.name}`;
          break;
        }
      case html_js_1.NS.XMLNS:
        {
          if (attr.name !== 'xmlns') {
            html += 'xmlns:';
          }
          html += attr.name;
          break;
        }
      case html_js_1.NS.XLINK:
        {
          html += `xlink:${attr.name}`;
          break;
        }
      default:
        {
          html += `${attr.prefix}:${attr.name}`;
        }
    }
    html += `="${(0, escape_js_1.escapeAttribute)(attr.value)}"`;
  }
  return html;
}
function serializeTextNode(node, options) {
  const {
    treeAdapter
  } = options;
  const content = treeAdapter.getTextNodeContent(node);
  const parent = treeAdapter.getParentNode(node);
  const parentTn = parent && treeAdapter.isElementNode(parent) && treeAdapter.getTagName(parent);
  return parentTn && treeAdapter.getNamespaceURI(parent) === html_js_1.NS.HTML && (0, html_js_1.hasUnescapedText)(parentTn, options.scriptingEnabled) ? content : (0, escape_js_1.escapeText)(content);
}
function serializeCommentNode(node, {
  treeAdapter
}) {
  return `<!--${treeAdapter.getCommentNodeContent(node)}-->`;
}
function serializeDocumentTypeNode(node, {
  treeAdapter
}) {
  return `<!DOCTYPE ${treeAdapter.getDocumentTypeNodeName(node)}>`;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJPYmplY3QiLCJkZWZpbmVQcm9wZXJ0eSIsImV4cG9ydHMiLCJ2YWx1ZSIsInNlcmlhbGl6ZU91dGVyIiwic2VyaWFsaXplIiwiaHRtbF9qc18xIiwicmVxdWlyZSIsImVzY2FwZV9qc18xIiwiZGVmYXVsdF9qc18xIiwiVk9JRF9FTEVNRU5UUyIsIlNldCIsIlRBR19OQU1FUyIsIkFSRUEiLCJCQVNFIiwiQkFTRUZPTlQiLCJCR1NPVU5EIiwiQlIiLCJDT0wiLCJFTUJFRCIsIkZSQU1FIiwiSFIiLCJJTUciLCJJTlBVVCIsIktFWUdFTiIsIkxJTksiLCJNRVRBIiwiUEFSQU0iLCJTT1VSQ0UiLCJUUkFDSyIsIldCUiIsImlzVm9pZEVsZW1lbnQiLCJub2RlIiwib3B0aW9ucyIsInRyZWVBZGFwdGVyIiwiaXNFbGVtZW50Tm9kZSIsImdldE5hbWVzcGFjZVVSSSIsIk5TIiwiSFRNTCIsImhhcyIsImdldFRhZ05hbWUiLCJkZWZhdWx0T3B0cyIsImRlZmF1bHRUcmVlQWRhcHRlciIsInNjcmlwdGluZ0VuYWJsZWQiLCJvcHRzIiwiYXNzaWduIiwic2VyaWFsaXplQ2hpbGROb2RlcyIsInNlcmlhbGl6ZU5vZGUiLCJwYXJlbnROb2RlIiwiaHRtbCIsImNvbnRhaW5lciIsIlRFTVBMQVRFIiwiZ2V0VGVtcGxhdGVDb250ZW50IiwiY2hpbGROb2RlcyIsImdldENoaWxkTm9kZXMiLCJjdXJyZW50Tm9kZSIsInNlcmlhbGl6ZUVsZW1lbnQiLCJpc1RleHROb2RlIiwic2VyaWFsaXplVGV4dE5vZGUiLCJpc0NvbW1lbnROb2RlIiwic2VyaWFsaXplQ29tbWVudE5vZGUiLCJpc0RvY3VtZW50VHlwZU5vZGUiLCJzZXJpYWxpemVEb2N1bWVudFR5cGVOb2RlIiwidG4iLCJzZXJpYWxpemVBdHRyaWJ1dGVzIiwiYXR0ciIsImdldEF0dHJMaXN0IiwibmFtZXNwYWNlIiwibmFtZSIsIlhNTCIsIlhNTE5TIiwiWExJTksiLCJwcmVmaXgiLCJlc2NhcGVBdHRyaWJ1dGUiLCJjb250ZW50IiwiZ2V0VGV4dE5vZGVDb250ZW50IiwicGFyZW50IiwiZ2V0UGFyZW50Tm9kZSIsInBhcmVudFRuIiwiaGFzVW5lc2NhcGVkVGV4dCIsImVzY2FwZVRleHQiLCJnZXRDb21tZW50Tm9kZUNvbnRlbnQiLCJnZXREb2N1bWVudFR5cGVOb2RlTmFtZSJdLCJzb3VyY2VzIjpbImluZGV4LmpzIl0sInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5zZXJpYWxpemVPdXRlciA9IGV4cG9ydHMuc2VyaWFsaXplID0gdm9pZCAwO1xuY29uc3QgaHRtbF9qc18xID0gcmVxdWlyZShcIi4uL2NvbW1vbi9odG1sLmpzXCIpO1xuY29uc3QgZXNjYXBlX2pzXzEgPSByZXF1aXJlKFwiZW50aXRpZXMvbGliL2VzY2FwZS5qc1wiKTtcbmNvbnN0IGRlZmF1bHRfanNfMSA9IHJlcXVpcmUoXCIuLi90cmVlLWFkYXB0ZXJzL2RlZmF1bHQuanNcIik7XG4vLyBTZXRzXG5jb25zdCBWT0lEX0VMRU1FTlRTID0gbmV3IFNldChbXG4gICAgaHRtbF9qc18xLlRBR19OQU1FUy5BUkVBLFxuICAgIGh0bWxfanNfMS5UQUdfTkFNRVMuQkFTRSxcbiAgICBodG1sX2pzXzEuVEFHX05BTUVTLkJBU0VGT05ULFxuICAgIGh0bWxfanNfMS5UQUdfTkFNRVMuQkdTT1VORCxcbiAgICBodG1sX2pzXzEuVEFHX05BTUVTLkJSLFxuICAgIGh0bWxfanNfMS5UQUdfTkFNRVMuQ09MLFxuICAgIGh0bWxfanNfMS5UQUdfTkFNRVMuRU1CRUQsXG4gICAgaHRtbF9qc18xLlRBR19OQU1FUy5GUkFNRSxcbiAgICBodG1sX2pzXzEuVEFHX05BTUVTLkhSLFxuICAgIGh0bWxfanNfMS5UQUdfTkFNRVMuSU1HLFxuICAgIGh0bWxfanNfMS5UQUdfTkFNRVMuSU5QVVQsXG4gICAgaHRtbF9qc18xLlRBR19OQU1FUy5LRVlHRU4sXG4gICAgaHRtbF9qc18xLlRBR19OQU1FUy5MSU5LLFxuICAgIGh0bWxfanNfMS5UQUdfTkFNRVMuTUVUQSxcbiAgICBodG1sX2pzXzEuVEFHX05BTUVTLlBBUkFNLFxuICAgIGh0bWxfanNfMS5UQUdfTkFNRVMuU09VUkNFLFxuICAgIGh0bWxfanNfMS5UQUdfTkFNRVMuVFJBQ0ssXG4gICAgaHRtbF9qc18xLlRBR19OQU1FUy5XQlIsXG5dKTtcbmZ1bmN0aW9uIGlzVm9pZEVsZW1lbnQobm9kZSwgb3B0aW9ucykge1xuICAgIHJldHVybiAob3B0aW9ucy50cmVlQWRhcHRlci5pc0VsZW1lbnROb2RlKG5vZGUpICYmXG4gICAgICAgIG9wdGlvbnMudHJlZUFkYXB0ZXIuZ2V0TmFtZXNwYWNlVVJJKG5vZGUpID09PSBodG1sX2pzXzEuTlMuSFRNTCAmJlxuICAgICAgICBWT0lEX0VMRU1FTlRTLmhhcyhvcHRpb25zLnRyZWVBZGFwdGVyLmdldFRhZ05hbWUobm9kZSkpKTtcbn1cbmNvbnN0IGRlZmF1bHRPcHRzID0geyB0cmVlQWRhcHRlcjogZGVmYXVsdF9qc18xLmRlZmF1bHRUcmVlQWRhcHRlciwgc2NyaXB0aW5nRW5hYmxlZDogdHJ1ZSB9O1xuLyoqXG4gKiBTZXJpYWxpemVzIGFuIEFTVCBub2RlIHRvIGFuIEhUTUwgc3RyaW5nLlxuICpcbiAqIEBleGFtcGxlXG4gKlxuICogYGBganNcbiAqIGNvbnN0IHBhcnNlNSA9IHJlcXVpcmUoJ3BhcnNlNScpO1xuICpcbiAqIGNvbnN0IGRvY3VtZW50ID0gcGFyc2U1LnBhcnNlKCc8IURPQ1RZUEUgaHRtbD48aHRtbD48aGVhZD48L2hlYWQ+PGJvZHk+SGkgdGhlcmUhPC9ib2R5PjwvaHRtbD4nKTtcbiAqXG4gKiAvLyBTZXJpYWxpemVzIGEgZG9jdW1lbnQuXG4gKiBjb25zdCBodG1sID0gcGFyc2U1LnNlcmlhbGl6ZShkb2N1bWVudCk7XG4gKlxuICogLy8gU2VyaWFsaXplcyB0aGUgPGh0bWw+IGVsZW1lbnQgY29udGVudC5cbiAqIGNvbnN0IHN0ciA9IHBhcnNlNS5zZXJpYWxpemUoZG9jdW1lbnQuY2hpbGROb2Rlc1sxXSk7XG4gKlxuICogY29uc29sZS5sb2coc3RyKTsgLy8+ICc8aGVhZD48L2hlYWQ+PGJvZHk+SGkgdGhlcmUhPC9ib2R5PidcbiAqIGBgYFxuICpcbiAqIEBwYXJhbSBub2RlIE5vZGUgdG8gc2VyaWFsaXplLlxuICogQHBhcmFtIG9wdGlvbnMgU2VyaWFsaXphdGlvbiBvcHRpb25zLlxuICovXG5mdW5jdGlvbiBzZXJpYWxpemUobm9kZSwgb3B0aW9ucykge1xuICAgIGNvbnN0IG9wdHMgPSBPYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oe30sIGRlZmF1bHRPcHRzKSwgb3B0aW9ucyk7XG4gICAgaWYgKGlzVm9pZEVsZW1lbnQobm9kZSwgb3B0cykpIHtcbiAgICAgICAgcmV0dXJuICcnO1xuICAgIH1cbiAgICByZXR1cm4gc2VyaWFsaXplQ2hpbGROb2Rlcyhub2RlLCBvcHRzKTtcbn1cbmV4cG9ydHMuc2VyaWFsaXplID0gc2VyaWFsaXplO1xuLyoqXG4gKiBTZXJpYWxpemVzIGFuIEFTVCBlbGVtZW50IG5vZGUgdG8gYW4gSFRNTCBzdHJpbmcsIGluY2x1ZGluZyB0aGUgZWxlbWVudCBub2RlLlxuICpcbiAqIEBleGFtcGxlXG4gKlxuICogYGBganNcbiAqIGNvbnN0IHBhcnNlNSA9IHJlcXVpcmUoJ3BhcnNlNScpO1xuICpcbiAqIGNvbnN0IGRvY3VtZW50ID0gcGFyc2U1LnBhcnNlRnJhZ21lbnQoJzxkaXY+SGVsbG8sIDxiPndvcmxkPC9iPiE8L2Rpdj4nKTtcbiAqXG4gKiAvLyBTZXJpYWxpemVzIHRoZSA8ZGl2PiBlbGVtZW50LlxuICogY29uc3QgaHRtbCA9IHBhcnNlNS5zZXJpYWxpemVPdXRlcihkb2N1bWVudC5jaGlsZE5vZGVzWzBdKTtcbiAqXG4gKiBjb25zb2xlLmxvZyhzdHIpOyAvLz4gJzxkaXY+SGVsbG8sIDxiPndvcmxkPC9iPiE8L2Rpdj4nXG4gKiBgYGBcbiAqXG4gKiBAcGFyYW0gbm9kZSBOb2RlIHRvIHNlcmlhbGl6ZS5cbiAqIEBwYXJhbSBvcHRpb25zIFNlcmlhbGl6YXRpb24gb3B0aW9ucy5cbiAqL1xuZnVuY3Rpb24gc2VyaWFsaXplT3V0ZXIobm9kZSwgb3B0aW9ucykge1xuICAgIGNvbnN0IG9wdHMgPSBPYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oe30sIGRlZmF1bHRPcHRzKSwgb3B0aW9ucyk7XG4gICAgcmV0dXJuIHNlcmlhbGl6ZU5vZGUobm9kZSwgb3B0cyk7XG59XG5leHBvcnRzLnNlcmlhbGl6ZU91dGVyID0gc2VyaWFsaXplT3V0ZXI7XG5mdW5jdGlvbiBzZXJpYWxpemVDaGlsZE5vZGVzKHBhcmVudE5vZGUsIG9wdGlvbnMpIHtcbiAgICBsZXQgaHRtbCA9ICcnO1xuICAgIC8vIEdldCBjb250YWluZXIgb2YgdGhlIGNoaWxkIG5vZGVzXG4gICAgY29uc3QgY29udGFpbmVyID0gb3B0aW9ucy50cmVlQWRhcHRlci5pc0VsZW1lbnROb2RlKHBhcmVudE5vZGUpICYmXG4gICAgICAgIG9wdGlvbnMudHJlZUFkYXB0ZXIuZ2V0VGFnTmFtZShwYXJlbnROb2RlKSA9PT0gaHRtbF9qc18xLlRBR19OQU1FUy5URU1QTEFURSAmJlxuICAgICAgICBvcHRpb25zLnRyZWVBZGFwdGVyLmdldE5hbWVzcGFjZVVSSShwYXJlbnROb2RlKSA9PT0gaHRtbF9qc18xLk5TLkhUTUxcbiAgICAgICAgPyBvcHRpb25zLnRyZWVBZGFwdGVyLmdldFRlbXBsYXRlQ29udGVudChwYXJlbnROb2RlKVxuICAgICAgICA6IHBhcmVudE5vZGU7XG4gICAgY29uc3QgY2hpbGROb2RlcyA9IG9wdGlvbnMudHJlZUFkYXB0ZXIuZ2V0Q2hpbGROb2Rlcyhjb250YWluZXIpO1xuICAgIGlmIChjaGlsZE5vZGVzKSB7XG4gICAgICAgIGZvciAoY29uc3QgY3VycmVudE5vZGUgb2YgY2hpbGROb2Rlcykge1xuICAgICAgICAgICAgaHRtbCArPSBzZXJpYWxpemVOb2RlKGN1cnJlbnROb2RlLCBvcHRpb25zKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gaHRtbDtcbn1cbmZ1bmN0aW9uIHNlcmlhbGl6ZU5vZGUobm9kZSwgb3B0aW9ucykge1xuICAgIGlmIChvcHRpb25zLnRyZWVBZGFwdGVyLmlzRWxlbWVudE5vZGUobm9kZSkpIHtcbiAgICAgICAgcmV0dXJuIHNlcmlhbGl6ZUVsZW1lbnQobm9kZSwgb3B0aW9ucyk7XG4gICAgfVxuICAgIGlmIChvcHRpb25zLnRyZWVBZGFwdGVyLmlzVGV4dE5vZGUobm9kZSkpIHtcbiAgICAgICAgcmV0dXJuIHNlcmlhbGl6ZVRleHROb2RlKG5vZGUsIG9wdGlvbnMpO1xuICAgIH1cbiAgICBpZiAob3B0aW9ucy50cmVlQWRhcHRlci5pc0NvbW1lbnROb2RlKG5vZGUpKSB7XG4gICAgICAgIHJldHVybiBzZXJpYWxpemVDb21tZW50Tm9kZShub2RlLCBvcHRpb25zKTtcbiAgICB9XG4gICAgaWYgKG9wdGlvbnMudHJlZUFkYXB0ZXIuaXNEb2N1bWVudFR5cGVOb2RlKG5vZGUpKSB7XG4gICAgICAgIHJldHVybiBzZXJpYWxpemVEb2N1bWVudFR5cGVOb2RlKG5vZGUsIG9wdGlvbnMpO1xuICAgIH1cbiAgICAvLyBSZXR1cm4gYW4gZW1wdHkgc3RyaW5nIGZvciB1bmtub3duIG5vZGVzXG4gICAgcmV0dXJuICcnO1xufVxuZnVuY3Rpb24gc2VyaWFsaXplRWxlbWVudChub2RlLCBvcHRpb25zKSB7XG4gICAgY29uc3QgdG4gPSBvcHRpb25zLnRyZWVBZGFwdGVyLmdldFRhZ05hbWUobm9kZSk7XG4gICAgcmV0dXJuIGA8JHt0bn0ke3NlcmlhbGl6ZUF0dHJpYnV0ZXMobm9kZSwgb3B0aW9ucyl9PiR7aXNWb2lkRWxlbWVudChub2RlLCBvcHRpb25zKSA/ICcnIDogYCR7c2VyaWFsaXplQ2hpbGROb2Rlcyhub2RlLCBvcHRpb25zKX08LyR7dG59PmB9YDtcbn1cbmZ1bmN0aW9uIHNlcmlhbGl6ZUF0dHJpYnV0ZXMobm9kZSwgeyB0cmVlQWRhcHRlciB9KSB7XG4gICAgbGV0IGh0bWwgPSAnJztcbiAgICBmb3IgKGNvbnN0IGF0dHIgb2YgdHJlZUFkYXB0ZXIuZ2V0QXR0ckxpc3Qobm9kZSkpIHtcbiAgICAgICAgaHRtbCArPSAnICc7XG4gICAgICAgIGlmICghYXR0ci5uYW1lc3BhY2UpIHtcbiAgICAgICAgICAgIGh0bWwgKz0gYXR0ci5uYW1lO1xuICAgICAgICB9XG4gICAgICAgIGVsc2VcbiAgICAgICAgICAgIHN3aXRjaCAoYXR0ci5uYW1lc3BhY2UpIHtcbiAgICAgICAgICAgICAgICBjYXNlIGh0bWxfanNfMS5OUy5YTUw6IHtcbiAgICAgICAgICAgICAgICAgICAgaHRtbCArPSBgeG1sOiR7YXR0ci5uYW1lfWA7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBjYXNlIGh0bWxfanNfMS5OUy5YTUxOUzoge1xuICAgICAgICAgICAgICAgICAgICBpZiAoYXR0ci5uYW1lICE9PSAneG1sbnMnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBodG1sICs9ICd4bWxuczonO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGh0bWwgKz0gYXR0ci5uYW1lO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgY2FzZSBodG1sX2pzXzEuTlMuWExJTks6IHtcbiAgICAgICAgICAgICAgICAgICAgaHRtbCArPSBgeGxpbms6JHthdHRyLm5hbWV9YDtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGRlZmF1bHQ6IHtcbiAgICAgICAgICAgICAgICAgICAgaHRtbCArPSBgJHthdHRyLnByZWZpeH06JHthdHRyLm5hbWV9YDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIGh0bWwgKz0gYD1cIiR7KDAsIGVzY2FwZV9qc18xLmVzY2FwZUF0dHJpYnV0ZSkoYXR0ci52YWx1ZSl9XCJgO1xuICAgIH1cbiAgICByZXR1cm4gaHRtbDtcbn1cbmZ1bmN0aW9uIHNlcmlhbGl6ZVRleHROb2RlKG5vZGUsIG9wdGlvbnMpIHtcbiAgICBjb25zdCB7IHRyZWVBZGFwdGVyIH0gPSBvcHRpb25zO1xuICAgIGNvbnN0IGNvbnRlbnQgPSB0cmVlQWRhcHRlci5nZXRUZXh0Tm9kZUNvbnRlbnQobm9kZSk7XG4gICAgY29uc3QgcGFyZW50ID0gdHJlZUFkYXB0ZXIuZ2V0UGFyZW50Tm9kZShub2RlKTtcbiAgICBjb25zdCBwYXJlbnRUbiA9IHBhcmVudCAmJiB0cmVlQWRhcHRlci5pc0VsZW1lbnROb2RlKHBhcmVudCkgJiYgdHJlZUFkYXB0ZXIuZ2V0VGFnTmFtZShwYXJlbnQpO1xuICAgIHJldHVybiBwYXJlbnRUbiAmJlxuICAgICAgICB0cmVlQWRhcHRlci5nZXROYW1lc3BhY2VVUkkocGFyZW50KSA9PT0gaHRtbF9qc18xLk5TLkhUTUwgJiZcbiAgICAgICAgKDAsIGh0bWxfanNfMS5oYXNVbmVzY2FwZWRUZXh0KShwYXJlbnRUbiwgb3B0aW9ucy5zY3JpcHRpbmdFbmFibGVkKVxuICAgICAgICA/IGNvbnRlbnRcbiAgICAgICAgOiAoMCwgZXNjYXBlX2pzXzEuZXNjYXBlVGV4dCkoY29udGVudCk7XG59XG5mdW5jdGlvbiBzZXJpYWxpemVDb21tZW50Tm9kZShub2RlLCB7IHRyZWVBZGFwdGVyIH0pIHtcbiAgICByZXR1cm4gYDwhLS0ke3RyZWVBZGFwdGVyLmdldENvbW1lbnROb2RlQ29udGVudChub2RlKX0tLT5gO1xufVxuZnVuY3Rpb24gc2VyaWFsaXplRG9jdW1lbnRUeXBlTm9kZShub2RlLCB7IHRyZWVBZGFwdGVyIH0pIHtcbiAgICByZXR1cm4gYDwhRE9DVFlQRSAke3RyZWVBZGFwdGVyLmdldERvY3VtZW50VHlwZU5vZGVOYW1lKG5vZGUpfT5gO1xufVxuLy8jIHNv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