997fb71d3f7bc66d9abd02ed1e75859e
"use strict";

var __createBinding = void 0 && (void 0).__createBinding || (Object.create ? function (o, m, k, k2) {
  if (k2 === undefined) k2 = k;
  var desc = Object.getOwnPropertyDescriptor(m, k);
  if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
    desc = {
      enumerable: true,
      get: function () {
        return m[k];
      }
    };
  }
  Object.defineProperty(o, k2, desc);
} : function (o, m, k, k2) {
  if (k2 === undefined) k2 = k;
  o[k2] = m[k];
});
var __exportStar = void 0 && (void 0).__exportStar || function (m, exports) {
  for (var p in m) if (p !== "default" && !Object.prototype.hasOwnProperty.call(exports, p)) __createBinding(exports, m, p);
};
Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.DomHandler = void 0;
var domelementtype_1 = require("domelementtype");
var node_js_1 = require("./node.js");
__exportStar(require("./node.js"), exports);
// Default options
var defaultOpts = {
  withStartIndices: false,
  withEndIndices: false,
  xmlMode: false
};
var DomHandler = /** @class */function () {
  /**
   * @param callback Called once parsing has completed.
   * @param options Settings for the handler.
   * @param elementCB Callback whenever a tag is closed.
   */
  function DomHandler(callback, options, elementCB) {
    /** The elements of the DOM */
    this.dom = [];
    /** The root element for the DOM */
    this.root = new node_js_1.Document(this.dom);
    /** Indicated whether parsing has been completed. */
    this.done = false;
    /** Stack of open tags. */
    this.tagStack = [this.root];
    /** A data node that is still being written to. */
    this.lastNode = null;
    /** Reference to the parser instance. Used for location information. */
    this.parser = null;
    // Make it possible to skip arguments, for backwards-compatibility
    if (typeof options === "function") {
      elementCB = options;
      options = defaultOpts;
    }
    if (typeof callback === "object") {
      options = callback;
      callback = undefined;
    }
    this.callback = callback !== null && callback !== void 0 ? callback : null;
    this.options = options !== null && options !== void 0 ? options : defaultOpts;
    this.elementCB = elementCB !== null && elementCB !== void 0 ? elementCB : null;
  }
  DomHandler.prototype.onparserinit = function (parser) {
    this.parser = parser;
  };
  // Resets the handler back to starting state
  DomHandler.prototype.onreset = function () {
    this.dom = [];
    this.root = new node_js_1.Document(this.dom);
    this.done = false;
    this.tagStack = [this.root];
    this.lastNode = null;
    this.parser = null;
  };
  // Signals the handler that parsing is done
  DomHandler.prototype.onend = function () {
    if (this.done) return;
    this.done = true;
    this.parser = null;
    this.handleCallback(null);
  };
  DomHandler.prototype.onerror = function (error) {
    this.handleCallback(error);
  };
  DomHandler.prototype.onclosetag = function () {
    this.lastNode = null;
    var elem = this.tagStack.pop();
    if (this.options.withEndIndices) {
      elem.endIndex = this.parser.endIndex;
    }
    if (this.elementCB) this.elementCB(elem);
  };
  DomHandler.prototype.onopentag = function (name, attribs) {
    var type = this.options.xmlMode ? domelementtype_1.ElementType.Tag : undefined;
    var element = new node_js_1.Element(name, attribs, undefined, type);
    this.addNode(element);
    this.tagStack.push(element);
  };
  DomHandler.prototype.ontext = function (data) {
    var lastNode = this.lastNode;
    if (lastNode && lastNode.type === domelementtype_1.ElementType.Text) {
      lastNode.data += data;
      if (this.options.withEndIndices) {
        lastNode.endIndex = this.parser.endIndex;
      }
    } else {
      var node = new node_js_1.Text(data);
      this.addNode(node);
      this.lastNode = node;
    }
  };
  DomHandler.prototype.oncomment = function (data) {
    if (this.lastNode && this.lastNode.type === domelementtype_1.ElementType.Comment) {
      this.lastNode.data += data;
      return;
    }
    var node = new node_js_1.Comment(data);
    this.addNode(node);
    this.lastNode = node;
  };
  DomHandler.prototype.oncommentend = function () {
    this.lastNode = null;
  };
  DomHandler.prototype.oncdatastart = function () {
    var text = new node_js_1.Text("");
    var node = new node_js_1.CDATA([text]);
    this.addNode(node);
    text.parent = node;
    this.lastNode = text;
  };
  DomHandler.prototype.oncdataend = function () {
    this.lastNode = null;
  };
  DomHandler.prototype.onprocessinginstruction = function (name, data) {
    var node = new node_js_1.ProcessingInstruction(name, data);
    this.addNode(node);
  };
  DomHandler.prototype.handleCallback = function (error) {
    if (typeof this.callback === "function") {
      this.callback(error, this.dom);
    } else if (error) {
      throw error;
    }
  };
  DomHandler.prototype.addNode = function (node) {
    var parent = this.tagStack[this.tagStack.length - 1];
    var previousSibling = parent.children[parent.children.length - 1];
    if (this.options.withStartIndices) {
      node.startIndex = this.parser.startIndex;
    }
    if (this.options.withEndIndices) {
      node.endIndex = this.parser.endIndex;
    }
    parent.children.push(node);
    if (previousSibling) {
      node.prev = previousSibling;
      previousSibling.next = node;
    }
    node.parent = parent;
    this.lastNode = null;
  };
  return DomHandler;
}();
exports.DomHandler = DomHandler;
exports.default = DomHandler;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfX2NyZWF0ZUJpbmRpbmciLCJPYmplY3QiLCJjcmVhdGUiLCJvIiwibSIsImsiLCJrMiIsInVuZGVmaW5lZCIsImRlc2MiLCJnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IiLCJfX2VzTW9kdWxlIiwid3JpdGFibGUiLCJjb25maWd1cmFibGUiLCJlbnVtZXJhYmxlIiwiZ2V0IiwiZGVmaW5lUHJvcGVydHkiLCJfX2V4cG9ydFN0YXIiLCJleHBvcnRzIiwicCIsInByb3RvdHlwZSIsImhhc093blByb3BlcnR5IiwiY2FsbCIsInZhbHVlIiwiRG9tSGFuZGxlciIsImRvbWVsZW1lbnR0eXBlXzEiLCJyZXF1aXJlIiwibm9kZV9qc18xIiwiZGVmYXVsdE9wdHMiLCJ3aXRoU3RhcnRJbmRpY2VzIiwid2l0aEVuZEluZGljZXMiLCJ4bWxNb2RlIiwiY2FsbGJhY2siLCJvcHRpb25zIiwiZWxlbWVudENCIiwiZG9tIiwicm9vdCIsIkRvY3VtZW50IiwiZG9uZSIsInRhZ1N0YWNrIiwibGFzdE5vZGUiLCJwYXJzZXIiLCJvbnBhcnNlcmluaXQiLCJvbnJlc2V0Iiwib25lbmQiLCJoYW5kbGVDYWxsYmFjayIsIm9uZXJyb3IiLCJlcnJvciIsIm9uY2xvc2V0YWciLCJlbGVtIiwicG9wIiwiZW5kSW5kZXgiLCJvbm9wZW50YWciLCJuYW1lIiwiYXR0cmlicyIsInR5cGUiLCJFbGVtZW50VHlwZSIsIlRhZyIsImVsZW1lbnQiLCJFbGVtZW50IiwiYWRkTm9kZSIsInB1c2giLCJvbnRleHQiLCJkYXRhIiwiVGV4dCIsIm5vZGUiLCJvbmNvbW1lbnQiLCJDb21tZW50Iiwib25jb21tZW50ZW5kIiwib25jZGF0YXN0YXJ0IiwidGV4dCIsIkNEQVRBIiwicGFyZW50Iiwib25jZGF0YWVuZCIsIm9ucHJvY2Vzc2luZ2luc3RydWN0aW9uIiwiUHJvY2Vzc2luZ0luc3RydWN0aW9uIiwibGVuZ3RoIiwicHJldmlvdXNTaWJsaW5nIiwiY2hpbGRyZW4iLCJzdGFydEluZGV4IiwicHJldiIsIm5leHQiLCJkZWZhdWx0Il0sInNvdXJjZXMiOlsiaW5kZXguanMiXSwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgX19jcmVhdGVCaW5kaW5nID0gKHRoaXMgJiYgdGhpcy5fX2NyZWF0ZUJpbmRpbmcpIHx8IChPYmplY3QuY3JlYXRlID8gKGZ1bmN0aW9uKG8sIG0sIGssIGsyKSB7XG4gICAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gaztcbiAgICB2YXIgZGVzYyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IobSwgayk7XG4gICAgaWYgKCFkZXNjIHx8IChcImdldFwiIGluIGRlc2MgPyAhbS5fX2VzTW9kdWxlIDogZGVzYy53cml0YWJsZSB8fCBkZXNjLmNvbmZpZ3VyYWJsZSkpIHtcbiAgICAgIGRlc2MgPSB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24oKSB7IHJldHVybiBtW2tdOyB9IH07XG4gICAgfVxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvLCBrMiwgZGVzYyk7XG59KSA6IChmdW5jdGlvbihvLCBtLCBrLCBrMikge1xuICAgIGlmIChrMiA9PT0gdW5kZWZpbmVkKSBrMiA9IGs7XG4gICAgb1trMl0gPSBtW2tdO1xufSkpO1xudmFyIF9fZXhwb3J0U3RhciA9ICh0aGlzICYmIHRoaXMuX19leHBvcnRTdGFyKSB8fCBmdW5jdGlvbihtLCBleHBvcnRzKSB7XG4gICAgZm9yICh2YXIgcCBpbiBtKSBpZiAocCAhPT0gXCJkZWZhdWx0XCIgJiYgIU9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChleHBvcnRzLCBwKSkgX19jcmVhdGVCaW5kaW5nKGV4cG9ydHMsIG0sIHApO1xufTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuRG9tSGFuZGxlciA9IHZvaWQgMDtcbnZhciBkb21lbGVtZW50dHlwZV8xID0gcmVxdWlyZShcImRvbWVsZW1lbnR0eXBlXCIpO1xudmFyIG5vZGVfanNfMSA9IHJlcXVpcmUoXCIuL25vZGUuanNcIik7XG5fX2V4cG9ydFN0YXIocmVxdWlyZShcIi4vbm9kZS5qc1wiKSwgZXhwb3J0cyk7XG4vLyBEZWZhdWx0IG9wdGlvbnNcbnZhciBkZWZhdWx0T3B0cyA9IHtcbiAgICB3aXRoU3RhcnRJbmRpY2VzOiBmYWxzZSxcbiAgICB3aXRoRW5kSW5kaWNlczogZmFsc2UsXG4gICAgeG1sTW9kZTogZmFsc2UsXG59O1xudmFyIERvbUhhbmRsZXIgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7XG4gICAgLyoqXG4gICAgICogQHBhcmFtIGNhbGxiYWNrIENhbGxlZCBvbmNlIHBhcnNpbmcgaGFzIGNvbXBsZXRlZC5cbiAgICAgKiBAcGFyYW0gb3B0aW9ucyBTZXR0aW5ncyBmb3IgdGhlIGhhbmRsZXIuXG4gICAgICogQHBhcmFtIGVsZW1lbnRDQiBDYWxsYmFjayB3aGVuZXZlciBhIHRhZyBpcyBjbG9zZWQuXG4gICAgICovXG4gICAgZnVuY3Rpb24gRG9tSGFuZGxlcihjYWxsYmFjaywgb3B0aW9ucywgZWxlbWVudENCKSB7XG4gICAgICAgIC8qKiBUaGUgZWxlbWVudHMgb2YgdGhlIERPTSAqL1xuICAgICAgICB0aGlzLmRvbSA9IFtdO1xuICAgICAgICAvKiogVGhlIHJvb3QgZWxlbWVudCBmb3IgdGhlIERPTSAqL1xuICAgICAgICB0aGlzLnJvb3QgPSBuZXcgbm9kZV9qc18xLkRvY3VtZW50KHRoaXMuZG9tKTtcbiAgICAgICAgLyoqIEluZGljYXRlZCB3aGV0aGVyIHBhcnNpbmcgaGFzIGJlZW4gY29tcGxldGVkLiAqL1xuICAgICAgICB0aGlzLmRvbmUgPSBmYWxzZTtcbiAgICAgICAgLyoqIFN0YWNrIG9mIG9wZW4gdGFncy4gKi9cbiAgICAgICAgdGhpcy50YWdTdGFjayA9IFt0aGlzLnJvb3RdO1xuICAgICAgICAvKiogQSBkYXRhIG5vZGUgdGhhdCBpcyBzdGlsbCBiZWluZyB3cml0dGVuIHRvLiAqL1xuICAgICAgICB0aGlzLmxhc3ROb2RlID0gbnVsbDtcbiAgICAgICAgLyoqIFJlZmVyZW5jZSB0byB0aGUgcGFyc2VyIGluc3RhbmNlLiBVc2VkIGZvciBsb2NhdGlvbiBpbmZvcm1hdGlvbi4gKi9cbiAgICAgICAgdGhpcy5wYXJzZXIgPSBudWxsO1xuICAgICAgICAvLyBNYWtlIGl0IHBvc3NpYmxlIHRvIHNraXAgYXJndW1lbnRzLCBmb3IgYmFja3dhcmRzLWNvbXBhdGliaWxpdHlcbiAgICAgICAgaWYgKHR5cGVvZiBvcHRpb25zID09PSBcImZ1bmN0aW9uXCIpIHtcbiAgICAgICAgICAgIGVsZW1lbnRDQiA9IG9wdGlvbnM7XG4gICAgICAgICAgICBvcHRpb25zID0gZGVmYXVsdE9wdHM7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHR5cGVvZiBjYWxsYmFjayA9PT0gXCJvYmplY3RcIikge1xuICAgICAgICAgICAgb3B0aW9ucyA9IGNhbGxiYWNrO1xuICAgICAgICAgICAgY2FsbGJhY2sgPSB1bmRlZmluZWQ7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5jYWxsYmFjayA9IGNhbGxiYWNrICE9PSBudWxsICYmIGNhbGxiYWNrICE9PSB2b2lkIDAgPyBjYWxsYmFjayA6IG51bGw7XG4gICAgICAgIHRoaXMub3B0aW9ucyA9IG9wdGlvbnMgIT09IG51bGwgJiYgb3B0aW9ucyAhPT0gdm9pZCAwID8gb3B0aW9ucyA6IGRlZmF1bHRPcHRzO1xuICAgICAgICB0aGlzLmVsZW1lbnRDQiA9IGVsZW1lbnRDQiAhPT0gbnVsbCAmJiBlbGVtZW50Q0IgIT09IHZvaWQgMCA/IGVsZW1lbnRDQiA6IG51bGw7XG4gICAgfVxuICAgIERvbUhhbmRsZXIucHJvdG90eXBlLm9ucGFyc2VyaW5pdCA9IGZ1bmN0aW9uIChwYXJzZXIpIHtcbiAgICAgICAgdGhpcy5wYXJzZXIgPSBwYXJzZXI7XG4gICAgfTtcbiAgICAvLyBSZXNldHMgdGhlIGhhbmRsZXIgYmFjayB0byBzdGFydGluZyBzdGF0ZVxuICAgIERvbUhhbmRsZXIucHJvdG90eXBlLm9ucmVzZXQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuZG9tID0gW107XG4gICAgICAgIHRoaXMucm9vdCA9IG5ldyBub2RlX2pzXzEuRG9jdW1lbnQodGhpcy5kb20pO1xuICAgICAgICB0aGlzLmRvbmUgPSBmYWxzZTtcbiAgICAgICAgdGhpcy50YWdTdGFjayA9IFt0aGlzLnJvb3RdO1xuICAgICAgICB0aGlzLmxhc3ROb2RlID0gbnVsbDtcbiAgICAgICAgdGhpcy5wYXJzZXIgPSBudWxsO1xuICAgIH07XG4gICAgLy8gU2lnbmFscyB0aGUgaGFuZGxlciB0aGF0IHBhcnNpbmcgaXMgZG9uZVxuICAgIERvbUhhbmRsZXIucHJvdG90eXBlLm9uZW5kID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAodGhpcy5kb25lKVxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB0aGlzLmRvbmUgPSB0cnVlO1xuICAgICAgICB0aGlzLnBhcnNlciA9IG51bGw7XG4gICAgICAgIHRoaXMuaGFuZGxlQ2FsbGJhY2sobnVsbCk7XG4gICAgfTtcbiAgICBEb21IYW5kbGVyLnByb3RvdHlwZS5vbmVycm9yID0gZnVuY3Rpb24gKGVycm9yKSB7XG4gICAgICAgIHRoaXMuaGFuZGxlQ2FsbGJhY2soZXJyb3IpO1xuICAgIH07XG4gICAgRG9tSGFuZGxlci5wcm90b3R5cGUub25jbG9zZXRhZyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5sYXN0Tm9kZSA9IG51bGw7XG4gICAgICAgIHZhciBlbGVtID0gdGhpcy50YWdTdGFjay5wb3AoKTtcbiAgICAgICAgaWYgKHRoaXMub3B0aW9ucy53aXRoRW5kSW5kaWNlcykge1xuICAgICAgICAgICAgZWxlbS5lbmRJbmRleCA9IHRoaXMucGFyc2VyLmVuZEluZGV4O1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLmVsZW1lbnRDQilcbiAgICAgICAgICAgIHRoaXMuZWxlbWVudENCKGVsZW0pO1xuICAgIH07XG4gICAgRG9tSGFuZGxlci5wcm90b3R5cGUub25vcGVudGFnID0gZnVuY3Rpb24gKG5hbWUsIGF0dHJpYnMpIHtcbiAgICAgICAgdmFyIHR5cGUgPSB0aGlzLm9wdGlvbnMueG1sTW9kZSA/IGRvbWVsZW1lbnR0eXBlXzEuRWxlbWVudFR5cGUuVGFnIDogdW5kZWZpbmVkO1xuICAgICAgICB2YXIgZWxlbWVudCA9IG5ldyBub2RlX2pzXzEuRWxlbWVudChuYW1lLCBhdHRyaWJzLCB1bmRlZmluZWQsIHR5cGUpO1xuICAgICAgICB0aGlzLmFkZE5vZGUoZWxlbWVudCk7XG4gICAgICAgIHRoaXMudGFnU3RhY2sucHVzaChlbGVtZW50KTtcbiAgICB9O1xuICAgIERvbUhhbmRsZXIucHJvdG90eXBlLm9udGV4dCA9IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgIHZhciBsYXN0Tm9kZSA9IHRoaXMubGFzdE5vZGU7XG4gICAgICAgIGlmIChsYXN0Tm9kZSAmJiBsYXN0Tm9kZS50eXBlID09PSBkb21lbGVtZW50dHlwZV8xLkVsZW1lbnRUeXBlLlRleHQpIHtcbiAgICAgICAgICAgIGxhc3ROb2RlLmRhdGEgKz0gZGF0YTtcbiAgICAgICAgICAgIGlmICh0aGlzLm9wdGlvbnMud2l0aEVuZEluZGljZXMpIHtcbiAgICAgICAgICAgICAgICBsYXN0Tm9kZS5lbmRJbmRleCA9IHRoaXMucGFyc2VyLmVuZEluZGV4O1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgdmFyIG5vZGUgPSBuZXcgbm9kZV9qc18xLlRleHQoZGF0YSk7XG4gICAgICAgICAgICB0aGlzLmFkZE5vZGUobm9kZSk7XG4gICAgICAgICAgICB0aGlzLmxhc3ROb2RlID0gbm9kZTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgRG9tSGFuZGxlci5wcm90b3R5cGUub25jb21tZW50ID0gZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgaWYgKHRoaXMubGFzdE5vZGUgJiYgdGhpcy5sYXN0Tm9kZS50eXBlID09PSBkb21lbGVtZW50dHlwZV8xLkVsZW1lbnRUeXBlLkNvbW1lbnQpIHtcbiAgICAgICAgICAgIHRoaXMubGFzdE5vZGUuZGF0YSArPSBkYXRhO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHZhciBub2RlID0gbmV3IG5vZGVfanNfMS5Db21tZW50KGRhdGEpO1xuICAgICAgICB0aGlzLmFkZE5vZGUobm9kZSk7XG4gICAgICAgIHRoaXMubGFzdE5vZGUgPSBub2RlO1xuICAgIH07XG4gICAgRG9tSGFuZGxlci5wcm90b3R5cGUub25jb21tZW50ZW5kID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLmxhc3ROb2RlID0gbnVsbDtcbiAgICB9O1xuICAgIERvbUhhbmRsZXIucHJvdG90eXBlLm9uY2RhdGFzdGFydCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIHRleHQgPSBuZXcgbm9kZV9qc18xLlRleHQoXCJcIik7XG4gICAgICAgIHZhciBub2RlID0gbmV3IG5vZGVfanNfMS5DREFUQShbdGV4dF0pO1xuICAgICAgICB0aGlzLmFkZE5vZGUobm9kZSk7XG4gICAgICAgIHRleHQucGFyZW50ID0gbm9kZTtcbiAgICAgICAgdGhpcy5sYXN0Tm9kZSA9IHRleHQ7XG4gICAgfTtcbiAgICBEb21IYW5kbGVyLnByb3RvdHlwZS5vbmNkYXRhZW5kID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLmxhc3ROb2RlID0gbnVsbDtcbiAgICB9O1xuICAgIERvbUhhbmRsZXIucHJvdG90eXBlLm9ucHJvY2Vzc2luZ2luc3RydWN0aW9uID0gZnVuY3Rpb24gKG5hbWUsIGRhdGEpIHtcbiAgICAgICAgdmFyIG5vZGUgPSBuZXcgbm9kZV9qc18xLlByb2Nlc3NpbmdJbnN0cnVjdGlvbihuYW1lLCBkYXRhKTtcbiAgICAgICAgdGhpcy5hZGROb2RlKG5vZGUpO1xuICAgIH07XG4gICAgRG9tSGFuZGxlci5wcm90b3R5cGUuaGFuZGxlQ2FsbGJhY2sgPSBmdW5jdGlvbiAoZXJyb3IpIHtcbiAgICAgICAgaWYgKHR5cGVvZiB0aGlzLmNhbGxiYWNrID09PSBcImZ1bmN0aW9uXCIpIHtcbiAgICAgICAgICAgIHRoaXMuY2FsbGJhY2soZXJyb3IsIHRoaXMuZG9tKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChlcnJvcikge1xuICAgICAgICAgICAgdGhyb3cgZXJyb3I7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIERvbUhhbmRsZXIucHJvdG90eXBlLmFkZE5vZGUgPSBmdW5jdGlvbiAobm9kZSkge1xuICAgICAgICB2YXIgcGFyZW50ID0gdGhpcy50YWdTdGFja1t0aGlzLnRhZ1N0YWNrLmxlbmd0aCAtIDFdO1xuICAgICAgICB2YXIgcHJldmlvdXNTaWJsaW5nID0gcGFyZW50LmNoaWxkcmVuW3BhcmVudC5jaGlsZHJlbi5sZW5ndGggLSAxXTtcbiAgICAgICAgaWYgKHRoaXMub3B0aW9ucy53aXRoU3RhcnRJbmRpY2VzKSB7XG4gICAgICAgICAgICBub2RlLnN0YXJ0SW5kZXggPSB0aGlzLnBhcnNlci5zdGFydEluZGV4O1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLm9wdGlvbnMud2l0aEVuZEluZGljZXMpIHtcbiAgICAgICAgICAgIG5vZGUuZW5kSW5kZXggPSB0aGlzLnBhcnNlci5lbmRJbmRleDtcbiAgICAgICAgfVxuICAgICAgICBwYXJlbnQuY2hpbGRyZW4ucHVzaChub2RlKTtcbiAgICAgICAgaWYgKHByZXZpb3VzU2libGluZykge1xuICAgICAgICAgICAgbm9kZS5wcmV2ID0gcHJldmlvdXNTaWJsaW5nO1xuICAgICAgICAgICAgcHJldmlvdXNTaWJsaW5nLm5leHQgPSBub2RlO1xuICAgICAgICB9XG4gICAgICAgIG5vZGUucGFyZW50ID0gcGFyZW50O1xuICAgICAgICB0aGlzLmxhc3ROb2RlID0gbnVsbDtcbiAgICB9O1xuICAgIHJldHVybiBEb21IYW5kbGVyO1xufSgpKTtcbmV4cG9ydHMuRG9tSGFuZGxlciA9IERvbUhhbmRsZXI7XG5leHBvcnRzLmRlZmF1bHQgPSBEb21IYW5kbGVyO1xuIl0sIm1hcHBpbmdzIjoiQUFBQSxZQUFZOztBQUNaLElBQUlBLGVBQWUsR0FBSSxVQUFRLFNBQUtBLGVBQWUsS0FBTUMsTUFBTSxDQUFDQyxNQUFNLEdBQUksVUFBU0MsQ0FBQyxFQUFFQyxDQUFDLEVBQUVDLENBQUMsRUFBRUMsRUFBRSxFQUFFO0VBQzVGLElBQUlBLEVBQUUsS0FBS0MsU0FBUyxFQUFFRCxFQUFFLEdBQUdELENBQUM7RUFDNUIsSUFBSUcsSUFBSSxHQUFHUCxNQUFNLENBQUNRLHdCQUF3QixDQUFDTCxDQUFDLEVBQUVDLENBQUMsQ0FBQztFQUNoRCxJQUFJLENBQUNHLElBQUksS0FBSyxLQUFLLElBQUlBLElBQUksR0FBRyxDQUFDSixDQUFDLENBQUNNLFVBQVUsR0FBR0YsSUFBSSxDQUFDRyxRQUFRLElBQUlILElBQUksQ0FBQ0ksWUFBWSxDQUFDLEVBQUU7SUFDakZKLElBQUksR0FBRztNQUFFSyxVQUFVLEVBQUUsSUFBSTtNQUFFQyxHQUFHLEVBQUUsU0FBQUEsQ0FBQSxFQUFXO1FBQUUsT0FBT1YsQ0FBQyxDQUFDQyxDQUFDLENBQUM7TUFBRTtJQUFFLENBQUM7RUFDL0Q7RUFDQUosTUFBTSxDQUFDYyxjQUFjLENBQUNaLENBQUMsRUFBRUcsRUFBRSxFQUFFRSxJQUFJLENBQUM7QUFDdEMsQ0FBQyxHQUFLLFVBQVNMLENBQUMsRUFBRUMsQ0FBQyxFQUFFQyxDQUFDLEVBQUVDLEVBQUUsRUFBRTtFQUN4QixJQUFJQSxFQUFFLEtBQUtDLFNBQVMsRUFBRUQsRUFBRSxHQUFHRCxDQUFDO0VBQzVCRixDQUFDLENBQUNHLEVBQUUsQ0FBQyxHQUFHRixDQUFDLENBQUNDLENBQUMsQ0FBQztBQUNoQixDQUFFLENBQUM7QUFDSCxJQUFJVyxZQUFZLEdBQUksVUFBUSxTQUFLQSxZQUFZLElBQUssVUFBU1osQ0FBQyxFQUFFYSxPQUFPLEVBQUU7RUFDbkUsS0FBSyxJQUFJQyxDQUFD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