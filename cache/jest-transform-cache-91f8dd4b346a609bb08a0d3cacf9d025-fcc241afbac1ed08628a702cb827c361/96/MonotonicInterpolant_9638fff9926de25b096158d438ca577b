c1bfe97d8ae6cc5b2f1f081be346dc60
"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.MonotonicInterpolant = void 0;
class MonotonicInterpolant {
  interpolate(x) {
    const {
      xs,
      ys,
      c1s,
      c2s,
      c3s
    } = this;
    // The rightmost point in the dataset should give an exact result
    let i = xs.length - 1;
    if (x === xs[i]) {
      return ys[i];
    }
    // Search for the interval x is in, returning the corresponding y if x is one of the original xs
    let low = 0;
    let high = c3s.length - 1;
    let mid;
    while (low <= high) {
      mid = Math.floor(0.5 * (low + high));
      const xHere = xs[mid];
      if (xHere < x) {
        low = mid + 1;
      } else if (xHere > x) {
        high = mid - 1;
      } else {
        return ys[mid];
      }
    }
    i = Math.max(0, high);
    // Interpolate
    const diff = x - xs[i];
    const diffSq = diff * diff;
    return ys[i] + c1s[i] * diff + c2s[i] * diffSq + c3s[i] * diff * diffSq;
  }
  constructor(xs, ys) {
    const {
      length
    } = xs;
    // Rearrange xs and ys so that xs is sorted
    const indexes = [];
    for (let i = 0; i < length; i++) {
      indexes.push(i);
    }
    indexes.sort((a, b) => xs[a] < xs[b] ? -1 : 1);
    // Get consecutive differences and slopes
    const dys = [];
    const dxs = [];
    const ms = [];
    let dx;
    let dy;
    for (let i1 = 0; i1 < length - 1; i1++) {
      dx = xs[i1 + 1] - xs[i1];
      dy = ys[i1 + 1] - ys[i1];
      dxs.push(dx);
      dys.push(dy);
      ms.push(dy / dx);
    }
    // Get degree-1 coefficients
    const c1s = [ms[0]];
    for (let i2 = 0; i2 < dxs.length - 1; i2++) {
      const m2 = ms[i2];
      const mNext = ms[i2 + 1];
      if (m2 * mNext <= 0) {
        c1s.push(0);
      } else {
        dx = dxs[i2];
        const dxNext = dxs[i2 + 1];
        const common = dx + dxNext;
        c1s.push(3 * common / ((common + dxNext) / m2 + (common + dx) / mNext));
      }
    }
    c1s.push(ms[ms.length - 1]);
    // Get degree-2 and degree-3 coefficients
    const c2s = [];
    const c3s = [];
    let m;
    for (let i3 = 0; i3 < c1s.length - 1; i3++) {
      m = ms[i3];
      const c1 = c1s[i3];
      const invDx = 1 / dxs[i3];
      const common = c1 + c1s[i3 + 1] - m - m;
      c2s.push((m - c1 - common) * invDx);
      c3s.push(common * invDx * invDx);
    }
    this.xs = xs;
    this.ys = ys;
    this.c1s = c1s;
    this.c2s = c2s;
    this.c3s = c3s;
  }
}
exports.MonotonicInterpolant = MonotonicInterpolant;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJNb25vdG9uaWNJbnRlcnBvbGFudCIsImludGVycG9sYXRlIiwieCIsInhzIiwieXMiLCJjMXMiLCJjMnMiLCJjM3MiLCJpIiwibGVuZ3RoIiwibG93IiwiaGlnaCIsIm1pZCIsIk1hdGgiLCJmbG9vciIsInhIZXJlIiwibWF4IiwiZGlmZiIsImRpZmZTcSIsImNvbnN0cnVjdG9yIiwiaW5kZXhlcyIsInB1c2giLCJzb3J0IiwiYSIsImIiLCJkeXMiLCJkeHMiLCJtcyIsImR4IiwiZHkiLCJpMSIsImkyIiwibTIiLCJtTmV4dCIsImR4TmV4dCIsImNvbW1vbiIsIm0iLCJpMyIsImMxIiwiaW52RHgiLCJleHBvcnRzIl0sInNvdXJjZXMiOlsiLi4vc3JjL01vbm90b25pY0ludGVycG9sYW50LnRzIl0sInNvdXJjZXNDb250ZW50IjpbImV4cG9ydCBjbGFzcyBNb25vdG9uaWNJbnRlcnBvbGFudCB7XG5cdHByaXZhdGUgeHM6IGFueVxuXHRwcml2YXRlIHlzOiBhbnlcblx0cHJpdmF0ZSBjMXM6IGFueVxuXHRwcml2YXRlIGMyczogYW55XG5cdHByaXZhdGUgYzNzOiBhbnlcblxuXHRwdWJsaWMgY29uc3RydWN0b3IoeHM6IG51bWJlcltdLCB5czogbnVtYmVyW10pIHtcblx0XHRjb25zdCB7IGxlbmd0aCB9ID0geHNcblxuXHRcdC8vIFJlYXJyYW5nZSB4cyBhbmQgeXMgc28gdGhhdCB4cyBpcyBzb3J0ZWRcblx0XHRjb25zdCBpbmRleGVzID0gW11cblx0XHRmb3IgKGxldCBpID0gMDsgaSA8IGxlbmd0aDsgaSsrKSB7XG5cdFx0XHRpbmRleGVzLnB1c2goaSlcblx0XHR9XG5cdFx0aW5kZXhlcy5zb3J0KChhLCBiKSA9PiAoKHhzW2FdIGFzIG51bWJlcikgPCAoeHNbYl0gYXMgbnVtYmVyKSA/IC0xIDogMSkpXG5cblx0XHQvLyBHZXQgY29uc2VjdXRpdmUgZGlmZmVyZW5jZXMgYW5kIHNsb3Blc1xuXHRcdGNvbnN0IGR5cyA9IFtdXG5cdFx0Y29uc3QgZHhzID0gW11cblx0XHRjb25zdCBtcyA9IFtdXG5cdFx0bGV0IGR4XG5cdFx0bGV0IGR5XG5cdFx0Zm9yIChsZXQgaSA9IDA7IGkgPCBsZW5ndGggLSAxOyBpKyspIHtcblx0XHRcdGR4ID0gKHhzW2kgKyAxXSBhcyBudW1iZXIpIC0gKHhzW2ldIGFzIG51bWJlcilcblx0XHRcdGR5ID0gKHlzW2kgKyAxXSBhcyBudW1iZXIpIC0gKHlzW2ldIGFzIG51bWJlcilcblx0XHRcdGR4cy5wdXNoKGR4KVxuXHRcdFx0ZHlzLnB1c2goZHkpXG5cdFx0XHRtcy5wdXNoKGR5IC8gZHgpXG5cdFx0fVxuXG5cdFx0Ly8gR2V0IGRlZ3JlZS0xIGNvZWZmaWNpZW50c1xuXHRcdGNvbnN0IGMxcyA9IFttc1swXV1cblx0XHRmb3IgKGxldCBpID0gMDsgaSA8IGR4cy5sZW5ndGggLSAxOyBpKyspIHtcblx0XHRcdGNvbnN0IG0yID0gbXNbaV0gYXMgbnVtYmVyXG5cdFx0XHRjb25zdCBtTmV4dCA9IG1zW2kgKyAxXSBhcyBudW1iZXJcblx0XHRcdGlmIChtMiAqIG1OZXh0IDw9IDApIHtcblx0XHRcdFx0YzFzLnB1c2goMClcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdGR4ID0gZHhzW2ldIGFzIG51bWJlclxuXHRcdFx0XHRjb25zdCBkeE5leHQgPSBkeHNbaSArIDFdIGFzIG51bWJlclxuXHRcdFx0XHRjb25zdCBjb21tb24gPSBkeCArIGR4TmV4dFxuXHRcdFx0XHRjMXMucHVzaChcblx0XHRcdFx0XHQoMyAqIGNvbW1vbikgLyAoKGNvbW1vbiArIGR4TmV4dCkgLyBtMiArIChjb21tb24gKyBkeCkgLyBtTmV4dCksXG5cdFx0XHRcdClcblx0XHRcdH1cblx0XHR9XG5cdFx0YzFzLnB1c2gobXNbbXMubGVuZ3RoIC0gMV0pXG5cblx0XHQvLyBHZXQgZGVncmVlLTIgYW5kIGRlZ3JlZS0zIGNvZWZmaWNpZW50c1xuXHRcdGNvbnN0IGMycyA9IFtdXG5cdFx0Y29uc3QgYzNzID0gW11cblx0XHRsZXQgbVxuXHRcdGZvciAobGV0IGkgPSAwOyBpIDwgYzFzLmxlbmd0aCAtIDE7IGkrKykge1xuXHRcdFx0bSA9IG1zW2ldIGFzIG51bWJlclxuXHRcdFx0Y29uc3QgYzEgPSBjMXNbaV0gYXMgbnVtYmVyXG5cdFx0XHRjb25zdCBpbnZEeCA9IDEgLyAoZHhzW2ldIGFzIG51bWJlcilcblx0XHRcdGNvbnN0IGNvbW1vbiA9IGMxICsgKGMxc1tpICsgMV0gYXMgbnVtYmVyKSAtIG0gLSBtXG5cdFx0XHRjMnMucHVzaCgobSAtIGMxIC0gY29tbW9uKSAqIGludkR4KVxuXHRcdFx0YzNzLnB1c2goY29tbW9uICogaW52RHggKiBpbnZEeClcblx0XHR9XG5cblx0XHR0aGlzLnhzID0geHNcblx0XHR0aGlzLnlzID0geXNcblx0XHR0aGlzLmMxcyA9IGMxc1xuXHRcdHRoaXMuYzJzID0gYzJzXG5cdFx0dGhpcy5jM3MgPSBjM3Ncblx0fVxuXG5cdHB1YmxpYyBpbnRlcnBvbGF0ZSh4OiBudW1iZXIpOiBudW1iZXIge1xuXHRcdGNvbnN0IHsgeHMsIHlzLCBjMXMsIGMycywgYzNzIH0gPSB0aGlzXG5cblx0XHQvLyBUaGUgcmlnaHRtb3N0IHBvaW50IGluIHRoZSBkYXRhc2V0IHNob3VsZCBnaXZlIGFuIGV4YWN0IHJlc3VsdFxuXHRcdGxldCBpID0geHMubGVuZ3RoIC0gMVxuXHRcdGlmICh4ID09PSB4c1tpXSkge1xuXHRcdFx0cmV0dXJuIHlzW2ldXG5cdFx0fVxuXG5cdFx0Ly8gU2VhcmNoIGZvciB0aGUgaW50ZXJ2YWwgeCBpcyBpbiwgcmV0dXJuaW5nIHRoZSBjb3JyZXNwb25kaW5nIHkgaWYgeCBpcyBvbmUgb2YgdGhlIG9yaWdpbmFsIHhzXG5cdFx0bGV0IGxvdyA9IDBcblx0XHRsZXQgaGlnaCA9IGMzcy5sZW5ndGggLSAxXG5cdFx0bGV0IG1pZFxuXHRcdHdoaWxlIChsb3cgPD0gaGlnaCkge1xuXHRcdFx0bWlkID0gTWF0aC5mbG9vcigwLjUgKiAobG93ICsgaGlnaCkpXG5cdFx0XHRjb25zdCB4SGVyZSA9IHhzW21pZF1cblx0XHRcdGlmICh4SGVyZSA8IHgpIHtcblx0XHRcdFx0bG93ID0gbWlkICsgMVxuXHRcdFx0fSBlbHNlIGlmICh4SGVyZSA+IHgpIHtcblx0XHRcdFx0aGlnaCA9IG1pZCAtIDFcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHJldHVybiB5c1ttaWRdXG5cdFx0XHR9XG5cdFx0fVxuXHRcdGkgPSBNYXRoLm1heCgwLCBoaWdoKVxuXG5cdFx0Ly8gSW50ZXJwb2xhdGVcblx0XHRjb25zdCBkaWZmID0geCAtIHhzW2ldXG5cdFx0Y29uc3QgZGlmZlNxID0gZGlmZiAqIGRpZmZcblx0XHRyZXR1cm4geXNbaV0gKyBjMXNbaV0gKiBkaWZmICsgYzJzW2ldICogZGlmZlNxICsgYzNzW2ldICogZGlmZiAqIGRpZmZTcVxuXHR9XG59XG4iXSwibWFwcGluZ3MiOiI7Ozs7OztBQUFPLE1BQU1BLG9CQUFvQjtFQXFFaENDLFdBQWtCQSxDQUFDQyxDQUFTLEVBQVU7SUFDckMsTUFBTTtNQUFFQyxFQUFFO01BQUVDLEVBQUU7TUFBRUMsR0FBRztNQUFFQyxHQUFHO01BQUVDO0lBQUcsQ0FBRSxHQUFHLElBQUk7SUFFdEM7SUFDQSxJQUFJQyxDQUFDLEdBQUdMLEVBQUUsQ0FBQ00sTUFBTSxHQUFHLENBQUM7SUFDckIsSUFBSVAsQ0FBQyxLQUFLQyxFQUFFLENBQUNLLENBQUMsQ0FBQyxFQUFFO01BQ2hCLE9BQU9KLEVBQUUsQ0FBQ0ksQ0FBQyxDQUFDOztJQUdiO0lBQ0EsSUFBSUUsR0FBRyxHQUFHLENBQUM7SUFDWCxJQUFJQyxJQUFJLEdBQUdKLEdBQUcsQ0FBQ0UsTUFBTSxHQUFHLENBQUM7SUFDekIsSUFBSUcsR0FBRztJQUNQLE9BQU9GLEdBQUcsSUFBSUMsSUFBSSxFQUFFO01BQ25CQyxHQUFHLEdBQUdDLElBQUksQ0FBQ0MsS0FBSyxDQUFDLEdBQUcsSUFBSUosR0FBRyxHQUFHQyxJQUFJLENBQUMsQ0FBQztNQUNwQyxNQUFNSSxLQUFLLEdBQUdaLEVBQUUsQ0FBQ1MsR0FBRyxDQUFDO01BQ3JCLElBQUlH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