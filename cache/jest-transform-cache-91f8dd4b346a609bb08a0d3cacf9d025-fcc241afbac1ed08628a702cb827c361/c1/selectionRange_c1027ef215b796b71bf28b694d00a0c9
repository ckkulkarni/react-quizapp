28e10bed527c49c758208fe2cac2f93e
"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.getSelectionRange = getSelectionRange;
exports.hasSelectionSupport = hasSelectionSupport;
exports.setSelectionRange = setSelectionRange;
var _isElementType = require("../misc/isElementType");

// https://github.com/jsdom/jsdom/blob/c2fb8ff94917a4d45e2398543f5dd2a8fed0bdab/lib/jsdom/living/nodes/HTMLInputElement-impl.js#L45
var selectionSupportType;
(function (selectionSupportType) {
  selectionSupportType["text"] = "text";
  selectionSupportType["search"] = "search";
  selectionSupportType["url"] = "url";
  selectionSupportType["tel"] = "tel";
  selectionSupportType["password"] = "password";
})(selectionSupportType || (selectionSupportType = {}));
const InputSelection = Symbol('inputSelection');
function hasSelectionSupport(element) {
  return (0, _isElementType.isElementType)(element, 'textarea') || (0, _isElementType.isElementType)(element, 'input') && Boolean(selectionSupportType[element.type]);
}
function getSelectionRange(element) {
  if (hasSelectionSupport(element)) {
    return {
      selectionStart: element.selectionStart,
      selectionEnd: element.selectionEnd
    };
  }
  if ((0, _isElementType.isElementType)(element, 'input')) {
    var _InputSelection;
    return (_InputSelection = element[InputSelection]) != null ? _InputSelection : {
      selectionStart: null,
      selectionEnd: null
    };
  }
  const selection = element.ownerDocument.getSelection(); // there should be no editing if the focusNode is outside of element
  // TODO: properly handle selection ranges

  if (selection != null && selection.rangeCount && element.contains(selection.focusNode)) {
    const range = selection.getRangeAt(0);
    return {
      selectionStart: range.startOffset,
      selectionEnd: range.endOffset
    };
  } else {
    return {
      selectionStart: null,
      selectionEnd: null
    };
  }
}
function setSelectionRange(element, newSelectionStart, newSelectionEnd) {
  const {
    selectionStart,
    selectionEnd
  } = getSelectionRange(element);
  if (selectionStart === newSelectionStart && selectionEnd === newSelectionEnd) {
    return;
  }
  if (hasSelectionSupport(element)) {
    element.setSelectionRange(newSelectionStart, newSelectionEnd);
  }
  if ((0, _isElementType.isElementType)(element, 'input')) {
    ;
    element[InputSelection] = {
      selectionStart: newSelectionStart,
      selectionEnd: newSelectionEnd
    };
  } // Moving the selection inside <input> or <textarea> does not alter the document Selection.

  if ((0, _isElementType.isElementType)(element, 'input') || (0, _isElementType.isElementType)(element, 'textarea')) {
    return;
  }
  const range = element.ownerDocument.createRange();
  range.selectNodeContents(element); // istanbul ignore else

  if (element.firstChild) {
    range.setStart(element.firstChild, newSelectionStart);
    range.setEnd(element.firstChild, newSelectionEnd);
  }
  const selection = element.ownerDocument.getSelection(); // istanbul ignore else

  if (selection) {
    selection.removeAllRanges();
    selection.addRange(range);
  }
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJPYmplY3QiLCJkZWZpbmVQcm9wZXJ0eSIsImV4cG9ydHMiLCJ2YWx1ZSIsImdldFNlbGVjdGlvblJhbmdlIiwiaGFzU2VsZWN0aW9uU3VwcG9ydCIsInNldFNlbGVjdGlvblJhbmdlIiwiX2lzRWxlbWVudFR5cGUiLCJyZXF1aXJlIiwic2VsZWN0aW9uU3VwcG9ydFR5cGUiLCJJbnB1dFNlbGVjdGlvbiIsIlN5bWJvbCIsImVsZW1lbnQiLCJpc0VsZW1lbnRUeXBlIiwiQm9vbGVhbiIsInR5cGUiLCJzZWxlY3Rpb25TdGFydCIsInNlbGVjdGlvbkVuZCIsIl9JbnB1dFNlbGVjdGlvbiIsInNlbGVjdGlvbiIsIm93bmVyRG9jdW1lbnQiLCJnZXRTZWxlY3Rpb24iLCJyYW5nZUNvdW50IiwiY29udGFpbnMiLCJmb2N1c05vZGUiLCJyYW5nZSIsImdldFJhbmdlQXQiLCJzdGFydE9mZnNldCIsImVuZE9mZnNldCIsIm5ld1NlbGVjdGlvblN0YXJ0IiwibmV3U2VsZWN0aW9uRW5kIiwiY3JlYXRlUmFuZ2UiLCJzZWxlY3ROb2RlQ29udGVudHMiLCJmaXJzdENoaWxkIiwic2V0U3RhcnQiLCJzZXRFbmQiLCJyZW1vdmVBbGxSYW5nZXMiLCJhZGRSYW5nZSJdLCJzb3VyY2VzIjpbInNlbGVjdGlvblJhbmdlLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xuXG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHtcbiAgdmFsdWU6IHRydWVcbn0pO1xuZXhwb3J0cy5nZXRTZWxlY3Rpb25SYW5nZSA9IGdldFNlbGVjdGlvblJhbmdlO1xuZXhwb3J0cy5oYXNTZWxlY3Rpb25TdXBwb3J0ID0gaGFzU2VsZWN0aW9uU3VwcG9ydDtcbmV4cG9ydHMuc2V0U2VsZWN0aW9uUmFuZ2UgPSBzZXRTZWxlY3Rpb25SYW5nZTtcblxudmFyIF9pc0VsZW1lbnRUeXBlID0gcmVxdWlyZShcIi4uL21pc2MvaXNFbGVtZW50VHlwZVwiKTtcblxuLy8gaHR0cHM6Ly9naXRodWIuY29tL2pzZG9tL2pzZG9tL2Jsb2IvYzJmYjhmZjk0OTE3YTRkNDVlMjM5ODU0M2Y1ZGQyYThmZWQwYmRhYi9saWIvanNkb20vbGl2aW5nL25vZGVzL0hUTUxJbnB1dEVsZW1lbnQtaW1wbC5qcyNMNDVcbnZhciBzZWxlY3Rpb25TdXBwb3J0VHlwZTtcblxuKGZ1bmN0aW9uIChzZWxlY3Rpb25TdXBwb3J0VHlwZSkge1xuICBzZWxlY3Rpb25TdXBwb3J0VHlwZVtcInRleHRcIl0gPSBcInRleHRcIjtcbiAgc2VsZWN0aW9uU3VwcG9ydFR5cGVbXCJzZWFyY2hcIl0gPSBcInNlYXJjaFwiO1xuICBzZWxlY3Rpb25TdXBwb3J0VHlwZVtcInVybFwiXSA9IFwidXJsXCI7XG4gIHNlbGVjdGlvblN1cHBvcnRUeXBlW1widGVsXCJdID0gXCJ0ZWxcIjtcbiAgc2VsZWN0aW9uU3VwcG9ydFR5cGVbXCJwYXNzd29yZFwiXSA9IFwicGFzc3dvcmRcIjtcbn0pKHNlbGVjdGlvblN1cHBvcnRUeXBlIHx8IChzZWxlY3Rpb25TdXBwb3J0VHlwZSA9IHt9KSk7XG5cbmNvbnN0IElucHV0U2VsZWN0aW9uID0gU3ltYm9sKCdpbnB1dFNlbGVjdGlvbicpO1xuXG5mdW5jdGlvbiBoYXNTZWxlY3Rpb25TdXBwb3J0KGVsZW1lbnQpIHtcbiAgcmV0dXJuICgwLCBfaXNFbGVtZW50VHlwZS5pc0VsZW1lbnRUeXBlKShlbGVtZW50LCAndGV4dGFyZWEnKSB8fCAoMCwgX2lzRWxlbWVudFR5cGUuaXNFbGVtZW50VHlwZSkoZWxlbWVudCwgJ2lucHV0JykgJiYgQm9vbGVhbihzZWxlY3Rpb25TdXBwb3J0VHlwZVtlbGVtZW50LnR5cGVdKTtcbn1cblxuZnVuY3Rpb24gZ2V0U2VsZWN0aW9uUmFuZ2UoZWxlbWVudCkge1xuICBpZiAoaGFzU2VsZWN0aW9uU3VwcG9ydChlbGVtZW50KSkge1xuICAgIHJldHVybiB7XG4gICAgICBzZWxlY3Rpb25TdGFydDogZWxlbWVudC5zZWxlY3Rpb25TdGFydCxcbiAgICAgIHNlbGVjdGlvbkVuZDogZWxlbWVudC5zZWxlY3Rpb25FbmRcbiAgICB9O1xuICB9XG5cbiAgaWYgKCgwLCBfaXNFbGVtZW50VHlwZS5pc0VsZW1lbnRUeXBlKShlbGVtZW50LCAnaW5wdXQnKSkge1xuICAgIHZhciBfSW5wdXRTZWxlY3Rpb247XG5cbiAgICByZXR1cm4gKF9JbnB1dFNlbGVjdGlvbiA9IGVsZW1lbnRbSW5wdXRTZWxlY3Rpb25dKSAhPSBudWxsID8gX0lucHV0U2VsZWN0aW9uIDoge1xuICAgICAgc2VsZWN0aW9uU3RhcnQ6IG51bGwsXG4gICAgICBzZWxlY3Rpb25FbmQ6IG51bGxcbiAgICB9O1xuICB9XG5cbiAgY29uc3Qgc2VsZWN0aW9uID0gZWxlbWVudC5vd25lckRvY3VtZW50LmdldFNlbGVjdGlvbigpOyAvLyB0aGVyZSBzaG91bGQgYmUgbm8gZWRpdGluZyBpZiB0aGUgZm9jdXNOb2RlIGlzIG91dHNpZGUgb2YgZWxlbWVudFxuICAvLyBUT0RPOiBwcm9wZXJseSBoYW5kbGUgc2VsZWN0aW9uIHJhbmdlc1xuXG4gIGlmIChzZWxlY3Rpb24gIT0gbnVsbCAmJiBzZWxlY3Rpb24ucmFuZ2VDb3VudCAmJiBlbGVtZW50LmNvbnRhaW5zKHNlbGVjdGlvbi5mb2N1c05vZGUpKSB7XG4gICAgY29uc3QgcmFuZ2UgPSBzZWxlY3Rpb24uZ2V0UmFuZ2VBdCgwKTtcbiAgICByZXR1cm4ge1xuICAgICAgc2VsZWN0aW9uU3RhcnQ6IHJhbmdlLnN0YXJ0T2Zmc2V0LFxuICAgICAgc2VsZWN0aW9uRW5kOiByYW5nZS5lbmRPZmZzZXRcbiAgICB9O1xuICB9IGVsc2Uge1xuICAgIHJldHVybiB7XG4gICAgICBzZWxlY3Rpb25TdGFydDogbnVsbCxcbiAgICAgIHNlbGVjdGlvbkVuZDogbnVsbFxuICAgIH07XG4gIH1cbn1cblxuZnVuY3Rpb24gc2V0U2VsZWN0aW9uUmFuZ2UoZWxlbWVudCwgbmV3U2VsZWN0aW9uU3RhcnQsIG5ld1NlbGVjdGlvbkVuZCkge1xuICBjb25zdCB7XG4gICAgc2VsZWN0aW9uU3RhcnQsXG4gICAgc2VsZWN0aW9uRW5kXG4gIH0gPSBnZXRTZWxlY3Rpb25SYW5nZShlbGVtZW50KTtcblxuICBpZiAoc2VsZWN0aW9uU3RhcnQgPT09IG5ld1NlbGVjdGlvblN0YXJ0ICYmIHNlbGVjdGlvbkVuZCA9PT0gbmV3U2VsZWN0aW9uRW5kKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgaWYgKGhhc1NlbGVjdGlvblN1cHBvcnQoZWxlbWVudCkpIHtcbiAgICBlbGVtZW50LnNldFNlbGVjdGlvblJhbmdlKG5ld1NlbGVjdGlvblN0YXJ0LCBuZXdTZWxlY3Rpb25FbmQpO1xuICB9XG5cbiAgaWYgKCgwLCBfaXNFbGVtZW50VHlwZS5pc0VsZW1lbnRUeXBlKShlbGVtZW50LCAnaW5wdXQnKSkge1xuICAgIDtcbiAgICBlbGVtZW50W0lucHV0U2VsZWN0aW9uXSA9IHtcbiAgICAgIHNlbGVjdGlvblN0YXJ0OiBuZXdTZWxlY3Rpb25TdGFydCxcbiAgICAgIHNlbGVjdGlvbkVuZDogbmV3U2VsZWN0aW9uRW5kXG4gICAgfTtcbiAgfSAvLyBNb3ZpbmcgdGhlIHNlbGVjdGlvbiBpbnNpZGUgPGlucHV0PiBvciA8dGV4dGFyZWE+IGRvZXMgbm90IGFsdGVyIHRoZSBkb2N1bWVudCBTZWxlY3Rpb24uXG5cblxuICBpZiAoKDAsIF9pc0VsZW1lbnRUeXBlLmlzRWxlbWVudFR5cGUpKGVsZW1lbnQsICdpbnB1dCcpIHx8ICgwLCBfaXNFbGVtZW50VHlwZS5pc0VsZW1lbnRUeXBlKShlbGVtZW50LCAndGV4dGFyZWEnKSkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGNvbnN0IHJhbmdlID0gZWxlbWVudC5vd25lckRvY3VtZW50LmNyZWF0ZVJhbmdlKCk7XG4gIHJhbmdlLnNlbGVjdE5vZGVDb250ZW50cyhlbGVtZW50KTsgLy8gaXN0YW5idWwgaWdub3JlIGVsc2VcblxuICBpZiAoZWxlbWVudC5maXJzdENoaWxkKSB7XG4gICAgcmFuZ2Uuc2V0U3RhcnQoZWxlbWVudC5maXJzdENoaWxkLCBuZXdTZWxlY3Rpb25TdGFydCk7XG4gICAgcmFuZ2Uuc2V0RW5kKGVsZW1lbnQuZmlyc3RDaGlsZCwgbmV3U2VsZWN0aW9uRW5kKTtcbiAgfVxuXG4gIGNvbnN0IHNlbGVjdGlvbiA9IGVsZW1lbnQub3duZXJEb2N1bWVudC5nZXRTZWxlY3Rpb24oKTsgLy8gaXN0YW5idWwgaWdub3JlIGVsc2VcblxuICBpZiAoc2VsZWN0aW9uKSB7XG4gICAgc2VsZWN0aW9uLnJlbW92ZUFsbFJhbmdlcygpO1xuICAgIHNlbGVjdGlvbi5hZGRSYW5nZShyYW5nZSk7XG4gIH1cbn0iXSwibWFwcGluZ3MiOiJBQUFBLFlBQVk7O0FBRVpBLE1BQU0sQ0FBQ0MsY0FBYyxDQUFDQyxPQUFPLEVBQUUsWUFBWSxFQUFFO0VBQzNDQyxLQUFLLEVBQUU7QUFDVCxDQUFDLENBQUM7QUFDRkQsT0FBTyxDQUFDRSxpQkFBaUIsR0FBR0EsaUJBQWlCO0FBQzdDRixPQUFPLENBQUNHLG1CQUFtQixHQUFHQSxtQkFBbUI7QUFDakRILE9BQU8sQ0FBQ0ksaUJBQWlCLEdBQUdBLGlCQUFpQjtBQUU3QyxJQUFJQyxjQUFjLEdBQUdDLE9BQU8sQ0FBQyx1QkFBdUIsQ0FBQzs7QUFFckQ7QUFDQSxJQUFJQyxvQkFBb0I7QUFFeEIsQ0FBQyxVQUFVQSxvQkFBb0IsRUFBRTtFQUMvQkEsb0JBQW9CLENBQUMsTUFBTSxDQUFDLEdBQUcsTUFBTTtFQUNyQ0Esb0JBQW9CLENBQUMsUUFBUSxDQUFDLEdBQUcsUUFBUTtFQUN6Q0Esb0JBQW9CLENBQUMsS0FBSyxDQUFDLEdBQUcsS0FBSztFQUNuQ0Esb0JBQW9CLENBQUMsS0FBSyxDQUFDLEdBQUcsS0FBSztFQUNuQ0Esb0JBQW9CLENBQUMsVUFBVSxDQUFDLEdBQUcsVUFBVTtBQUMvQyxDQUFDLEVBQUVBLG9CQUFvQixLQUFLQSxvQkFBb0IsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDO0FBRXZELE1BQU1DLGNBQWMsR0FBR0MsTUFBTSxDQUFDLGdCQUFnQixDQUFD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