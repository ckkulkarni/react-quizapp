d7ca423df84411c9f7b1eeaf09d34dc2
"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.upload = upload;
var _dom = require("@testing-library/dom");
var _click = require("./click");
var _blur = require("./blur");
var _focus = require("./focus");
var _utils = require("./utils");
function upload(element, fileOrFiles, init, {
  applyAccept = false
} = {}) {
  var _input$files;
  const input = (0, _utils.isElementType)(element, 'label') ? element.control : element;
  if (!input || !(0, _utils.isElementType)(input, 'input', {
    type: 'file'
  })) {
    throw new TypeError(`The ${input === element ? 'given' : 'associated'} ${input == null ? void 0 : input.tagName} element does not accept file uploads`);
  }
  if ((0, _utils.isDisabled)(element)) return;
  (0, _click.click)(element, init == null ? void 0 : init.clickInit);
  const files = (Array.isArray(fileOrFiles) ? fileOrFiles : [fileOrFiles]).filter(file => !applyAccept || isAcceptableFile(file, input.accept)).slice(0, input.multiple ? undefined : 1); // blur fires when the file selector pops up

  (0, _blur.blur)(element); // focus fires when they make their selection

  (0, _focus.focus)(element); // do not fire an input event if the file selection does not change

  if (files.length === ((_input$files = input.files) == null ? void 0 : _input$files.length) && files.every((f, i) => {
    var _input$files2;
    return f === ((_input$files2 = input.files) == null ? void 0 : _input$files2.item(i));
  })) {
    return;
  } // the event fired in the browser isn't actually an "input" or "change" event
  // but a new Event with a type set to "input" and "change"
  // Kinda odd...

  const inputFiles = {
    ...files,
    length: files.length,
    item: index => files[index],
    [Symbol.iterator]() {
      let i = 0;
      return {
        next: () => ({
          done: i >= files.length,
          value: files[i++]
        })
      };
    }
  };
  (0, _dom.fireEvent)(input, (0, _dom.createEvent)('input', input, {
    target: {
      files: inputFiles
    },
    bubbles: true,
    cancelable: false,
    composed: true
  }));
  _dom.fireEvent.change(input, {
    target: {
      files: inputFiles
    },
    ...(init == null ? void 0 : init.changeInit)
  });
}
function isAcceptableFile(file, accept) {
  if (!accept) {
    return true;
  }
  const wildcards = ['audio/*', 'image/*', 'video/*'];
  return accept.split(',').some(acceptToken => {
    if (acceptToken.startsWith('.')) {
      // tokens starting with a dot represent a file extension
      return file.name.endsWith(acceptToken);
    } else if (wildcards.includes(acceptToken)) {
      return file.type.startsWith(acceptToken.substr(0, acceptToken.length - 1));
    }
    return file.type === acceptToken;
  });
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJPYmplY3QiLCJkZWZpbmVQcm9wZXJ0eSIsImV4cG9ydHMiLCJ2YWx1ZSIsInVwbG9hZCIsIl9kb20iLCJyZXF1aXJlIiwiX2NsaWNrIiwiX2JsdXIiLCJfZm9jdXMiLCJfdXRpbHMiLCJlbGVtZW50IiwiZmlsZU9yRmlsZXMiLCJpbml0IiwiYXBwbHlBY2NlcHQiLCJfaW5wdXQkZmlsZXMiLCJpbnB1dCIsImlzRWxlbWVudFR5cGUiLCJjb250cm9sIiwidHlwZSIsIlR5cGVFcnJvciIsInRhZ05hbWUiLCJpc0Rpc2FibGVkIiwiY2xpY2siLCJjbGlja0luaXQiLCJmaWxlcyIsIkFycmF5IiwiaXNBcnJheSIsImZpbHRlciIsImZpbGUiLCJpc0FjY2VwdGFibGVGaWxlIiwiYWNjZXB0Iiwic2xpY2UiLCJtdWx0aXBsZSIsInVuZGVmaW5lZCIsImJsdXIiLCJmb2N1cyIsImxlbmd0aCIsImV2ZXJ5IiwiZiIsImkiLCJfaW5wdXQkZmlsZXMyIiwiaXRlbSIsImlucHV0RmlsZXMiLCJpbmRleCIsIlN5bWJvbCIsIml0ZXJhdG9yIiwibmV4dCIsImRvbmUiLCJmaXJlRXZlbnQiLCJjcmVhdGVFdmVudCIsInRhcmdldCIsImJ1YmJsZXMiLCJjYW5jZWxhYmxlIiwiY29tcG9zZWQiLCJjaGFuZ2UiLCJjaGFuZ2VJbml0Iiwid2lsZGNhcmRzIiwic3BsaXQiLCJzb21lIiwiYWNjZXB0VG9rZW4iLCJzdGFydHNXaXRoIiwibmFtZSIsImVuZHNXaXRoIiwiaW5jbHVkZXMiLCJzdWJzdHIiXSwic291cmNlcyI6WyJ1cGxvYWQuanMiXSwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG5cbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwge1xuICB2YWx1ZTogdHJ1ZVxufSk7XG5leHBvcnRzLnVwbG9hZCA9IHVwbG9hZDtcblxudmFyIF9kb20gPSByZXF1aXJlKFwiQHRlc3RpbmctbGlicmFyeS9kb21cIik7XG5cbnZhciBfY2xpY2sgPSByZXF1aXJlKFwiLi9jbGlja1wiKTtcblxudmFyIF9ibHVyID0gcmVxdWlyZShcIi4vYmx1clwiKTtcblxudmFyIF9mb2N1cyA9IHJlcXVpcmUoXCIuL2ZvY3VzXCIpO1xuXG52YXIgX3V0aWxzID0gcmVxdWlyZShcIi4vdXRpbHNcIik7XG5cbmZ1bmN0aW9uIHVwbG9hZChlbGVtZW50LCBmaWxlT3JGaWxlcywgaW5pdCwge1xuICBhcHBseUFjY2VwdCA9IGZhbHNlXG59ID0ge30pIHtcbiAgdmFyIF9pbnB1dCRmaWxlcztcblxuICBjb25zdCBpbnB1dCA9ICgwLCBfdXRpbHMuaXNFbGVtZW50VHlwZSkoZWxlbWVudCwgJ2xhYmVsJykgPyBlbGVtZW50LmNvbnRyb2wgOiBlbGVtZW50O1xuXG4gIGlmICghaW5wdXQgfHwgISgwLCBfdXRpbHMuaXNFbGVtZW50VHlwZSkoaW5wdXQsICdpbnB1dCcsIHtcbiAgICB0eXBlOiAnZmlsZSdcbiAgfSkpIHtcbiAgICB0aHJvdyBuZXcgVHlwZUVycm9yKGBUaGUgJHtpbnB1dCA9PT0gZWxlbWVudCA/ICdnaXZlbicgOiAnYXNzb2NpYXRlZCd9ICR7aW5wdXQgPT0gbnVsbCA/IHZvaWQgMCA6IGlucHV0LnRhZ05hbWV9IGVsZW1lbnQgZG9lcyBub3QgYWNjZXB0IGZpbGUgdXBsb2Fkc2ApO1xuICB9XG5cbiAgaWYgKCgwLCBfdXRpbHMuaXNEaXNhYmxlZCkoZWxlbWVudCkpIHJldHVybjtcbiAgKDAsIF9jbGljay5jbGljaykoZWxlbWVudCwgaW5pdCA9PSBudWxsID8gdm9pZCAwIDogaW5pdC5jbGlja0luaXQpO1xuICBjb25zdCBmaWxlcyA9IChBcnJheS5pc0FycmF5KGZpbGVPckZpbGVzKSA/IGZpbGVPckZpbGVzIDogW2ZpbGVPckZpbGVzXSkuZmlsdGVyKGZpbGUgPT4gIWFwcGx5QWNjZXB0IHx8IGlzQWNjZXB0YWJsZUZpbGUoZmlsZSwgaW5wdXQuYWNjZXB0KSkuc2xpY2UoMCwgaW5wdXQubXVsdGlwbGUgPyB1bmRlZmluZWQgOiAxKTsgLy8gYmx1ciBmaXJlcyB3aGVuIHRoZSBmaWxlIHNlbGVjdG9yIHBvcHMgdXBcblxuICAoMCwgX2JsdXIuYmx1cikoZWxlbWVudCk7IC8vIGZvY3VzIGZpcmVzIHdoZW4gdGhleSBtYWtlIHRoZWlyIHNlbGVjdGlvblxuXG4gICgwLCBfZm9jdXMuZm9jdXMpKGVsZW1lbnQpOyAvLyBkbyBub3QgZmlyZSBhbiBpbnB1dCBldmVudCBpZiB0aGUgZmlsZSBzZWxlY3Rpb24gZG9lcyBub3QgY2hhbmdlXG5cbiAgaWYgKGZpbGVzLmxlbmd0aCA9PT0gKChfaW5wdXQkZmlsZXMgPSBpbnB1dC5maWxlcykgPT0gbnVsbCA/IHZvaWQgMCA6IF9pbnB1dCRmaWxlcy5sZW5ndGgpICYmIGZpbGVzLmV2ZXJ5KChmLCBpKSA9PiB7XG4gICAgdmFyIF9pbnB1dCRmaWxlczI7XG5cbiAgICByZXR1cm4gZiA9PT0gKChfaW5wdXQkZmlsZXMyID0gaW5wdXQuZmlsZXMpID09IG51bGwgPyB2b2lkIDAgOiBfaW5wdXQkZmlsZXMyLml0ZW0oaSkpO1xuICB9KSkge1xuICAgIHJldHVybjtcbiAgfSAvLyB0aGUgZXZlbnQgZmlyZWQgaW4gdGhlIGJyb3dzZXIgaXNuJ3QgYWN0dWFsbHkgYW4gXCJpbnB1dFwiIG9yIFwiY2hhbmdlXCIgZXZlbnRcbiAgLy8gYnV0IGEgbmV3IEV2ZW50IHdpdGggYSB0eXBlIHNldCB0byBcImlucHV0XCIgYW5kIFwiY2hhbmdlXCJcbiAgLy8gS2luZGEgb2RkLi4uXG5cblxuICBjb25zdCBpbnB1dEZpbGVzID0geyAuLi5maWxlcyxcbiAgICBsZW5ndGg6IGZpbGVzLmxlbmd0aCxcbiAgICBpdGVtOiBpbmRleCA9PiBmaWxlc1tpbmRleF0sXG5cbiAgICBbU3ltYm9sLml0ZXJhdG9yXSgpIHtcbiAgICAgIGxldCBpID0gMDtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIG5leHQ6ICgpID0+ICh7XG4gICAgICAgICAgZG9uZTogaSA+PSBmaWxlcy5sZW5ndGgsXG4gICAgICAgICAgdmFsdWU6IGZpbGVzW2krK11cbiAgICAgICAgfSlcbiAgICAgIH07XG4gICAgfVxuXG4gIH07XG4gICgwLCBfZG9tLmZpcmVFdmVudCkoaW5wdXQsICgwLCBfZG9tLmNyZWF0ZUV2ZW50KSgnaW5wdXQnLCBpbnB1dCwge1xuICAgIHRhcmdldDoge1xuICAgICAgZmlsZXM6IGlucHV0RmlsZXNcbiAgICB9LFxuICAgIGJ1YmJsZXM6IHRydWUsXG4gICAgY2FuY2VsYWJsZTogZmFsc2UsXG4gICAgY29tcG9zZWQ6IHRydWVcbiAgfSkpO1xuXG4gIF9kb20uZmlyZUV2ZW50LmNoYW5nZShpbnB1dCwge1xuICAgIHRhcmdldDoge1xuICAgICAgZmlsZXM6IGlucHV0RmlsZXNcbiAgICB9LFxuICAgIC4uLihpbml0ID09IG51bGwgPyB2b2lkIDAgOiBpbml0LmNoYW5nZUluaXQpXG4gIH0pO1xufVxuXG5mdW5jdGlvbiBpc0FjY2VwdGFibGVGaWxlKGZpbGUsIGFjY2VwdCkge1xuICBpZiAoIWFjY2VwdCkge1xuICAgIHJldHVybiB0cnVlO1xuICB9XG5cbiAgY29uc3Qgd2lsZGNhcmRzID0gWydhdWRpby8qJywgJ2ltYWdlLyonLCAndmlkZW8vKiddO1xuICByZXR1cm4gYWNjZXB0LnNwbGl0KCcsJykuc29tZShhY2NlcHRUb2tlbiA9PiB7XG4gICAgaWYgKGFjY2VwdFRva2VuLnN0YXJ0c1dpdGgoJy4nKSkge1xuICAgICAgLy8gdG9rZW5zIHN0YXJ0aW5nIHdpdGggYSBkb3QgcmVwcmVzZW50IGEgZmlsZSBleHRlbnNpb25cbiAgICAgIHJldHVybiBmaWxlLm5hbWUuZW5kc1dpdGgoYWNjZXB0VG9rZW4pO1xuICAgIH0gZWxzZSBpZiAod2lsZGNhcmRzLmluY2x1ZGVzKGFjY2VwdFRva2VuKSkge1xuICAgICAgcmV0dXJuIGZpbGUudHlwZS5zdGFydHNXaXRoKGFjY2VwdFRva2VuLnN1YnN0cigwLCBhY2NlcHRUb2tlbi5sZW5ndGggLSAxKSk7XG4gICAgfVxuXG4gICAgcmV0dXJuIGZpbGUudHlwZSA9PT0gYWNjZXB0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